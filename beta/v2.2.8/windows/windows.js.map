{"version":3,"sources":["../../../../src/windows/windows.es6"],"names":["dialogCounter","calculateChartCount","options","extend","width","height","rows","Math","floor","window","cols","isSmallView","total","callbacks","fire_event","name","args","fns","forEach","cb","setTimeout","apply","undefined","addDateToHeader","mainOptions","title","date","changed","cleared","addDateDropDowns","header","parent","find","addClass","addDatePicker","opts","dpicker_input","insertAfter","showOn","numberOfMonths","maxDate","minDate","Date","dateFormat","showAnim","showButtonPanel","changeMonth","changeYear","onSelect","change","beforeShow","input","inst","dpDiv","css","marginTop","marginLeft","closeText","i18n","currentText","dpicker","datepicker","toISOString","slice","_gotoToday","id","next","text","button","icons","primary","on","yyyy_mm_dd","val","onchange","dropdonws","date_string","update","onclear","clear","dt","inputElementForDate","maxYear","getFullYear","utc","format","getScrollHeight","without_body","bottoms","map","inx","d","$d","$w","hasClass","offset","top","push","max","fixMinimizedDialogsPosition","footer_height","scroll_bottom","document","scrollTop","init","$parentObj","original","fn","dialog","cmd","trigger","call","arguments","require","chartWindowObj","liveapi","menu","is_empty","reopen","counts","cached","send","trading_times","then","markets","extractChartableMarkets","rand","arr","random","length","timePeriods","chartTypes","submarkets","symbols","instruments","sym","timePeriod","chart_type","addNewWindow","instrumentCode","symbol","instrumentName","display_name","type","delayAmount","delay_amount","tileDialogs","local_storage","get","oauth","Promise","all","authorize","acc","token","req","results","data","auth","_curr","e","loginid","currency","set","unshift","is_jpy_account","i","is_virtual","landing_company_name","indexOf","invalidate","growl","error","message","duration","remove","catch","err","code","ele","match","switch_account","console","scroll","createBlankWindow","$html","autoOpen","resizable","collapsable","draggable","my","at","of","hide","close","minimize","maximize","minWidth","minHeight","resize","restore","blankWindow","attr","ignoreTileAction","dialogExtend","animate","bind","destroy","defer","selector","outerHeight","reduce","a","b","replace","left","moveToTop","effect","times","distance","add_to_windows_menu","cleaner","addDialog","attributes","Object","keys","filter","key","startsWith","refresh","append","track","makeSelectmenu","select","list","update_select","children","appendTo","selectmenu","classes","update_list","new_list","event_on","event_off","index","splice"],"mappings":"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","file":"windows.js","sourcesContent":["\n/**\n * Created by arnab on 2/18/15.\n */\n\nimport $ from 'jquery';\nimport _ from 'lodash';\nimport navigation from 'navigation/navigation';\nimport tracker from 'windows/tracker';\nimport 'jquery.dialogextend';\nimport 'modernizr';\nimport 'common/util';\nimport 'css!windows/windows.css';\nimport moment from 'moment';\nimport workspace from  '../workspace/workspace.js';\n\nlet dialogCounter = 0;\n\n/* options: { width: 350, height: 400 } */\nconst calculateChartCount = (options) => {\n   options = $.extend({ width: 350, height: 400 }, options);\n   let rows = Math.floor($(window).height() / options.height) || 1,\n      cols = Math.floor($(window).width() / options.width) || 1;\n\n   if (isSmallView()) //For small size screens\n      rows = cols = 1;\n   /**** limi the number of charts to 4 ****/\n   if(rows * cols > 4) {\n      rows = 1;\n      cols = 4;\n   };\n   return {\n      rows: rows,\n      cols: cols,\n      total: rows * cols\n   };\n}\n\nlet callbacks = {};\n/* fire a custom event and call registered callbacks(api.events.on(name)) */\nconst fire_event = (name , ...args) => {\n   const fns = callbacks[name] || [];\n   fns.forEach(function (cb) {\n      setTimeout(function(){\n         cb.apply(undefined, args);\n      },0);\n   });\n}\n\n\n/*\n     @param: options.date    javascript Date object representing initial time\n     @param: options.title   the header title for spinners\n     @param: options.changed  called when Date changes, callback argument is a string in yyyy_mm_dd format.\n     @param: options.maxDate (optional) max selectable date\n   useage:\n      var win = createBlankWindow(...);\n      win.addDateToHeader({date:new Date(), title: 'sub header', changed: fn});\n      */\nconst addDateToHeader = function(mainOptions) {\n   mainOptions = $.extend({\n      title: 'title',\n      date: null,\n      changed: () => { },\n      cleared: () => { },\n      addDateDropDowns: true,\n   }, mainOptions);\n\n   const header = this.parent().find('.ui-dialog-title').addClass('with-content');\n\n\n   /* options: {date: date, onchange: fn} , events => element.on('change',...) */\n   const addDatePicker = (opts) => {\n      const dpicker_input = $(\"<input type='hidden' />\").insertAfter(header);\n\n      var options = {\n         showOn: 'both',\n         numberOfMonths: 1,\n         maxDate: mainOptions.maxDate ? mainOptions.maxDate : 0,\n         minDate: new Date(2010, 0, 1),\n         dateFormat: 'yy-mm-dd',\n         showAnim: 'drop',\n         showButtonPanel: true,\n         changeMonth: true,\n         changeYear: true,\n         onSelect: function () { $(this).change(); },\n         beforeShow: (input, inst) => {\n            inst.dpDiv.css({ marginTop: '10px', marginLeft: '-220px' });\n         },\n         closeText: 'Done'.i18n(),\n         currentText: 'Today'.i18n()\n      };\n\n      const dpicker = dpicker_input\n         .datepicker(options)\n         .datepicker(\"setDate\", opts.date.toISOString().slice(0, 10));\n\n      $.datepicker._gotoToday = (id) => {\n         $(id).datepicker('setDate', new Date()).change().datepicker('hide');\n      };\n\n      /* use JQ-UI icon for datepicker */\n      dpicker .next('button') .text('')\n         .button({ icons: { primary: 'ui-icon-calendar' } });\n\n      dpicker_input.on('change', function () {\n         const yyyy_mm_dd = $(this).val();\n         opts.onchange && opts.onchange(yyyy_mm_dd);\n      });\n      return dpicker_input;\n   }\n\n\n   let dropdonws = null;\n   const date_string = $('<span style=\"line-height: 24px; position: relative; left: 10px\"></span>');\n   const dpicker = addDatePicker({\n      date: mainOptions.date || new Date(),\n      onchange: (yyyy_mm_dd) => {\n         date_string.text(yyyy_mm_dd);\n         dropdonws && dropdonws.update(yyyy_mm_dd);\n         mainOptions.changed(yyyy_mm_dd);\n      },\n      onclear: () => {\n         dropdonws && dropdonws.clear();\n         mainOptions.cleared();\n      }\n   });\n\n   /*\n    options: {date: date, onchange: fn }\n    There were lot of complexity introduced because of drop down.\n    For example, there were scenarios, where it is not allowed to select dates in future\n    There were scenarios, where it is not allowed to select date in future\n    Drop down was allowing certain dates to be selected whereas date picker was not.\n    Such complexity is needed when I compared it with binary.com implementation.\n   */\n   const addDateDropDowns = (opts) => {\n    const dt = opts.date || new Date();\n    let inputElementForDate = $('<input placeholder=\"Select date\" readonly class=\"windows-dateInput\" />').insertAfter(header);\n    const maxYear = mainOptions.maxDate ? mainOptions.maxDate.getFullYear() : dt.getFullYear();\n    inputElementForDate.on('click', () => dpicker.datepicker('open'));\n    return {\n       update: yyyy_mm_dd => inputElementForDate.val(moment.utc(yyyy_mm_dd, 'YYYY-MM-DD').format('DD MMM, YYYY')),\n       clear: () => inputElementForDate.val(''),\n    };\n  }\n\n   if(mainOptions.addDateDropDowns) {\n      dropdonws = addDateDropDowns({\n         date: mainOptions.date, onchange: (yyyy_mm_dd) => {\n            dpicker.datepicker(\"setDate\", yyyy_mm_dd);\n            mainOptions.changed(yyyy_mm_dd);\n         }\n      });\n   }\n   else {\n      date_string.insertAfter(header);\n      date_string.text(mainOptions.date.toISOString().slice(0, 10));\n   }\n\n   $('<span class=\"span-in-dialog-header\">' + mainOptions.title + '</span>').insertAfter(header);\n\n   return {\n      clear:() => dropdonws && dropdonws.clear()\n   };\n}\n\nconst getScrollHeight = (without_body) => {\n   var bottoms = $('.ui-dialog').map((inx, d) => {\n      const $d = $(d);\n      const $w = $d.find('.webtrader-dialog');\n      if($w && $w.hasClass(\"ui-dialog-content\") && !$w.hasClass('ui-dialog-minimized')) {\n         const offset = $d.offset();\n         return (offset && (offset.top + $d.height())) || 0;\n      }\n      return 0;\n   });\n   if(!without_body) {\n      bottoms.push($('body').height());\n   }\n   return  Math.max.apply(null, bottoms);\n}\n\nconst fixMinimizedDialogsPosition = () => {\n   var footer_height = $('.addiction-warning').height();\n   var scroll_bottom = $(document).height() - $(window).height() - $(window).scrollTop();\n   $(\"#dialog-extend-fixed-container\").css(\"bottom\", Math.max(0, footer_height - scroll_bottom));\n}\n\n\nexport const init = function($parentObj) {\n   /* wrap jquery ui dialog('destory') to fire an event */\n   var original = $.fn.dialog;\n   $.fn.dialog = function(cmd) {\n      if(cmd === 'destroy') {\n         this.trigger('dialogdestroy');\n         return original.call(this, 'destroy'); // destroy and remove from dom\n      }\n      return original.apply(this, arguments);\n   }\n\n   require([\"charts/chartWindow\",\"websockets/binary_websockets\", \"navigation/menu\"], (chartWindowObj,liveapi, menu) => {\n      if(!tracker.is_empty()) {\n         tracker.reopen();\n         return;\n      }\n      const counts = calculateChartCount();\n      liveapi\n         .cached.send({trading_times: new Date().toISOString().slice(0, 10)})\n         .then((markets) => {\n            markets = menu.extractChartableMarkets(markets);\n            /* return a random element of an array */\n            const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];\n            const timePeriods = ['2h', '4h', '8h', '1d'];\n            const chartTypes = ['candlestick', 'line', 'ohlc', 'spline']; //This is not the complete chart type list, however its good enough to randomly select one from this subset\n            for (let inx = 0; inx < counts.total; ++inx) {\n               const submarkets = rand(markets).submarkets;\n               const symbols = rand(submarkets).instruments;\n               const sym = rand(symbols);\n               const timePeriod = rand(timePeriods);\n               const chart_type = rand(chartTypes);\n\n               chartWindowObj.addNewWindow({\n                  instrumentCode: sym.symbol,\n                  instrumentName: sym.display_name,\n                  timePeriod: timePeriod,\n                  type: chart_type,\n                  delayAmount: sym.delay_amount\n               });\n            }\n            workspace.tileDialogs(); // Trigger tile action\n         });\n   });\n\n   /* automatically log the user in if we have oauth_token in local_storage */\n   require(['websockets/binary_websockets' ], (liveapi) => {\n      if(!local_storage.get('oauth')) {\n         return;\n      }\n      /* query string parameters can tempered.\n             make sure to get loginid from webapi instead */\n      var oauth = local_storage.get('oauth');\n      Promise.all(\n         oauth.slice(1)\n            .map(acc => ({ authorize: acc.token}))\n            .map(req => liveapi.send(req))\n      )\n         .then((results) =>\n            liveapi.cached.authorize()\n               .then((data) => {\n                  const oauth = local_storage.get(\"oauth\");\n                  // Set currency for each account.\n                  results.forEach((auth) => {\n                        if(auth.authorize) {\n                              const _curr = oauth.find((e) => e.id == auth.authorize.loginid);\n                              _curr.currency = auth.authorize.currency;\n                        }\n                  });\n                  local_storage.set(\"oauth\", oauth);\n                  results.unshift(data);\n                  let is_jpy_account = false;\n                  for(let i = 0; i < results.length; ++i) {\n                     oauth[i].id = results[i].authorize.loginid;\n                     oauth[i].is_virtual = results[i].authorize.is_virtual;\n                     if (results[i].authorize.landing_company_name.indexOf('japan') !== -1) {\n                        is_jpy_account = true;\n                     }\n                  }\n                  local_storage.set('oauth', oauth);\n                  return is_jpy_account;\n               })\n         )\n         .then((is_jpy_account) => {\n            /* Japan accounts should not be allowed to login to webtrader */\n            if(is_jpy_account && is_jpy_account === true) {\n               liveapi.invalidate();\n               $.growl.error({message: 'Japan accounts are not supported.'.i18n(), duration: 6000 });\n               local_storage.remove('oauth');\n               local_storage.remove('oauth-login');\n            }\n         })\n         .catch((err) => {\n            //Switch to virtual account on selfexclusion error.\n            if(err.code===\"SelfExclusion\"){\n               //Login to virtual account instead.\n               oauth.forEach((ele, i) => {\n                  if(ele.id.match(/^VRTC/)){\n                     liveapi.switch_account(ele.id);\n                     return;\n                  }\n               });\n               return;\n            }\n            console.error(err.message);\n            $.growl.error({message: err.message});\n            //Remove token and trigger login-error event.\n            local_storage.remove('oauth');\n            $(\".login\").trigger(\"login-error\");\n         });\n   });\n   $(window).scroll(fixMinimizedDialogsPosition);\n   return this;\n}\n\n/* important options: {\n   title:'',\n   resize:fn, // callabak for dialog resize event\n   close: fn, // callback for dialog close event\n   open: fn,  // callback for dialog open event\n   destroy: fn, // callback for dialog destroy event\n   refresh: fn, // callback for refresh button click\n   autoOpen: false,\n   resizable:true,\n   collapsable:false,\n   minimizable: true,\n   maximizable: true,\n   closable:true,\n   modal:true, // Whether to block base page and show it as blocking modal dialog\n   closeOnEscape:true, // Respond to ESC key event\n   ignoreTileAction:false, // Is this dialog going to take part in tile action\n   data-*: 'value' // add arbitary data-* attributes to the dialog.('data-authorized' for exmaple)\n}\nnotes:\n    1- get generated dialog id via createBlankWindow(...).attr('id')\n    2- if autoOpen == false  use createBalnkWindow(...).dialog('open') to open the dialog\n    2- if minWidth and minHeight are not specified the options.width and options.height will be used for minimums.\n */\nexport const createBlankWindow = function($html,options) {\n   $html = $($html);\n   const id = \"windows-dialog-\" + ++dialogCounter;\n   options = $.extend({\n      autoOpen: false,\n      resizable: true,\n      collapsable: false,\n      draggable: true,\n      width: 350,\n      height: 400,\n      my: 'center',\n      at: 'center',\n      of: window,\n      title: 'Blank window'.i18n(),\n      hide: 'fade',\n      icons: {\n         close: 'custom-icon-close',\n         minimize: 'custom-icon-minimize',\n         maximize: 'custom-icon-maximize'\n      },\n   }, options || {});\n   options.minWidth = options.minWidth || options.width;\n   options.minHeight = options.minHeight || options.height;\n\n   if (options.resize)\n      options.maximize = options.minimize  = options.restore = options.resize;\n\n   const blankWindow = $html.attr(\"id\", id);\n   if (!options.ignoreTileAction) blankWindow.addClass('webtrader-dialog')\n   blankWindow.dialog(options).dialogExtend(options);\n\n\n   const dialog = blankWindow.dialog('widget');\n   dialog.addClass('webtrader-dialog-widget');\n   /* allow dialogs to be moved though the bottom of the page */\n   if (options.draggable !== false) {\n     dialog.draggable( \"option\", \"containment\", false );\n     dialog.draggable( \"option\", \"scroll\", true );\n   }\n   dialog.on('dragstop', () => {\n      const top = dialog.offset().top;\n      if(top < 0) {\n         dialog.animate({ top: '0px' }, 300, dialog.trigger.bind(dialog, 'animated'));\n      }\n   });\n\n   if(options.destroy) { /* register for destroy event which have been patched */\n      blankWindow.on('dialogdestroy', options.destroy);\n   }\n\n   blankWindow.on('dialogopen', function() {\n      _.defer(() => {\n         const top = ['#msg-notification', '#topbar', '#nav-menu'].map(selector => $(selector).outerHeight()).reduce((a,b) => a+b, 0);\n         const parent = $(this).parent();\n         if(parent.css('top').replace('px', '') * 1 <= top) {\n            parent.animate({\n               top: top + (Math.random()*15 | 0),\n               left: `+=${(Math.random()*10 | 0) - 20}px`,\n            }, 300, dialog.trigger.bind(dialog, 'animated'));\n         }\n      });\n   });\n   blankWindow.moveToTop = () => {\n      blankWindow.dialog('open');\n      blankWindow.dialogExtend('restore');\n      blankWindow.dialog('widget').effect(\"bounce\", { times: 2, distance: 15 }, 450);\n   };\n\n   // add an item to window menu\n   const add_to_windows_menu = () => {\n      const cleaner = workspace.addDialog(options.title, blankWindow.moveToTop, () => blankWindow.dialog('close'));\n      blankWindow.on('dialogclose', cleaner);\n\n   };\n   if(!options.ignoreTileAction) {\n      add_to_windows_menu();\n   }\n\n   if (options.resize) {\n      options.resize.call($html[0]);\n   }\n   blankWindow.addDateToHeader = addDateToHeader;\n\n   /* set data-* attributes on created dialog */\n   const attributes = Object.keys(options).filter((key) =>  _.startsWith(key, 'data-') );\n   attributes.forEach((key) => blankWindow.attr(key, options[key]) );\n\n   /* check and add the refresh button if needed */\n   if(options.refresh){\n      const header = blankWindow.parent().find('.ui-dialog-title');\n      const refresh = header.append(\"<img class='reload' src='images/refresh.svg' title='reload'/>\").find(\".reload\");\n      refresh.on('click',options.refresh);\n   }\n\n   /* options: {\n    *    module_id: 'statement/statement'  // require js module id\n    *    is_unique: true/false // is this dialog instance unique or not,\n    *    data: { } // arbitary data object for this dialog\n    * } */\n   blankWindow.track = (options) => tracker.track(options, blankWindow);\n\n   blankWindow.destroy = () => {\n      if(blankWindow.data('ui-dialog')) {\n         blankWindow.dialog('destroy');\n      }\n      blankWindow.remove();\n   };\n   return blankWindow;\n};\n\n/*\n   Uses a jquery-ui spinner to display a list of strings.\n       @param: options.index       initial value of the array to show.\n       @param: options.list        array of string items to show\n       @param: options.changed     callback thats i called when menu is changed.\n       @param: options.width       can specify the with of selectmenu.\n   Note: you should add your input to dom before turning it a spinner.\n\n   Note: you can call 'update_list(...)' on the returned spinner to update the list of items:\n       var spinner = makeTextSpinner(input,{list:['a,'b','c'],inx:0});\n       spinner.update_list(['a','d','e','f']);\n\n   TODO: move this to a utility file\n*/\nexport const makeSelectmenu = function (select, options) {\n   options = $.extend({\n      list: ['empty'],\n      inx: 0,\n      changed:  () => { }\n   }, options);\n\n   var inx = options.inx, list = options.list;\n   var update_select = (list) => {\n      select.children().remove();\n      for(let i = 0; i < list.length; ++i)\n         $('<option/>').val(list[i]).text(list[i]).appendTo(select);\n   }\n   update_select(list);\n   select.val(list[inx]);\n\n   select = select.selectmenu({ \n         classes: {\n           \"ui-selectmenu-button\": \"ui-selectmenu-button ui-state-default\"\n         },\n         width: options.width \n      });\n   select.on('selectmenuchange', function () {\n      var val = $(this).val();\n      options.changed(val);\n   })\n\n   select.update_list = (new_list) => {\n      update_select(new_list);\n      select.val(new_list[0]);\n      select.selectmenu('refresh');\n   }\n   return select;\n};\n\nexport const event_on = (name, cb) => {\n   (callbacks[name] = callbacks[name] || []).push(cb);\n   return cb;\n}\n\nexport const event_off = (name, cb) => {\n   if(callbacks[name]) {\n      var index = callbacks[name].indexOf(cb);\n      index !== -1 && callbacks[name].splice(index, 1);\n   }\n}\n\nexport default {\n   init,\n   createBlankWindow,\n   makeSelectmenu\n};\n"]}