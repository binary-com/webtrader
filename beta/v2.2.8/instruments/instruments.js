define(["exports","jquery","websockets/binary_websockets","navigation/menu","charts/chartWindow","../common/marketUtils","jquery-growl","common/util"],function(e,t,a,n,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSpecificMarketData=e.isMarketDataPresent=e.getMarketData=e.init=void 0;var s=o(t),u=o(a),m=o(n),l=o(r);function o(e){return e&&e.__esModule?e:{default:e}}function d(){u.default.cached.send({active_symbols:"brief"}).then(function(e){local_storage.set("active_symbols",e.active_symbols);var n=[];_(e.active_symbols).groupBy("market").map(function(e){var t=_.head(e),a={name:t.market,display_name:t.market_display_name};return a.submarkets=_(e).groupBy("submarket").map(function(e){var t=_.head(e),a={name:t.submarket,display_name:t.submarket_display_name};return a.instruments=_.map(e,function(e){return n.push(e.symbol),{symbol:e.symbol,display_name:e.display_name}}),a}).value(),a}).value();f=k.map(function(e){return{display_name:e.display_name,name:e.name,submarkets:e.submarkets.map(function(e){return{display_name:e.display_name,instruments:e.instruments.filter(function(e){return-1!==n.indexOf(e.symbol)})}}).filter(function(e){return 0!==e.instruments.length})}}).filter(function(e){return 0!==e.submarkets.length}),f=(0,i.getSortedMarketSubmarkets)(f);var t=(0,s.default)("#nav-menu").find(".instruments");t.find("> ul").remove(),m.default.refreshMenu(t,f,c)})}function c(e,t){l.default.addNewWindow({instrumentCode:e,instrumentName:t,timePeriod:"1d",type:"candlestick"})}var f=[],k=[],p=e.init=function(){return u.default.cached.send({trading_times:(new Date).toISOString().slice(0,10)}).then(function(e){return k=m.default.extractChartableMarkets(e),d(),u.default.events.on("login",d),u.default.events.on("logout",d),k})},y=e.getMarketData=function(){return f},b=e.isMarketDataPresent=function(a,e){var n=!1;e||(e=f);var r=this;return s.default.each(e,function(e,t){return t.submarkets||t.instruments?n=r.isMarketDataPresent(a,t.submarkets||t.instruments):s.default.trim(t.display_name)==s.default.trim(a)&&(n=!0),!n}),n},v=e.getSpecificMarketData=function(a,e){var n={};e||(e=f);var r=this;return s.default.each(e,function(e,t){return t.submarkets||t.instruments?n=r.getSpecificMarketData(a,t.submarkets||t.instruments):s.default.trim(t.display_name)==s.default.trim(a)&&(n=t),s.default.isEmptyObject(n)}),n};e.default={init:p,getMarketData:y,isMarketDataPresent:b,getSpecificMarketData:v}});