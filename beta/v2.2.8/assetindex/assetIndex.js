define(["exports","jquery","../windows/windows","../websockets/binary_websockets","../navigation/menu","lodash","datatables","jquery-growl","css!./assetIndex.css"],function(a,b,c,d,e,f){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var h=g(b),i=g(c),j=g(d),k=g(e),l=g(f),m=null,n=null,o=null,p=null,q=[],r={},s=a.init=function(a){a.click(function(){n?n.moveToTop():(n=i["default"].createBlankWindow(h["default"]("<div/>"),{title:"Asset Index".i18n(),dialogClass:"assetIndex",minWidth:800,minHeight:400,resizable:!1,minimizable:!0,maximizable:!0}),n.track({module_id:"assetIndex",is_unique:!0,data:null}),n.dialog("open"),require(["text!assetindex/assetIndex.html"],v))})},t=function(a){a=k["default"].extractFilteredMarkets(a);var b={};return a.filter(function(a){var b=(local_storage.get("authorize")||{}).loginid||"";return/MF/gi.test(b)&&"Volatility Indices"!==a.name||/MLT/gi.test(b)&&"Volatility Indices"===a.name||/MX/gi.test(b)&&"Volatility Indices"===a.name||!/MF/gi.test(b)&&!/MLT/gi.test(b)&&!/MX/gi.test(b)}).forEach(function(a){var c=b[a.display_name]={};a.submarkets.forEach(function(a){c[a.display_name]=a.instruments.map(function(a){return a.display_name})})}),b},u=function(){var a=function(a,b){var c=r[a][b],d=q.filter(function(a){return c.indexOf(a[1])>-1}).map(function(a){var b=[],c=function(b){var c=l["default"].chain(a[2]).find(function(a){return l["default"].first(a)===b}).value()||[];return l["default"].trim(c[2])+" - "+l["default"].trim(c[3])};return b.push(a[1]),b.push(c("lookback")),b.push(c("callput")),b.push(c("touchnotouch")),b.push(c("endsinout")),b.push(c("staysinout")),b.push(c("digits")),b.push(c("asian")),b});m.api().rows().remove(),m.api().rows.add(d);var e=-1!==a.indexOf("Volatility Indices");m.api().column(1).visible(e),m.api().column(6).visible(e),m.api().column(7).visible(e),m.api().draw()},b=h["default"]("#"+m.attr("id")+"_processing").show();Promise.all([j["default"].cached.send({trading_times:(new Date).toISOString().slice(0,10)}),j["default"].cached.send({asset_index:1})]).then(function(c){try{q=c[1].asset_index,r=t(c[0]);var d=(n.parent().find(".ui-dialog-title").addClass("with-content"),n.parent().find(".ui-dialog-titlebar-buttonpane"));o?o.update_list(Object.keys(r)):(o=i["default"].makeSelectmenu(h["default"]("<select />").insertBefore(d),{list:Object.keys(r),inx:0,changed:function(b){var c=Object.keys(r[b]);p.update_list(c),a(o.val(),p.val())},width:"180px"}),o.selectmenu("widget").addClass("asset-index-selectmenu"));var e=local_storage.get("i18n")&&"ar"===local_storage.get("i18n").value;p?p.update_list(Object.keys(r[o.val()])):(p=i["default"].makeSelectmenu(h["default"]("<select />").insertBefore(e?o:d),{list:Object.keys(r[o.val()]),inx:0,changed:function(){a(o.val(),p.val())},width:"200px"}),p.selectmenu("widget").addClass("asset-index-selectmenu")),a(o.val(),p.val()),b.hide()}catch(f){}})["catch"](function(a){h["default"].growl.error({message:a.message})})},v=function(a){a=h["default"](a).i18n(),m=a.filter("table"),a.appendTo(n),m=m.dataTable({data:[],columnDefs:[{className:"dt-body-center dt-header-center",targets:[0,1,2,3,4,5,6,7]},{defaultContent:"-",targets:[0,1,2,3,4,5,6,7]}],paging:!1,ordering:!1,searching:!0,processing:!0}),m.parent().addClass("hide-search-input"),m.api().column(0).every(function(){var a=this;h["default"]("input",this.header()).on("keyup change",function(){a.search()!==this.value&&a.search(this.value).draw()})}),u(),require(["websockets/binary_websockets"],function(a){a.events.on("login",u),a.events.on("logout",u)})};a["default"]={init:s}});