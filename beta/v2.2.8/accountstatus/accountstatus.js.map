{"version":3,"sources":["../../../../src/accountstatus/accountstatus.es6"],"names":["reposition_dialogs","min","parent","each","top","css","replace","animate","is_shown","AccountStatus","addEventListeners","liveapi","events","on","onLogin","bind","$ele","is","slideUp","response","authorize","is_virtual","getStatus","account_status","website_status","get_settings","financial_assessment","mt5_account","tc_accepted","financial_assessment_submitted","is_mlt","test","landing_company_name","is_mf","is_cr","has_mt5_account","mt5_login_list","length","is_authenticated","get_account_status","prompt_client_to_authenticate","terms_conditions_version","client_tnc_status","risk_classification","status","indexOf","checkStatus","Promise","all","send","cached","get_financial_assessment","_this","model","excluded_until","message","i18n","is_valid","local_storage","get","callback","lang","value","win","window","open","focus","tc","init","risk","financialassessment","tax","taxInformation","currency","check_currency","authenticate","notice","unwelcome","invalid_obj","_","find","obj","html","slideDown","recheckStatus","auth"],"mappings":"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","file":"accountstatus.js","sourcesContent":["import $ from \"jquery\";\nimport liveapi from \"../websockets/binary_websockets\";\nimport _ from \"lodash\";\nimport notice from \"shownotice/shownotice\";\nimport tc from \"../tc/tc\";\nimport financialassessment from \"../financialassessment/financialassessment\";\nimport taxInformation from \"../taxInformation/taxInformation\";\nimport currency from \"../cashier/currency\";\nimport \"../common/util\";\n\nconst reposition_dialogs = (min) => {\n  $('.webtrader-dialog').parent().each(function () {\n    const top = $(this).css('top').replace('px', '') * 1;\n    if (top <= min) {\n      $(this).animate({ top: `${min}px` }, 300);\n    }\n  });\n};\nlet is_shown = false;\n\nclass AccountStatus {\n\n  constructor(addEventListeners) {\n    // Initiating account check on login.\n        liveapi.events.on(\"login\", this.onLogin.bind(this));\n        // liveapi.events.on(\"switch_account\", onLogin);\n\n        // Hide msg bar on logout.\n         liveapi.events.on('reset_accountstatus', _ => {\n             const $ele = $(\"#msg-notification\");\n             $ele.is(\":visible\") && $ele.slideUp(500);\n             is_shown = false;\n         });\n  }\n  async onLogin (response) {\n    const $ele = $(\"#msg-notification\");\n    if (+response.authorize.is_virtual === 1) {\n      $ele.is(\":visible\") && $ele.slideUp(500);\n      is_shown = false;\n      reposition_dialogs(115);\n      return;\n    }\n\n    const [account_status, website_status, get_settings,\n      financial_assessment, mt5_account] = await this.getStatus(response.authorize);\n    this.tc_accepted = false;\n    this.financial_assessment_submitted = true;\n    this.is_mlt = /^malta$/gi.test(response.authorize.landing_company_name);\n    this.is_mf = /^maltainvest$/gi.test(response.authorize.landing_company_name);\n    this.is_cr = /^costarica$/gi.test(response.authorize.landing_company_name);\n    this.has_mt5_account = mt5_account.mt5_login_list.length > 0;\n    this.is_authenticated = !account_status.get_account_status.prompt_client_to_authenticate;\n    // Check whether the user has accepted the T&C.\n    if (website_status && website_status.website_status && get_settings && get_settings.get_settings) {\n      this.tc_accepted = website_status.website_status.terms_conditions_version === get_settings.get_settings.client_tnc_status;\n    }\n\n    // Check whether the high risk clients have submitted the financial_assessment form.\n    if (account_status.get_account_status.risk_classification === \"high\" || this.is_mf) {\n      this.financial_assessment_submitted = account_status.get_account_status.status.indexOf(\"financial_assessment_not_complete\") == -1;\n    }\n\n    this.checkStatus(response.authorize, account_status.get_account_status.status);\n  }\n\n  getStatus() {\n    // Getting account status, website status, account settings and financial assessment.\n    return Promise.all([\n      liveapi.send({ get_account_status: 1 }),\n      liveapi.send({ \"website_status\": 1 }),\n      liveapi.send({ \"get_settings\": 1 }),\n      liveapi.cached.send({ get_financial_assessment: 1 }),\n      liveapi.send({ mt5_login_list: 1 })\n    ]);\n  }\n\n  checkStatus(authorize, status) {\n    // Message container\n    const $ele = $(\"#msg-notification\"),\n      _this = this;\n    // Contains validations, messages, onclick callbacks.\n    // Maintaining the order of priority.\n    const model = {\n      excluded_until: {\n        message: \"Your account is restricted. Kindly [_1]contact customer support[_2] for assistance.\"\n        .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => local_storage.get(\"excluded\") == false,\n        callback: () => {\n          const lang = local_storage.get(\"i18n\").value ? local_storage.get(\"i18n\").value : \"en\";\n          const win = window.open(\"http://www.binary.com/\" + lang + \"/contact.html\");\n          win.focus();\n        }\n      },\n      tc: {\n        message: \"Please [_1]accept the updated Terms and Conditions[_2] to lift your withdrawal and trading limits.\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => _this.tc_accepted,\n        callback: tc.init\n      },\n      risk: {\n        message: \"Please complete the [_1]financial assessment form[_2] to lift your withdrawal and trading limits.\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => _this.financial_assessment_submitted,\n        callback: financialassessment.init\n      },\n      tax: {\n        message: \"Please [_1]complete your account profile[_2] to lift your withdrawal and trading limits.\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => !_this.is_mf || /crs_tin_information/.test(status),\n        callback: taxInformation.init\n      },\n      currency: {\n        message: \"Please set the [_1]currency[_2] of your account\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => local_storage.get(\"currency\"),\n        callback: currency.check_currency\n      },\n      authenticate: {\n        message: \"[_1]Authenticate your account[_2] now to take full advantage of all withdrawal options available.\".i18n()\n          .replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => _this.is_authenticated,\n        callback: notice.init\n      },\n      unwelcome: {\n        message: \"Your account is restricted. Kindly [_1]contact customer support[_2] for assistance.\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => !/(unwelcome|(cashier|withdrawal)_locked)/.test(status),\n        callback: () => {\n          const lang = local_storage.get(\"i18n\").value ? local_storage.get(\"i18n\").value : \"en\";\n          const win = window.open(\"http://www.binary.com/\" + lang + \"/contact.html\");\n          win.focus();\n        }\n      }\n    }\n    // Getting the invalid account status.\n    const invalid_obj = _.find(model, obj => !obj.is_valid());\n    if (invalid_obj) {\n      // Show message\n      $ele.html(invalid_obj.message);\n      // bind click event to open specific dialogs with instructions.\n      $ele.find(\"a\").on(\"click\", invalid_obj.callback);\n      $ele.slideDown(500);\n      reposition_dialogs(140);\n      is_shown = true;\n    } else {\n      $ele.is(\":visible\") && $ele.slideUp(500);\n      reposition_dialogs(115);\n      is_shown = false;\n    }\n  }\n}\n\nexport const init = new AccountStatus();\n\nexport default {\n  init,\n  recheckStatus: (auth) => init.onLogin({authorize: auth}),\n  is_shown: () => is_shown\n}\n"]}