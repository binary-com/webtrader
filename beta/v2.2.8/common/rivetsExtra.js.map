{"version":3,"sources":["../../../../src/common/rivetsExtra.es6"],"names":["rivets","_","View","prototype","observe","keypath","callback","model","models","inx","indexOf","substring","adapters","rv","formatters","value","i18n","prop","args","i","length","trim","eq","other","vlaue","currency","formatPrice","undefined","capitalize","read","publish","toLowerCase","digits","$","isNumeric","toFixed","defer","checkbox","first","second","fn","bind","array","field","map","condition","currency_symbols","epoch","d","Date","getUTCHours","slice","getUTCMinutes","getUTCSeconds","format","moment","utc","from_epoch","till_epoch","ret","seconds","duration","days","hours","minutes","str","last","changed","original","percentage_of_amount","email","validateEmail","date","isValid","regex","RegExp","test","debounce","timeout","clearTimeout","_timer_notify","setTimeout","filter","e","binders","selectmenu","priority","publishes","el","select","classes","change","val","trigger","unbind","routine","find","split","$input","reg","on","is_ok","method","appendto","css","selectrefresh","array_or_value","chosen","disablingElement","click","stopPropagation","width","next","prepend","chosenrefresh","chosendisable","chosenContainer","inputElement","chosenDrop","chosenDisableElement","attr","hide","addClass","removeAttr","show","removeClass","widget","ui","spinner","_buttonHtml","btn","dir","icon","step","radius","right","options","step_big","input","webtrader_spinner","stop","spin","currentTarget","decimals","preventDefault","keyup","event","keyCode","function","dialog","color","altField","after","colorpicker","showOn","position","my","of","collision","parts","alpha","layout","bar","colorFormat","part","size","parent","scrollParent","scroll","slider","div","handle","append","min","max","create","text","slide","datepicker","styles","marginTop","marginLeft","numberOfMonths","dateFormat","showAnim","showButtonPanel","changeMonth","changeYear","onSelect","beforeShow","inst","dpDiv","closeText","currentText","yearRange","maxDate","minDate","dpicker","blur","_gotoToday","id","timepicker","allways_ok","showPeriod","showLeadingZero","showCloseButton","showNowButton","onHourShow","onMinuteShow","tpDiv","hourText","minuteText","amPmText","closeButtonText","nowButtonText","deselectButtonText","menu","data","jquery_selector","style","getHiddenOffsetWidth","$hiddenElement","clone","appendTo","outerWidth","remove","cur_font","$el","fontSize","display","visibility","disabled","animate","scrollTop","scrollHeight","height","remove_all_matches_except_first","string","count","replaceWith","replace","match","listener","symbol","startsWith","_listener","off","getValue","console","warn","decimalPlaces","num","Math","max_nr_of_decimals","setAttribute","spots","chart","config","type","lineColor","fillColor","spotColor","minSpotColor","maxSpotColor","highlightSpotColor","highlightLineColor","spotRadius","sparkline","perv","_perv_indicative_color","red","green","black","component_twoway_bind","self","keypathes","key","observer","observers","target","updated","componentView","setValue","components","static","template","initialize","attributes","view","state"],"mappings":"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","file":"rivetsExtra.js","sourcesContent":["﻿/**\n * Created by amin on November 25, 2015.\n */\n\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport rv from 'rivets';\nimport moment from 'moment';\nimport 'jquery-ui';\nimport 'jquery-sparkline';\nimport 'chosen';\nimport 'color-picker';\n\n/* Rivets js does not allow manually observing properties from javascript,\n       Use \"rv.bind().observe('path.to.object', callback)\" to subscribe */\nrivets._.View.prototype.observe = function (keypath, callback) {\n   let model = this.models, inx = 0;\n   while ((inx = keypath.indexOf('.')) !== -1) {\n      model = model[keypath.substring(0,inx)];\n      keypath = keypath.substring(inx + 1);\n   }\n   this.adapters['.'].observe(model, keypath,\n      () => callback(model[keypath])\n   );\n};\n\n/************************************* formatters ***************************************/\n\n/* rivets formatter to translate strings to 18n */\nrv.formatters['i18n'] = (value) => {\n   if(typeof value === 'string') return value.i18n();\n   return value;\n};\n/* rivets formatter to get the property value of an object */\nrv.formatters['prop'] = (value, prop) => {\n   return value && value[prop];\n};\n/* rivets formatter to check if a value is one of the given args */\nrv.formatters['one-of'] = (...args) => {\n   const value = args[0];\n   for (let i = 1; i < args.length ; ++i)\n      if(args[i] === value)\n         return true;\n   return false;\n}\n/* rivets formatter to trim a string */\nrv.formatters['trim'] = (value) => _.trim(value);\n/* rivets formatter to negate a value */\nrv.formatters['negate'] = (value) => !value;\n/* rivets formatter to check equality of two values */\nrv.formatters.eq = (value, other) => value === other;\n/* formatter to check not-equality of values */\nrv.formatters['not-eq'] = (value, other) => value !== other;\n/* rivets formatter to replace a falsy value with a default one */\nrv.formatters['or'] = (value, other) => value || other;\n/* rivets formatter to replace a falsy value with a default one */\nrv.formatters['or-not'] = (value, other) => value || !other;\n/* rivets formatter to replace a true value with a default one */\nrv.formatters['and'] = (vlaue, other) => vlaue && other;\n/* rivets formatter and not  */\nrv.formatters['and-not'] = (vlaue, other) => vlaue && !other;\n/* rivets formatter for > operator  */\nrv.formatters['gt'] = (vlaue, other) => vlaue > other;\n/* rivets formatter for < operator  */\nrv.formatters['lt'] = (vlaue, other) => vlaue < other;\n/* localise price format*/\nrv.formatters['format-price'] = (value, currency) => (value) ?  formatPrice(value, currency) : undefined;\n/* rivets formater to capitalize string */\nrv.formatters.capitalize = {\n   read: (value) => _.capitalize(value),\n   publish: (value) => value.toLowerCase()\n};\n/* call toFixed on a fload number */\nrv.formatters['to-fixed'] = (value, digits) => {\n   if(!$.isNumeric(value) || !$.isNumeric(digits)){\n      return;\n   }\n   return (value * 1).toFixed(digits || 2);\n}\n/* notify other functions on property changes */\nrv.formatters['notify'] = (...args) => {\n   const value = args[0];\n   for (let i = 1; i < args.length ; ++i)\n      _.defer(args[i], value);\n   return value;\n}\n/* rv 2-way formatter for checkboxes */\nrv.formatters.checkbox = {\n   read: (value, first, second) => _.trim(value, \" '\\\"\") == first,\n   publish: (value, first, second) => _.trim(value ? first: second, \" '\\\"\"),\n}\n/* rv formmatter to bind a given function to a value */\nrv.formatters['bind'] = (fn, value) => fn.bind(undefined, value);\n\nrv.formatters['map'] = (array, field) => _.map(array, field);\n/* rv formatter to prepend a value */\nrv.formatters['prepend'] = (value, other) => (other && value) ? other + value : value;\n/* rv formatter to append a value */\nrv.formatters['append'] = (value, other) => (other && value) ? value + other : value;\n/* ternary operator (condition ? first : second) */\nrv.formatters['ternary'] = (condition, first, second) => condition ? first : second;\n/* formatter to add a currency symbol before the value */\nrv.formatters.currency = (value, currency) => {\n   const currency_symbols = {\n      'USD': '$', /* US Dollar */ 'EUR': '€', /* Euro */ 'CRC': '₡', /* Costa Rican Colón */\n      'GBP': '£', /* British Pound Sterling */ 'ILS': '₪', /* Israeli New Sheqel */\n      'INR': '₹', /* Indian Rupee */ 'JPY': '¥', /* Japanese Yen */\n      'KRW': '₩', /* South Korean Won */ 'NGN': '₦', /* Nigerian Naira */\n      'PHP': '₱', /* Philippine Peso */ 'PLN': 'zł', /* Polish Zloty */\n      'PYG': '₲', /* Paraguayan Guarani */ 'THB': '฿', /* Thai Baht */\n      'UAH': '₴', /* Ukrainian Hryvnia */ 'VND': '₫', /* Vietnamese Dong */\n   };\n   if(value)\n      return (currency_symbols[currency] || currency) + value;\n   return value;\n}\n/* formatter to convert epoch to utc-time in hh:mm:ss format */\nrv.formatters['utc-time'] = (epoch) => {\n   const d = new Date(epoch * 1000); /* since unixEpoch is simply epoch / 1000, we  multiply the argument by 1000 */\n   return (\"00\" + d.getUTCHours()).slice(-2) + \":\" +\n      (\"00\" + d.getUTCMinutes()).slice(-2) + \":\" +\n      (\"00\" + d.getUTCSeconds()).slice(-2);\n}\nrv.formatters['moment'] = (epoch, format) => {\n   format = format || 'YYYY-MM-DD HH:mm:ss';\n   return epoch && moment.utc(epoch*1000).format(format);\n}\n/* human readable difference of two epoch values */\nrv.formatters['moment-humanize'] = (from_epoch, till_epoch) => {\n   if(!from_epoch || !till_epoch) {\n      return undefined;\n   }\n\n   let ret = '';\n   const seconds = till_epoch - from_epoch;\n   const duration = moment.duration(seconds, 'seconds');\n   if (duration.days() > 0)\n      ret += ' ' + duration.days() + ' ' + (duration.days() > 1 ? 'days' : 'day');\n   if (duration.hours() > 0)\n      ret += ' ' + duration.hours() + ' ' + (duration.hours() > 1 ? 'hours' : 'hour');\n   if (duration.minutes() > 0)\n      ret += ' ' + duration.minutes() + ' ' + (duration.minutes() > 1 ? 'minutes' : 'minute');\n   if (duration.seconds() > 0 && seconds < 10*60)\n      ret += ' ' + duration.seconds() + ' ' + (duration.seconds() > 1 ? 'seconds' : 'second');\n\n   return _.trim(ret).i18n();\n}\n/* formatter to bold last character */\nrv.formatters['bold-last-character'] = (str) => {\n   str = str + '';\n   return str.substring(0, str.length - 1) + '<strong>' + _.last(str) + '</strong>';\n}\n/* formatter to calcualte the percent of a value of another value */\nrv.formatters['percent-of'] = (changed, original) => {\n   if(!changed || !original) return undefined;\n   const percentage_of_amount = (100*(changed - original)/original).toFixed(2);\n   if (percentage_of_amount > 0) {\n     return `+${percentage_of_amount}%`;\n   }\n   return `${percentage_of_amount}%`;\n}\n\nrv.formatters['is-valid-email'] = (email) => email === '' || validateEmail(email);\nrv.formatters['is-valid-date'] = (date, format =  'YYYY-MM-DD') => moment(date, format, true).isValid();\nrv.formatters['is-valid-regex'] = (str, regex) => new RegExp(regex).test(str);\nrv.formatters.length = (value) => value.length;\n\n/* Debouncing enforces that a function not be called again until a certain amount of time has passed without it being called.\n       As in \"execute this function only if 100 milliseconds have passed without it being called.\" */\nrv.formatters.debounce = (value, callback, timeout = 250) => {\n   clearTimeout(callback._timer_notify);\n   callback._timer_notify = setTimeout(callback.bind(undefined,value), timeout);\n   return value;\n}\n// Filter array based on property.\nrv.formatters.filter = (array, prop, value) => _.filter(array, (e) => e[prop] === value );\n/* turn current select item into a jquery-ui-selectmenu, update value on change */\nrv.binders.selectmenu = {\n   priority: 101,\n   publishes: true,\n   bind: function (el) {\n      const publish = this.publish,\n         select = $(el);\n      select.selectmenu({\n         classes: {\n           \"ui-selectmenu-button\": \"ui-selectmenu-button ui-state-default\"\n         },\n         change: () => {\n            publish(select.val());\n            select.trigger('change');\n         }\n      });\n   },\n   unbind: (el) => $(el).selectmenu( \"destroy\" ),\n   routine: (el, value) => {\n      el = $(el);\n      el.val(value);\n      if(el.find(\"option[value='\" + value + \"']\").length > 0)\n         el.selectmenu('refresh');\n   }\n};\n\nrv.binders['is-valid-number'] = {\n   priority: 100,\n   publishes: true,\n   bind: function (el) {\n      const prop = this.keypath.split('.')[1];\n      const model = this.model;\n      const $input = $(el);\n      const reg = /^(?!0\\d)\\d*(\\.\\d{1,4})?$/;\n\n      $input.on('input', () => {\n         const val = $input.val();\n         const is_ok = reg.test(val);\n\n         model[prop] = is_ok && val !== '';\n      });\n   },\n   unbind: (el) => { },\n   routine: (el, value) => { }\n}\n\n/* bindar for jqueyr ui selectmenu options */\nrv.binders['dom-*'] = function (el, value) {\n   const method = this.args[0];\n   if(value)\n      setTimeout(() => el[method](), 0);\n};\n\n/* bindar for jqueyr ui selectmenu options */\nrv.binders['selectmenu-*'] = function (el, value) {\n   this.args[0] = {appendto: 'appendTo'}[this.args[0]] || this.args[0];\n   $(el).selectmenu('option', this.args[0], value);\n}\n/*binder for hidding overflow on selctmenu*/\nrv.binders['selectmenu-css-*'] = function(el,value) {\n   $(el).selectmenu(\"menuWidget\").css(this.args[0], value);\n}\n\n/* refersh the selectmenu on array changes */\nrv.binders.selectrefresh = {\n   priority: 99,\n   routine: (el,array_or_value) => {\n      el = $(el);\n      if(typeof array_or_value === 'string') {\n         el.val(array_or_value);\n         if(el.find(\"option[value='\" + array_or_value+ \"']\").length === 0)\n            return;\n      }\n      el.selectmenu('refresh');\n   }\n}\n\n/* Multiselect select menu \"chosen\"*/\nrv.binders.chosen = {\n   priority: 100,\n   publishes: true,\n   bind: function(el){\n      const publish = this.publish;\n     //The disabling overlay element. chosen-disable is defined in main.css\n     //There is no real CSS class webtrader-chosen-disable\n     const disablingElement = $('<div class=\"webtrader-chosen-disable chosen-disable\"></div>');\n     disablingElement.click(e => e.stopPropagation());\n      $(el).chosen({width:$(el).css(\"width\")}).change(function() {\n         publish($(this).val())\n      });\n     $(el).next() //Select the chosen generated element\n      .prepend(disablingElement);\n   },\n   unbind: (el) => $(el).chosen(\"destroy\")\n};\n\n/* binder for chosen refresh */\nrv.binders.chosenrefresh = (el) => $(el).trigger(\"chosen:updated\");\n\n/* binder for disabling chosen */\nrv.binders.chosendisable = (el, value) => {\n  const chosenContainer = $(el).next();\n  const inputElement = chosenContainer.find('.chosen-choices input');\n  const chosenDrop = chosenContainer.find('.chosen-drop');\n  const chosenDisableElement = chosenContainer.find('.webtrader-chosen-disable');\n  if(value) {\n    inputElement.attr('disabled', value);\n    chosenDrop.hide();\n    chosenDisableElement.addClass('chosen-disable');\n  } else {\n    inputElement.removeAttr('disabled');\n    chosenDrop.show();\n    chosenDisableElement.removeClass('chosen-disable');\n  }\n};\n\n/* extend jquery ui spinner to support multiple buttons */\n$.widget('ui.webtrader_spinner', $.ui.spinner, {\n   _buttonHtml: function () {\n      const btn = (dir, icon, step, radius, right) => {\n         icon = 'ui-icon-' + icon + '-1-' + (dir === 'up' ? 'n' : 's');\n         right = 'right: ' + (right || '0px') + ';';\n         radius = radius || '5px';\n         radius = 'border-radius: 0 ' + (dir == 'up' ? radius + ' 0' : '0 ' + radius) + ' 0';\n\n         return \"<button step='\" + step + \"' class='ui-spinner-button ui-spinner-\" + dir +\n            \"' style='\" + right + radius + \"'>\" +\n            \"<span class='ui-icon \" + icon +\"'>&#9650;</span>\" +\n            \"</button>\";\n      }\n\n      let ret = '';\n      ret += btn('up', 'triangle', this.options.step_big || this.options.step, '5px');\n      ret += btn('down', 'triangle', '-' +(this.options.step_big || this.options.step), '5px');\n      return ret;\n   }\n});\n/* turn input element into jquery-ui-spinner, model = {min:, max, value:},\n        the element can have attributes like 'step' and in additoin an new attribute named 'step-big'.\n        the value of these attrebutes will be used to increment/decrement on button press.  */\nrv.binders.spinner = {\n   priority: 98,\n   publishes: true,\n   bind: function (el) {\n      const model = this.model;\n      const publish = this.publish;\n      const input = $(el);\n      input.webtrader_spinner({\n         stop: () => {\n            const value = input.val();\n            publish(value * 1);\n         },\n         spin: function (e,ui) {\n            const step = $(e.currentTarget).attr('step') + '';\n            const decimals = (step.split('.')[1] || []).length;\n            value = $(this).val()*1 + step*1;\n            $(this).val(value.toFixed(decimals));\n            e.preventDefault();\n         },\n         step: input.attr('step') || 1,\n         step_big: input.attr('step-big') || null\n      });\n   },\n   unbind: (el) => $(el).webtrader_spinner('destroy'),\n   routine: (el,value) => $(el).webtrader_spinner('value', value*1)\n};\n\n/* bind to pressing Enter key in input*/\nrv.binders['input-enter'] = {\n   priority: 93,\n   publishes: false,\n   routine: (el, callback) => {\n      $(el).keyup(function(event){\n         if(event.keyCode == 13){\n            callback(el);\n         }\n      });\n   },\n   function: true\n}\n/* bind values to jquery ui spinner options like 'min', 'max', ... */\nrv.binders['spinner-*'] = function(el,value) {\n   $(el).webtrader_spinner('option', this.args[0], value);\n}\n\n/* bindar for jqueyr ui dialog options */\nrv.binders['dialog-*'] = function (el, value) {\n   $(el).dialog('option', this.args[0], value);\n}\nrv.binders['color-picker'] = {\n   priority: 96,\n   publishes: true,\n   bind: function (el) {\n      const input = $(el);\n\n      const publish = this.publish;\n      const model = this.model;\n      const color = model.value || '#cd0a0a';\n\n      const altField = $('<div style=\"width:100%;\"/>');\n      input.after(altField);\n\n      input.colorpicker({\n         showOn: 'alt',\n         altField: altField,\n         position: {\n            my: \"left-100 bottom+5\",\n            of: \"element\",\n            collision: \"fit\"\n         },\n         parts:  [ 'map', 'bar' ],\n         alpha:  true,\n         layout: {\n            map: [0, 0, 2, 2],\n            bar: [2, 0, 1, 2],\n         },\n         colorFormat: \"RGBA\",\n         part: { map: {size: 128}, bar: {size: 128} },\n         select: (event, color) => publish(color)\n      });\n\n      setTimeout(() => {\n         parent = input.scrollParent();\n         parent.scroll(\n            () => input.colorpicker('close')\n         );\n      }, 1000);\n   },\n   unbind: (el) => { },\n   routine: (el, value) => { }\n}\n\nrv.binders.slider = {\n   priority: 95,\n   publishes: true,\n   bind: function (el) {\n      const div = $(el);\n      const handle = $('<div class=\"ui-slider-handle\"></div>');\n      div.append(handle);\n\n      const publish = this.publish;\n      const model = this.model;\n\n      div.slider({\n         step: div.attr('step')*1 || 1,\n         min: div.attr('min') === undefined ? 1 : div.attr('min')*1,\n         max: div.attr('max')*1 || 100,\n         create: function() {\n            handle.text($(this).slider(\"value\"));\n         },\n         slide: ( event, ui ) => {\n            handle.text(ui.value);\n            model.value = ui.value*1;\n         }\n      });\n   },\n   unbind: (el) => $(el).slider('destroy'),\n   routine: (el, value) => {\n      $(el).slider('value', value);\n      $(el).find('> div').text(value);\n   }\n}\n\n/* trun input element in jquery-ui-datepicker */\nrv.binders.datepicker = {\n   priority: 94,\n   publishes: true,\n   bind: function (el) {\n      const input = $(el);\n      const publish = this.publish;\n      const model = this.model;\n      const styles = { marginTop: input.attr('marginTop') || '0px', marginLeft: input.attr('marginLeft') || '0px' };\n\n      const options = {\n         showOn: model.showOn || 'focus',\n         numberOfMonths: input.attr('numberOfMonths')*1 || 2,\n         dateFormat: model.dateFormat || 'yy-mm-dd',\n         showAnim: model.showAnim ||  'drop',\n         showButtonPanel: model.showButtonPanel !== undefined ? model.showButtonPanel : true,\n         changeMonth: model.changeMonth || true,\n         changeYear: model.changeYear || true,\n         onSelect: function () { $(this).change(); },\n         beforeShow: (input, inst) => inst.dpDiv.css(styles),\n         closeText: 'Done'.i18n(),\n         currentText: 'Today'.i18n()\n      };\n      if(model.yearRange)\n         options.yearRange = model.yearRange;\n      else {\n         options.maxDate = model.maxDate || null;\n         options.minDate = model.minDate || 0;\n      }\n\n      const dpicker = input.datepicker(options);\n      input.on('change', () => {\n         const value = input.val();\n         publish(value);\n         input.blur(); // remove focus from input\n      });\n\n      $.datepicker._gotoToday = (id) => {\n         $(id).datepicker('setDate', new Date()).change().datepicker('hide');\n      };\n   },\n   unbind: (el) => $(el).datepicker('destroy'),\n   /* value could be Date() object or a string in yyyy-mm-dd format */\n   routine: (el, value) => $(el).datepicker(\"setDate\", value)\n}\n\n/* truen input element in to jquery-ui-timepicker */\nrv.binders.timepicker = {\n   priority: 93,\n   publishes: true,\n   bind: function (el) {\n      const input = $(el);\n      const publish = this.publish;\n      const model = this.model;\n      const allways_ok = () => true;\n\n      const styles = { marginTop: input.attr('marginTop') || '0px', marginLeft: input.attr('marginLeft') || '0px' };\n      input.on('change', () => {\n         publish(input.val());\n         input.blur();\n      });\n\n      input.timepicker({\n         showPeriod: model.showPeriod || false,\n         showLeadingZero: model.showLeadingZero || true,\n         showCloseButton: model.showCloseButton || true,\n         showNowButton: model.showNowButton || false,\n         onHourShow: model.onHourShow || allways_ok,\n         onMinuteShow: model.onMinuteShow || allways_ok,\n         beforeShow: (input, inst) => inst.tpDiv.css(styles),\n         onSelect: function(){ $(this).change() },\n         hourText: 'Hour'.i18n(),\n         minuteText: 'Minute'.i18n(),\n         amPmText: ['AM'.i18n(), 'PM'.i18n()],\n         closeButtonText: 'Done'.i18n(),\n         nowButtonText: 'Now'.i18n(),\n         deselectButtonText: 'Deselect'.i18n()\n      });\n   },\n   unbind: (el) => $(el).timepicker('destroy'),\n   routine: (el, value) => $(el).val(value)\n}\n\n/* add a css class to corresponding jquery-ui widget from the dummy html element */\nrv.binders['jq-class'] = {\n   priority: 92,\n   routine: (el, value) => {\n      el = $(el);\n      const menu = $('#' + el.attr('id') + '-menu'); // get the id of widget\n      menu.removeClass(el.data('jq-class'));\n      el.data({ 'jq-class': value });\n      menu.addClass(value);\n   }\n}\n\n/* rv binder to active click event on another button when Enter key is pressed */\nrv.binders['input-default-btn'] = (el, jquery_selector) => {\n   $(el).keyup((event) => {\n      if(event.keyCode == 13) {\n         $(jquery_selector).click();\n      }\n   });\n}\n\n/* bindar for css attributes */\nrv.binders['css-*'] = function (el, value) {\n   const style = {};\n   style[this.args[0]] = value;\n   $(el).css(style);\n}\n\n$.fn.getHiddenOffsetWidth = function () {\n   // save a reference to a cloned element that can be measured\n   const $hiddenElement = $(this).clone().appendTo('body');\n   // calculate the width of the clone\n   const width = $hiddenElement.outerWidth();\n   // remove the clone from the DOM\n   $hiddenElement.remove();\n   return width;\n};\n/* scale the font-size to fit the text on the given width*/\nrv.binders['scale-font-size'] = (el, value) => {\n   let cur_font = 14;\n   const $el = $(el);\n   do {\n      el.style.fontSize = cur_font + 'px';\n      cur_font -= 1;\n   } while($el.getHiddenOffsetWidth() > value*1)\n}\n\nrv.binders['show'] = (el, value) => {\n   el.style.display = value ? '' : 'none';\n   return value;\n};\nrv.binders['visible'] = (el, value) => {\n   el.style.visibility = value ? 'visible' : 'hidden';\n   return value;\n};\n/* binder to add or remove disabled attribute */\nrv.binders.disabled = (el,value) => {\n   if(value) $(el).attr('disabled', 'disabled');\n   else $(el).removeAttr('disabled');\n}\n\n/* binder to scroll to buttom automatically */\nrv.binders['auto-scroll-bottom'] = {\n   priority: 91, /* run after native bindings */\n   routine: (el) => {\n      $(el).animate({ scrollTop: el.scrollHeight - $(el).height() }, 'slow');\n   }\n}\n\nfunction remove_all_matches_except_first(string, regex) {\n  let count = 0;\n  const replaceWith = '';\n  return string.replace(regex, (match) => {\n    count++;\n    return count === 1 ? match : replaceWith;\n  });\n}\n\nrv.binders['barrier-format'] = {\n   priority: 3001,\n   routine: (input) => {\n      const $input = $(input);\n      const listener = () => {\n        let val = $input.val();\n        let symbol = '';\n\n        if (val.startsWith('+') || val.startsWith('-')) symbol = val[0];\n        val = remove_all_matches_except_first(val, /\\./g);\n        val = val.replace(/[^\\d.]/g,'');\n        val = symbol + val;\n\n        $input.val(val);\n        $input.trigger('change');\n        return;\n      }\n      input._listener && $input.off('input', input._listener);\n      input._listener = listener;\n      $input.on('input', listener)\n   },\n   getValue: (el) => {\n     console.warn('getValue');\n     return el.value;\n   }\n};\n\nfunction decimalPlaces(num) {\n  const match = (''+num).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\n  let ret = 0;\n  if (match) {\n    ret = Math.max( 0, (match[1] ? match[1].length : 0) - (match[2] ? +match[2] : 0));\n  }\n  return ret;\n}\n\nrv.binders['number-format'] = {\n  priority: 3002,\n  routine: (input, max_nr_of_decimals) => {\n    const $input = $(input);\n    const listener = () => {\n      let val = $input.val();\n      val = remove_all_matches_except_first(val, /\\./g);\n      val = val.replace(/[^\\d.]/g,'');\n\n      if (decimalPlaces(val) > max_nr_of_decimals) val = (+val).toFixed(max_nr_of_decimals);\n\n      $input.val(val);\n      $input.trigger('change');\n      return;\n    }\n    input._listener && $input.off('input', input._listener);\n    input._listener = listener;\n    $input.on('input', listener)\n  }\n};\n\n/* binder with high priority to apply attributes first */\nrv.binders['attr-*'] = {\n   priority: 10*1000,\n   routine: function(el,value) {\n      el.setAttribute(this.args[0],value)\n   }\n}\n\n/* ticks: [ {quote: ''} ] */\nrv.binders['sparkline'] = (el, spots) => {\n   const chart = $(el);\n   const config = {\n      type: 'line',\n      lineColor: '#606060',\n      fillColor: false,\n      spotColor: '#00f000',\n      minSpotColor: '#f00000',\n      maxSpotColor: '#0000f0',\n      highlightSpotColor: '#ffff00',\n      highlightLineColor: '#000000',\n      spotRadius: 1.25\n   };\n   setTimeout(() => {\n      chart.sparkline(spots, config);\n      spots && spots.length ? chart.show() : chart.hide();\n   }, 0);\n}\n\n/* rv binder for indicative color change logic */\nrv.binders['indicative-color'] = (el, value) => {\n   const perv = (el._perv_indicative_color || 0)*1;\n   const red = '#d71818';\n   const green = '#02920e';\n   const black = 'black';\n   if(!$.isNumeric(value)) {\n      $(el).css({color: black});\n   }\n   else if(perv !== value*1) {\n      $(el).css({color: perv < value*1 ? green : red});\n   }\n   el._perv_indicative_color = value;\n}\n\n/******************************** components *****************************/\nconst component_twoway_bind = (self, data, keypathes) => {\n   /* make sure to call async */\n   setTimeout(() => {\n      for(let i = 0; i < keypathes.length; ++i){\n         const keypath = keypathes[i];\n         const key = _.last(keypath.split('.'));\n         const observer = self.observers[key];\n         if(observer) {\n            observer.options.adapters['.'].observe(observer.target, _.last(observer.keypath.split('.')), () => {\n               const updated = observer.target[_.last(observer.keypath.split('.'))];\n               data[key] = updated;\n            });\n            self.componentView.observe(keypath, (value) => observer.setValue(value));\n         }\n      }\n   }, 0);\n}\nrivets.components['price-spinner'] = {\n   static: ['class', 'min'],\n   template:\n   () => `<span class=\"ui-spinner ui-widget ui-widget-content ui-corner-all\" rv-attr-value=\"data.value\">\n               <input rv-class=\"data.class\" type=\"text\" rv-value=\"data.value\" rv-decimal-round=\"data.decimals | or 5\" no-symbol=\"no-symbol\" />\n             </span>`,\n   initialize: function(el, data) {\n      component_twoway_bind(this, data, ['data.value']);\n      //component_twoway_bind(this, data, ['data.decimals']);\n      return {\n         data: data\n      };\n   },\n};\n\nrivets.components['loader-dark'] = {\n  template: () =>\n    `<div class=\"barspinner dark\">\n      <div class=\"rect1\"></div>\n      <div class=\"rect2\"></div>\n      <div class=\"rect3\"></div>\n      <div class=\"rect4\"></div>\n      <div class=\"rect5\"></div>\n    </div>`,\n  initialize: function(el, attributes) {}\n};\n\nexport const bind = (view, state) => rv.bind(view, state);\nexport const formatters = rv.formatters;\nexport const binders = rv.binders;\n\nexport default {\n   bind,\n   formatters,\n   binders\n};\n"]}