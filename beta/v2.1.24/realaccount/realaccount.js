define(["exports","jquery","websockets/binary_websockets","windows/windows","common/rivetsExtra","lodash","moment","navigation/navigation","text!realaccount/realaccount.html","css!realaccount/realaccount.css"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var k=j(b),l=j(c),m=j(d),n=j(e),o=j(f),p=j(g),q=j(h),r=j(i),s=null,t=null,u=null,v=function(a){k["default"].growl.error({message:a.message})},w=a.init=function(a){u=a,a.click(function(){s?s.moveToTop():q["default"].getLandingCompany().then(function(a){return x(r["default"],a)})["catch"](v)})},x=function(a,b){a=k["default"](a).i18n();var c={"upgrade-mlt":"Real Money Account Opening".i18n(),"upgrade-mf":"Financial Account Opening form".i18n()}[b];s=m["default"].createBlankWindow(a,{title:c,resizable:!1,collapsable:!1,minimizable:!0,maximizable:!1,width:360,height:"auto","data-authorized":!0,close:function(){s.dialog("destroy"),s.trigger("dialogclose"),s.remove(),s=null},open:function(){},destroy:function(){t&&t.unbind(),t=null}}),y(a,b),s.dialog("open");var d=s.dialog("widget").offset();d.top=110,s.dialog("option","position",{my:d.left,at:d.top}),s.dialog("widget").css({left:d.left+"px",top:d.top+"px"}),s.fixFooterPosition()},y=function(a,b){var c=(l["default"].app_id,{route:{value:"user"},empty_fields:{validate:!1,clear:o["default"].debounce(function(){c.empty_fields.validate=!1},4e3),show:function(){c.empty_fields.validate=!0,c.empty_fields.clear()}},what_todo:b,input_disabled:!1,risk:{visible:!1},user:{disabled:!1,accepted:"upgrade-mf"===b,salutation:"Mr",salutation_array:["Mr","Mrs","Ms","Miss"],first_name:"",last_name:"",date_of_birth:"",yearRange:"-100:+0",showButtonPanel:!1,residence:"-",residence_name:"-",address_line_1:"",address_line_2:"",city_address:"",state_address:"-",state_address_array:[{text:"-",value:"-"}],address_postcode:"",phone:"",secret_question_inx:5,secret_question_array:["Mother's maiden name","Name of your pet","Name of first love","Memorable town/city","Memorable date","Favourite dish","Brand of first car","Favourite artist"],secret_answer:"",place_of_birth:"-",country_array:[{text:"-",value:"-"}],tax_residence:"",tax_identification_number:""},financial:{experience_array:["0-1 year","1-2 years","Over 3 years"],frequency_array:["0-5 transactions in the past 12 months","6-10 transactions in the past 12 months","40 transactions or more in the past 12 months"],forex_trading_experience:"",forex_trading_frequency:"",indices_trading_experience:"",indices_trading_frequency:"",commodities_trading_experience:"",commodities_trading_frequency:"",stocks_trading_experience:"",stocks_trading_frequency:"",other_derivatives_trading_experience:"",other_derivatives_trading_frequency:"",other_instruments_trading_experience:"",other_instruments_trading_frequency:"",employment_industry_array:["Construction","Education","Finance","Health","Tourism","Other"],employment_industry:"",education_level_array:["Primary","Secondary","Tertiary"],education_level:"",income_source_array:["Salaried Employee","Self-Employed","Investments & Dividends","Pension","Other"],income_source:"",net_income_array:["Less than $25,000","$25,000 - $50,000","$50,001 - $100,000","$100,001 - $500,000","Over $500,000"],net_income:"",estimated_worth_array:["Less than $100,000","$100,000 - $250,000","$250,001 - $500,000","$500,001 - $1,000,000","Over $1,000,000"],estimated_worth:"",occupation_array:["Chief Executives, Senior Officials and Legislators","Managers","Professionals","Clerks","Personal Care, Sales and Service Workers","Agricultural, Forestry and Fishery Workers","Craft, Metal, Electrical and Electronics Workers","Plant and Machine Operators and Assemblers","Mining, Construction, Manufacturing and Transport Workers","Armed Forces","Government Officers","Others"],occupation:"",accepted:!1,disabled:!1}});c.input_disabled=local_storage.get("oauth").reduce(function(a,b){return a||/MLT/.test(b.id)},!1)&&"upgrade-mf"===b,c.user.is_valid=function(){var a=c.user;return""!==a.first_name&&!/[~`!@#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\",<>?\/\d]/.test(a.first_name)&&""!==a.last_name&&!/[~`!@#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\",<>?\/\d]/.test(a.last_name)&&p["default"](a.date_of_birth,"YYYY-MM-DD",!0).isValid()&&"-"!==a.residence&&""!==a.address_line_1&&!/[~`!#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\"<>?]/.test(a.address_line_1)&&!/[~`!#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\"<>?]/.test(a.address_line_2)&&""!==a.city_address&&!/[~`!@#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\",<>?\/\d]/.test(a.city_address)&&/^[^+]{0,20}$/.test(a.address_postcode)&&""!==a.phone&&/^\+?[0-9\s]{6,35}$/.test(a.phone)&&(c.input_disabled||/.{4,8}$/.test(a.secret_answer))&&("upgrade-mf"!=c.what_todo||c.user.place_of_birth&&c.user.tax_residence&&c.user.tax_identification_number&&/^[\w-]{0,20}$/.test(c.user.tax_identification_number))},c.user.click=function(){return c.user.is_valid()?"upgrade-mlt"===c.what_todo?void c.user.new_account_real():void c.route.update("financial"):void c.empty_fields.show()},c.user.new_account_real=function(){var a=c.user,b={new_account_real:1,salutation:a.salutation,first_name:a.first_name,last_name:a.last_name,date_of_birth:a.date_of_birth,residence:a.residence,address_line_1:a.address_line_1,address_line_2:a.address_line_2||void 0,address_city:a.city_address,address_state:a.state_address||void 0,address_postcode:a.address_postcode||void 0,phone:a.phone,secret_question:a.secret_question_array[a.secret_question_inx],secret_answer:a.secret_answer.replace('""',"'")};c.user.disabled=!0,l["default"].send(b).then(function(a){c.user.disabled=!1;var b=a.new_account_real,d=local_storage.get("oauth");return d.push({id:b.client_id,token:b.oauth_token,is_virtual:0}),local_storage.set("oauth",d),k["default"].growl.notice({message:"Account successfully created"}),k["default"].growl.notice({message:"Switching to your new account ..."}),l["default"].switch_account(b.client_id).then(function(){s&&s.dialog("close"),u.hide()})})["catch"](function(a){c.user.disabled=!1,v(a)})},c.financial.all_selected=function(){var a=c.financial;return""!==a.forex_trading_experience&&""!==a.forex_trading_frequency&&""!==a.indices_trading_experience&&""!==a.indices_trading_frequency&&""!==a.commodities_trading_experience&&""!==a.commodities_trading_frequency&&""!==a.stocks_trading_experience&&""!==a.stocks_trading_frequency&&""!==a.other_derivatives_trading_experience&&""!==a.other_derivatives_trading_frequency&&""!==a.other_instruments_trading_experience&&""!==a.other_instruments_trading_frequency&&""!==a.employment_industry&&""!==a.occupation&&""!==a.education_level&&""!==a.income_source&&""!==a.net_income&&""!==a.estimated_worth},c.financial.click=function(){return c.financial.all_selected()?c.financial.accepted?void(c.risk.visible=!0):void k["default"].growl.error({message:"Binary.com terms and conditions unchecked."}):(c.empty_fields.show(),void k["default"].growl.error({message:"Not all financial information are completed"}))},c.financial.create_request=function(){var a=c.user,b=c.financial,d={new_account_maltainvest:1,salutation:a.salutation,first_name:a.first_name,last_name:a.last_name,date_of_birth:a.date_of_birth,residence:a.residence,address_line_1:a.address_line_1,address_line_2:a.address_line_2||void 0,address_city:a.city_address,address_state:a.state_address||void 0,address_postcode:a.address_postcode||void 0,phone:a.phone,place_of_birth:c.user.place_of_birth,tax_residence:c.user.tax_residence.join(","),tax_identification_number:c.user.tax_identification_number,affiliate_token:"",forex_trading_experience:b.forex_trading_experience,forex_trading_frequency:b.forex_trading_frequency,indices_trading_experience:b.indices_trading_experience,indices_trading_frequency:b.indices_trading_frequency,commodities_trading_experience:b.commodities_trading_experience,commodities_trading_frequency:b.commodities_trading_frequency,stocks_trading_experience:b.stocks_trading_experience,stocks_trading_frequency:b.stocks_trading_frequency,other_derivatives_trading_experience:b.other_derivatives_trading_experience,other_derivatives_trading_frequency:b.other_derivatives_trading_frequency,other_instruments_trading_experience:b.other_instruments_trading_experience,other_instruments_trading_frequency:b.other_instruments_trading_frequency,employment_industry:b.employment_industry,occupation:b.occupation,education_level:b.education_level,income_source:b.income_source,net_income:b.net_income,estimated_worth:b.estimated_worth,accept_risk:1};return d},c.financial.new_account_maltainvest=function(){c.financial.create_request()},c.risk.accept=function(){var a=c.financial.create_request();c.input_disabled||(a.secret_question=c.user.secret_question_array[c.user.secret_question_inx],a.secret_answer=c.user.secret_answer),c.risk.visible=!1,c.financial.disabled=!0,l["default"].send(a).then(function(a){var b=a.new_account_maltainvest,c=local_storage.get("oauth");return c.push({id:b.client_id,token:b.oauth_token,is_virtual:0}),local_storage.set("oauth",c),k["default"].growl.notice({message:"Account successfully created"}),k["default"].growl.notice({message:"Switching to your new account ..."}),l["default"].switch_account(b.client_id).then(function(){s&&s.dialog("close"),u.hide()})})["catch"](function(a){c.financial.disabled=!1,v(a)})},c.risk.decline=function(){c.risk.visible=!1},c.route.update=function(a){var b={user:1010,financial:1540};c.route.value=a,s.dialog("option","height",b[a]),s.dialog("widget").trigger("dialogresizestop")},t=n["default"].bind(a[0],c);var d=l["default"].send({get_settings:1}).then(function(a){a=a.get_settings,c.user.salutation=a.salutation||c.user.salutation,c.user.first_name=a.first_name||"",c.user.last_name=a.last_name||"",c.user.date_of_birth=a.date_of_birth?p["default"].unix(a.date_of_birth).format("YYYY-MM-DD"):p["default"]().subtract(18,"years").format("YYYY-MM-DD"),c.user.address_line_1=a.address_line_1||"",c.user.address_line_2=a.address_line_2||"",c.user.city_address=a.address_city||"",c.user.state_address=a.address_state||"",c.user.address_postcode=a.address_postcode||"",c.user.phone=a.phone||"",c.user.residence=a.country_code||"",c.user.residence_name=a.country||""})["catch"](v);d.then(function(){return l["default"].cached.send({residence_list:1})}).then(function(a){c.user.country_array=a.residence_list,c.user.place_of_birth=a.residence_list[0].value;var b=o["default"].find(a.residence_list,{value:c.user.residence});c.user.phone=c.user.phone?c.user.phone:"+"+b.phone_idd})["catch"](v),d.then(function(){return l["default"].cached.send({states_list:c.user.residence})}).then(function(a){c.user.state_address_array=a.states_list,c.user.state_address=a.states_list[0].value})["catch"](v)};a["default"]={init:w}});