{"version":3,"sources":["../../../../src/chrome/chrome.es6"],"names":["win","setTimeout","check","chrome_ls","local_storage","get","show","accepted_or_cancel_time","diff","utc","valueOf","window","chrome","webstore","length","moveToTop","$html","i18n","createBlankWindow","dialogClass","width","height","resizable","collapsable","minimizable","maximizable","modal","ignoreTileAction","find","on","dialog","install","set","append","event_on"],"mappings":";;;;;;;;;;;;;;;;;;;;;AASA,OAAIA,MAAM,IAAV;AACA;AAVA;;;AAWAC,cAAW,YAAM;AACd;AACA,UAAMC,QAAQ,SAARA,KAAQ,GAAM;AACjB,aAAMC,YAAYC,cAAcC,GAAd,CAAkB,QAAlB,CAAlB;AACA,aAAKC,OAAO,CAACH,SAAb;;AAEA,aAAG,CAACG,IAAJ,EAAU;AACP,gBAAMC,0BAA0BJ,UAAUI,uBAA1C;AACAD,mBAAO,CAACC,uBAAR;AACA,gBAAI,CAACD,IAAL,EAAW;AACR,mBAAME,OAAQ,iBAAOC,GAAP,GAAaC,OAAb,KAAyBH,uBAAvC;AACAD,sBAAQE,QAAS,IAAI,EAAJ,GAAS,EAAT,GAAc,EAAd,GAAmB,IAApC,CAFQ,CAEmC;AAC7C;AACH;AACD,gBAAOF,IAAP;AACF,OAbD;;AAeA,UAAMA,OAAOJ,OAAb;AACA,UAAII,QAAQK,OAAOC,MAAf,IAAyBA,OAAOC,QAAhC,IAA4C,sBAAE,mCAAF,EAAuCC,MAAvC,IAAiD,CAAjG,EAAoG;AACjG,aAAId,GAAJ,EAAS;AACNA,gBAAIe,SAAJ;AACA;AACF;AACD,aAAMC,QAAQ,wCAAQC,IAAR,EAAd;AACAjB,eAAM,kBAAQkB,iBAAR,CAA0BF,KAA1B,EACH;AACGG,yBAAa,gBADhB;AAEGC,mBAAO,GAFV;AAGGC,oBAAQ,GAHX;AAIGC,uBAAW,KAJd;AAKGC,yBAAa,KALhB;AAMGC,yBAAa,KANhB;AAOGC,yBAAa,KAPhB;AAQGC,mBAAO,IARV;AASGC,8BAAiB;AATpB,UADG,CAAN;;AAaAX,eAAMY,IAAN,CAAW,QAAX,EAAqBC,EAArB,CAAwB,OAAxB,EAAiC,YAAM;AACpC7B,gBAAI8B,MAAJ,CAAY,OAAZ;AACAlB,mBAAOC,QAAP,CAAgBkB,OAAhB;AACA3B,0BAAc4B,GAAd,CAAkB,QAAlB,EAA4B,EAAEzB,yBAA0B,iBAAOE,GAAP,GAAaC,OAAb,EAA5B,EAA5B;AACF,UAJD;AAKAM,eAAMY,IAAN,CAAW,SAAX,EAAsBC,EAAtB,CAAyB,OAAzB,EAAkC,YAAM;AACrC7B,gBAAI8B,MAAJ,CAAY,OAAZ;AACA1B,0BAAc4B,GAAd,CAAkB,QAAlB,EAA4B,EAAEzB,yBAA0B,iBAAOE,GAAP,GAAaC,OAAb,EAA5B,EAA5B;AACF,UAHD;;AAKA;AACA,+BAAE,MAAF,EAAUuB,MAAV,CAAiBjC,IAAI8B,MAAJ,CAAW,QAAX,CAAjB;AACA9B,aAAI8B,MAAJ,CAAW,MAAX;AAEF;AACH,IApDD,EAoDG,IApDH;;AAsDA;;;;;;AAMA,qBAAQI,QAAR,CAAiB,MAAjB,EAAyB,YAAM;AAC5B,UAAIlC,OAAOA,IAAI8B,MAAJ,CAAW,QAAX,CAAX,EAAiC;AAC9B9B,aAAI8B,MAAJ,CAAW,OAAX;AACA9B,aAAIe,SAAJ;AACF;AACH,IALD;;qBAOe,E","file":"chrome.js","sourcesContent":["/**\n * Created by arnab on 5/6/16.\n */\nimport $ from 'jquery';\nimport windows from '../windows/windows';\nimport moment from 'moment';\nimport '../common/util';\nimport html from 'text!./chrome.html';\n\nlet win = null;\n//Trigger after 1 second - Give the injector some time to inject the DOM element\nsetTimeout(() => {\n   //Display it with diminishing frequency. E.g. in a day after first cancel, in a week after second, then once a month.\n   const check = () => {\n      const chrome_ls = local_storage.get(\"chrome\");\n      let  show = !chrome_ls;\n\n      if(!show) {\n         const accepted_or_cancel_time = chrome_ls.accepted_or_cancel_time;\n         show = !accepted_or_cancel_time;\n         if (!show) {\n            const diff = (moment.utc().valueOf() - accepted_or_cancel_time);\n            show = (diff >= (7 * 24 * 60 * 60 * 1000));//if one week elapsed\n         }\n      }\n      return show;\n   };\n\n   const show = check();\n   if (show && window.chrome && chrome.webstore && $('#webtrader-extension-is-installed').length <= 0) {\n      if (win) {\n         win.moveToTop();\n         return;\n      }\n      const $html = $(html).i18n();\n      win = windows.createBlankWindow($html,\n         {\n            dialogClass: \"dialog-confirm\",\n            width: 350,\n            height: 150,\n            resizable: false,\n            collapsable: false,\n            minimizable: false,\n            maximizable: false,\n            modal: true,\n            ignoreTileAction:true\n         });\n\n      $html.find(\"#apply\").on(\"click\", () => {\n         win.dialog( 'close' );\n         chrome.webstore.install();\n         local_storage.set(\"chrome\", { accepted_or_cancel_time : moment.utc().valueOf() });\n      });\n      $html.find(\"#cancel\").on(\"click\", () => {\n         win.dialog( 'close' );\n         local_storage.set(\"chrome\", { accepted_or_cancel_time : moment.utc().valueOf() });\n      });\n\n      //This helps in showing multiple dialog windows in modal form\n      $('body').append(win.dialog('widget'));\n      win.dialog('open');\n\n   }\n}, 5000);\n\n/*\nThis is needed in order to bring back the modality of the dialog when the page is loaded first time. Since this dialog might be loaded way before\nchart dialogs are loaded, what have been found that, when charts are loaded later(after this is shown), the modality of this dialog is lost. However,\nif we close and reopen this dialog after tile is called, the modality is restored. In an ideal scenario, users won't be able to do anything when this\ndialog is shown because this is a blocking dialog.\n*/\nwindows.event_on(\"tile\", () => {\n   if (win && win.dialog('isOpen')) {\n      win.dialog('close');\n      win.moveToTop();\n   }\n});\n\nexport default {}\n"]}