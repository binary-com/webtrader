{"version":3,"sources":["../../../../src/cashier/withdraw.es6"],"names":["require","win","win_view","error_handler","console","error","err","growl","message","Withdraw","init","li","click","cached","authorize","then","data","currency","check_currency","_init_win","catch","moveToTop","root","i18n","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","width","height","close","dialog","trigger","remove","open","destroy","unbind","_init_state","offset","top","my","left","at","css","fixFooterPosition","track","module_id","is_unique","state","route","value","empty_fields","validate","token_length","clear","debounce","show","validateLength","verify","token","length","menu","choice","code","disabled","transfer","account","amount","loginid","local_storage","get","standard","url","iframe_visible","agent","name","agents","commission","residence","instructions","checkAmount","e","scope","login_details","Cookies","loginids","reduce","a","b","id","routes","update","r","email","type","send","verify_email","notice","back","unlock","cashier","verification_code","startsWith","Error","iframe_loaded","onchanged","find","paymentagent_loginid","withdrawal_commission","amount_with_commission","with_commission","toFixed","confirm_transfer","request","paymentagent_withdraw","submit","req","transfer_between_accounts","account_from","account_to","get_settings","country_code","paymentagent_list","list","payout_currencies","bind"],"mappings":"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","file":"withdraw.js","sourcesContent":["/*\n * Created by amin on July 16, 2016.\n */\n\nimport $ from 'jquery';\nimport liveapi from 'websockets/binary_websockets';\nimport windows from 'windows/windows';\nimport rv from 'common/rivetsExtra';\nimport currencyDialog from 'cashier/currency';\nimport _ from 'lodash';\nimport moment from 'moment';\n\nrequire(['text!cashier/withdraw.html']);\nrequire(['css!cashier/withdraw.css']);\n\nlet win = null;\nlet win_view = null;\n\nlet error_handler = err => {\n  console.error(err);\n  $.growl.error({ message: err.message });\n};\n\nclass Withdraw {\n  init = li => {\n    li.click(() => {\n        if(!win) {\n          liveapi.cached.authorize().then(data => {\n            if(!data.authorize.currency) // if currency is not set ask for currency\n              return currencyDialog.check_currency();\n            return true; // OK\n          })\n          .then(() => require(['text!cashier/withdraw.html'], this._init_win))\n          .catch(error_handler);\n        }\n        else\n          win.moveToTop();\n    });\n  }\n\n  _init_win = root => {\n    root = $(root).i18n();\n    win = windows.createBlankWindow(root, {\n        title: 'Withdraw funds',\n        resizable: true,\n        collapsable: false,\n        minimizable: true,\n        maximizable: true,\n        width: 700,\n        height: 400,\n        'data-authorized': true,\n        close: () => {\n          win.dialog('destroy');\n          win.trigger('dialogclose'); // TODO: figure out why event is not fired.\n          win.remove();\n          win = null;\n        },\n        open: () => { },\n        destroy: () => {\n          win_view && win_view.unbind();\n          win_view = null;\n        }\n    });\n\n    this._init_state(root);\n    win.dialog('open');\n\n    /* update dialog position, this way when dialog is resized it will not move*/\n    var offset = win.dialog('widget').offset();\n    offset.top = 110;\n    win.dialog(\"option\", \"position\", { my: offset.left, at: offset.top });\n    win.dialog('widget').css({\n        left: offset.left + 'px',\n        top: offset.top + 'px'\n    });\n    win.fixFooterPosition();\n    win.track({\n      module_id: 'withdraw',\n      is_unique: true\n    });\n  };\n\n  _init_state = root => {\n    var state = {\n      route: { value: 'menu'},\n      empty_fields: {\n        validate: false,\n        token_length:false,\n        clear: _.debounce(() => { state.empty_fields.validate = false; state.empty_fields.token_length = false}, 4000),\n        show: () => {\n          state.empty_fields.validate = true;\n          state.empty_fields.clear();\n        },\n        validateLength: () => {\n          if(state.verify.token.length != 48){\n            state.empty_fields.token_length = true;\n            state.empty_fields.clear();\n            return false;\n          }\n          return true;\n        }\n      },\n      menu: {\n        choice: ''\n      },\n      verify: {\n        token: '',\n        code: '',\n        disabled: false,\n      },\n      transfer: {\n        disabled: false,\n        account: '',\n        amount: '',\n        loginid: local_storage.get('authorize').loginid,\n      },\n      standard: {\n        url: '',\n        iframe_visible: false\n      },\n      agent: {\n        disabled: false,\n        loginid: '',\n        name: '',\n        agents: [],\n        commission: '',\n        amount: '',\n        currency: local_storage.get('authorize').currency,\n        residence: '',\n        instructions: '',\n        checkAmount: (e,scope) => {\n          const amount = scope.agent.amount;\n          if(amount == ''){\n            return;\n          }\n          if(amount > 2000) {\n            scope.agent.amount = 2000;\n          } \n          if(amount < 0) {\n            scope.agent.amount = '';\n          }\n        }\n      },\n      login_details: Cookies.loginids().reduce(function(a,b){if(a.id == local_storage.get(\"authorize\").loginid)return a;else return b})\n    };\n    let {route, menu, verify, empty_fields, standard, agent, transfer} = state;\n\n    let routes = { menu : 400, verify: 400, transfer: 400, 'transfer-done': 300, standard: 400, agent: 550, 'agent-confirm': 400, 'agent-done': 300 };\n    route.update = r => {\n      route.value = r;\n      win.dialog('option', 'height', routes[r]);\n    };\n\n    menu.click = choice => { /* choice is 'transfer', 'agent' or 'standard' */\n      menu.choice = choice;\n      route.update(choice !== 'transfer' ? 'verify' : 'transfer');\n      if(choice === 'transfer')\n        return;\n      const email = local_storage.get('authorize').email;\n      const type = choice === 'agent' ? 'paymentagent_withdraw' : 'payment_withdraw';\n      liveapi.send({\n        verify_email: email,\n        type: type\n      })\n      .then(() => $.growl.notice({ message: 'Verification code sent to '.i18n() + email }))\n      .catch(err => {\n        error_handler(err);\n        route.update('menu');\n      });\n    };\n\n    verify.back = () => {\n      verify.token = verify.code = '';\n      route.update('menu');\n    };\n\n    verify.unlock = () => {\n      if(!verify.token) {\n        empty_fields.show();\n        return;\n      }\n\n      if(!empty_fields.validateLength()){\n        return;\n      }\n\n      if(menu.choice === 'standard') {\n        verify.disabled = true;\n        liveapi.send({\n          cashier: 'withdraw',\n          verification_code: verify.token\n        })\n        .then(data => {\n          if(data.cashier.startsWith('ASK_')) { /* error code */\n            throw new Error(data.cashier);\n          }\n          standard.url = data.cashier;\n          verify.disabled = false;\n          route.update('standard');\n          verify.code = verify.token;\n          verify.token = '';\n        })\n        .catch(err => {\n          verify.disabled = false;\n          error_handler(err);\n        });\n      }\n      else if(menu.choice == 'agent') {\n        verify.code = verify.token;\n        verify.token = '';\n        route.update('agent');\n      }\n    };\n\n    standard.iframe_loaded = () => {\n      if(standard.url)\n        standard.iframe_visible = true;\n    };\n\n    agent.onchanged = () => {\n      if(agent.loginid) {\n        let {withdrawal_commission, name} = agent.agents.find(a => a.paymentagent_loginid == agent.loginid);\n        agent.commission = withdrawal_commission;\n        agent.name = name;\n      }\n      else {\n        agent.commission = '';\n        agent.name = '';\n      }\n    }\n\n    agent.amount_with_commission = () => {\n        var with_commission = (agent.amount || 0)*(100 - agent.commission)/100;\n        return with_commission.toFixed(2);\n    }\n\n    agent.click = () => {\n      if(!agent.loginid) {\n        $.growl.error({message: 'Please select a payment agent'.i18n()});\n        return;\n      }\n      if(!(agent.amount >= 10 && agent.amount <= 2000)) {\n        $.growl.error({message: 'Amount Min: 10 Max: 2000'.i18n()});\n        return;\n      }\n      if(!agent.instructions) {\n        empty_fields.show();\n        return;\n      }\n\n      route.update('agent-confirm');\n    }\n\n    agent.confirm_transfer = () => {\n      var request = {\n        paymentagent_withdraw: 1,\n        paymentagent_loginid: agent.loginid,\n        currency: agent.currency,\n        amount: agent.amount*1,\n        verification_code: verify.code\n      };\n      agent.disabled = true;\n      liveapi.send(request)\n             .then(data => {\n               route.update('agent-done')\n               agent.disabled = false;\n             })\n             .catch(err => {\n                agent.disabled = false;\n                route.update('menu') // because tokens are one time use.\n                error_handler(err);\n             });\n    }\n\n    transfer.submit = () => {\n      if(transfer.account === '' || transfer.amount === '') {\n        empty_fields.show();\n        return;\n      }\n      var req = {\n        transfer_between_accounts: 1,\n        account_from: transfer.loginid,\n        account_to: transfer.account,\n        currency: agent.currency,\n        amount: transfer.amount\n      };\n      transfer.disabled = true;\n      liveapi.send(req)\n        .then(data => {\n          if(data.transfer_between_accounts === 0) {\n            $.growl.error({message: 'Transfering funds between accounts failed'.i18n() });\n            return;\n          }\n          route.update('transfer-done');\n        })\n        .catch(err => {\n          error_handler(err);\n          transfer.disabled = false;\n        });\n    }\n\n    liveapi.send({get_settings: 1})\n           .then(data => {\n             agent.residence = data.get_settings.country_code;\n             return liveapi.cached.send({paymentagent_list: agent.residence });\n           })\n           .then(data => {\n             agent.agents = data.paymentagent_list.list;\n           })\n           .catch(error_handler);\n\n    liveapi.send({payout_currencies: 1})\n        .then(data => {\n            agent.currency = data.payout_currencies[0];\n        }).catch(err => console.error(err));\n\n    win_view = rv.bind(root[0], state);\n  };\n};\n\nexport default new Withdraw();\n"]}