{"version":3,"sources":["../../../../src/windows/windows.es6"],"names":["closeAllObject","dialogCounter","$menuUL","last_dialog","calculateChartCount","options","extend","width","height","rows","Math","floor","window","cols","isSmallView","total","shuffle","array","temp","rand_inx","inx","length","random","callbacks","fire_event","name","args","fns","forEach","cb","setTimeout","apply","undefined","tileDialogs","dialogs","filter","d","$d","hasClass","dialog","arrange","perform","total_free_space","max_x","y","is","inx_start","row_height","x","w","h","max","free_space","margin_left","j","animate","left","top","trigger","bind","my","at","best","best_free_space","i","slice","largeDialogs","push","addDateToHeader","title","date","changed","cleared","header","parent","find","addClass","addDateDropDowns","opts","numberOfDays","year","month","isLeap","update","select","render","v","children","remove","min","val","text","appendTo","initial","selectmenu","_title","prependTo","updating","value","dt","Date","insertAfter","day","getFullYear","getMonth","getDate","trigger_change","yyyy_mm_dd","UTC","toISOString","onchange","on","update_day","split","clear","addDatePicker","dpicker_input","add_clear_button","input","button_pane","datepicker","i18n","click","onclear","showOn","numberOfMonths","maxDate","minDate","dateFormat","showAnim","showButtonPanel","changeMonth","changeYear","onSelect","change","beforeShow","inst","dpDiv","css","marginTop","marginLeft","onChangeMonthYear","closeText","currentText","dpicker","_gotoToday","id","next","button","icons","primary","dropdonws","getScrollHeight","without_body","bottoms","map","$w","offset","fixMinimizedDialogsPosition","footer_height","scroll_bottom","document","scrollTop","init","$parentObj","original","fn","cmd","call","arguments","tileObject","require","chartWindowObj","liveapi","menu","is_empty","reopen","counts","cached","send","trading_times","then","markets","extractChartableMarkets","rand","arr","timePeriods","chartTypes","submarkets","symbols","instruments","sym","timePeriod","chart_type","addNewWindow","instrumentCode","symbol","instrumentName","display_name","type","delayAmount","delay_amount","local_storage","get","oauth","Promise","all","authorize","acc","token","req","results","data","unshift","is_jpy_account","loginid","is_virtual","landing_company_name","indexOf","set","invalidate","growl","error","message","duration","catch","err","code","ele","match","switch_account","console","scroll","closeAll","createBlankWindow","$html","autoOpen","resizable","collapsable","of","hide","close","minimize","maximize","open","promise","done","changePos","pos","parseInt","minWidth","minHeight","resize","restore","blankWindow","attr","ignoreTileAction","dialogExtend","draggable","destroy","moveToTop","effect","times","distance","li","add_to_windows_menu","link","html","append","attributes","Object","keys","key","startsWith","refresh","track","makeSelectmenu","list","update_select","update_list","new_list","event_on","event_off","index","splice","tile"],"mappings":"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","file":"windows.js","sourcesContent":["\n/**\n * Created by arnab on 2/18/15.\n */\n\nimport $ from 'jquery';\nimport _ from 'lodash';\nimport navigation from 'navigation/navigation';\nimport tracker from 'windows/tracker';\nimport 'jquery.dialogextend';\nimport 'modernizr';\nimport 'common/util';\nimport 'css!windows/windows.css';\n\nlet closeAllObject = null, dialogCounter = 0, $menuUL = null, last_dialog = null;\n\n/* options: { width: 350, height: 400 } */\nconst calculateChartCount = (options) => {\n   options = $.extend({ width: 350, height: 400 }, options);\n   let rows = Math.floor($(window).height() / options.height) || 1,\n      cols = Math.floor($(window).width() / options.width) || 1;\n\n   if (isSmallView()) //For small size screens\n      rows = cols = 1;\n   /**** limi the number of charts to 4 ****/\n   if(rows * cols > 4) {\n      rows = 1;\n      cols = 4;\n   };\n   return {\n      rows: rows,\n      cols: cols,\n      total: rows * cols\n   };\n}\n\n/* shuffle the given array */\nconst shuffle = (array) => {\n   let temp, rand_inx;\n\n   for (let inx = array.length; inx > 0;) {\n      rand_inx = Math.floor(Math.random() * inx);\n      --inx;\n      temp = array[inx];\n      array[inx] = array[rand_inx];\n      array[rand_inx] = temp;\n   }\n\n   return array;\n}\n\nlet callbacks = {};\n/* fire a custom event and call registered callbacks(api.events.on(name)) */\nconst fire_event = (name , ...args) => {\n   const fns = callbacks[name] || [];\n   fns.forEach(function (cb) {\n      setTimeout(function(){\n         cb.apply(undefined, args);\n      },0);\n   });\n}\n\nconst tileDialogs = () => {\n   // get array of dialogs\n   var dialogs = $('.webtrader-dialog').filter((inx, d) => {\n      /* check to see if initialized and is visible */\n      const $d = $(d);\n      return $d.hasClass(\"ui-dialog-content\") && $d.dialog(\"isOpen\") &&\n            !$d.hasClass('ui-dialog-minimized') && ($(window).width() >= $d.dialog('option', 'width'));\n   });\n\n\n   const arrange = (dialogs, perform) => {\n      let total_free_space = 0;\n\n      const max_x = $(window).width();\n      let y = 110; // position of the next window from top\n      if($(\"#msg-notification\").is(\":visible\"))\n            y = 150;\n\n      for (var inx = 0; inx < dialogs.length;) {\n         var inx_start = inx;\n         var row_height = 0; // height of the current row of dialogs\n         var x = 0; // positon of the next window from left\n\n         for (;/* see which which dialogs fit into current row */;) {\n            if (inx == dialogs.length)\n               break;\n            const d = $(dialogs[inx]);\n            const w = d.dialog('option', 'width'),\n               h = d.dialog('option', 'height');\n            row_height = Math.max(row_height, h);\n            if (x + w <= max_x) {\n               x += w;\n               ++inx;\n            }\n            else\n               break;\n         }\n\n         /* divide the vertical space equally between dialogs. */\n         const free_space = x < max_x ? (max_x - x) : 0;\n         let margin_left = x < max_x ? (max_x - x) / (inx - inx_start + 1) : 0; /* the current window might be wider than screen width */\n         if(inx != dialogs.length) { /* we don't care about extra space at last row */\n            total_free_space += free_space;\n         }\n         if (x === 0 && $(dialogs[inx]).dialog('option', 'width') > max_x) {\n            ++inx;\n            margin_left = 0;\n         };\n         x = 0;\n         for (var j = inx_start; j < inx; ++j) {\n            x += margin_left;\n            const d = $(dialogs[j]);\n            const w = d.dialog('option', 'width'),\n               h = d.dialog('option', 'height');\n\n            if(perform) /* are we testing or do we want to arrange elements */\n               d.dialog('widget').animate({\n                  left: x + 'px',\n                  top: y + 'px'\n               }, 1500, d.trigger.bind(d, 'animated'));\n            /* update dialog option.position */\n            d.dialog(\"option\", \"position\", { my: x, at: y });\n            x += w;\n         };\n         y += row_height + 20;\n      }\n      return total_free_space;\n   }\n\n   /* we will try 100 different arrangements and pick the best one */\n   let best = null,\n      best_free_space = 1000*1000;\n   for (var i = 0; i < 100; ++i) {\n      shuffle(dialogs); // shuffle dialogs\n      var total_free_space = arrange(dialogs, false);\n      if (total_free_space < best_free_space) {\n         best = dialogs.slice(); // clone the array\n         best_free_space = total_free_space;\n      }\n   }\n   // get array of large dialogs (larger than window size)\n   const largeDialogs = $('.webtrader-dialog').filter(function (inx, d) {\n      /* check to see if initialized and is visible */\n      const $d = $(d);\n      return $d.hasClass(\"ui-dialog-content\") && $d.dialog(\"isOpen\") && !$d.hasClass('ui-dialog-minimized') && ($(window).width() < $d.dialog('option', 'width'));\n   });\n   _(largeDialogs).forEach(function (d) {\n      best.push(d);\n   });\n   arrange(best, true);\n   //Do not track last dialog after re-arranging dialogs\n   last_dialog = null;\n   //Trigger tile when the animation is done\n   setTimeout(() => fire_event(\"tile\"), 1500 + 100);\n}\n\n/*\n     @param: options.date    javascript Date object representing initial time\n     @param: options.title   the header title for spinners\n     @param: options.changed  called when Date changes, callback argument is a string in yyyy_mm_dd format.\n   useage:\n      var win = createBlankWindow(...);\n      win.addDateToHeader({date:new Date(), title: 'sub header', changed: fn});\n      */\nconst addDateToHeader = function(options) {\n   options = $.extend({\n      title: 'title',\n      date: null,\n      changed: () => { },\n      cleared: () => { }\n   },options);\n\n   const header = this.parent().find('.ui-dialog-title').addClass('with-content');\n\n\n   /* options: {date: date, onchange: fn } */\n   const addDateDropDowns = (opts) => {\n      // note that month is 0-based, like in the Date object. Adjust if necessary.\n      const numberOfDays = (year, month) => {\n         var isLeap = ((year % 4) == 0 && ((year % 100) != 0 || (year % 400) == 0));\n         return [31, (isLeap ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];\n      }\n\n      const update = function(select, options) {\n         var render = options.render || (v => v + '');\n         select.children().remove();\n         /* add the title */\n         for (let i = options.min; i <= options.max; ++i)\n            $('<option/>').val(i).text(render(i)).appendTo(select);\n         select.val(options.initial || options.min);\n         select.selectmenu('refresh');\n\n         select.title = select.title || (function(text) {\n            if (text) {\n               select._title = select._title || $('<option/>').val(-1).prependTo(select);\n               select._title.text(text);\n               select.updating = true;\n               select.val(-1).selectmenu('refresh');\n               select.updating = false;\n            }\n            else {\n               if (select._title) {\n                  const value = select.val() === -1 ? options.initial : select.val();\n                  select._title.remove();\n                  select.updating = true;\n                  select.val(value).selectmenu('refresh');\n                  select.updating = false;\n                  this._title = null;\n               }\n            }\n         });\n\n         return select;\n      }\n\n      const dt = opts.date || new Date();\n      let year = $('<select />').insertAfter(header).selectmenu({ width: 'auto' });\n      let month = $('<select />').insertAfter(header).selectmenu({ width: 'auto' });\n      let day = $('<select />').insertAfter(header).selectmenu({ width: 'auto'});\n      day.selectmenu( \"menuWidget\" ).addClass('date-day');\n      year = update(year, { min: 2010, max: dt.getFullYear(), initial: dt.getFullYear()});\n      month = update(month, {\n         min: 0, max: 11, initial: dt.getMonth(),\n         render: (inx) => ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'][inx]\n      });\n      day = update(day, { min: 1, max: numberOfDays(dt.getFullYear(),dt.getMonth()), initial: dt.getDate()});\n\n      /* add title elements if no date is specified */\n      if (!opts.date) {\n         year.title('Year');\n         month.title('Month');\n         day.title('Day');\n      }\n\n      const trigger_change = () => {\n         /* TODO: search other files and make sure to use a UTC date */\n         const yyyy_mm_dd = new Date(Date.UTC(year.val(), month.val(), day.val())).toISOString().slice(0, 10);\n         opts.onchange(yyyy_mm_dd);\n      }\n      day.on('selectmenuchange', () => {\n         if (day.updating) {\n            return;\n         }\n         day.title(null);\n         month.title(null);\n         year.title(null);\n\n         trigger_change();\n      });\n\n      const update_day = () => {\n         const options = { min: 1, max: numberOfDays(year.val(), month.val()), initial: day.val() };\n         if (options.initial > options.max)\n            options.initial = options.min;\n         update(day, options);\n      };\n\n      [year, month].forEach(function (select) {\n         select.on('selectmenuchange', function () {\n            if (month.updating || year.updating) return;\n            day.title(null);\n            month.title(null);\n            year.title(null);\n            update_day();\n            trigger_change();\n         });\n      })\n      return {\n         update: (yyyy_mm_dd) => {\n            day.title(null);\n            month.title(null);\n            year.title(null);\n            var args = yyyy_mm_dd.split('-');\n            year.val(args[0] | 0); year.selectmenu('refresh');\n            month.val((args[1] | 0)-1); month.selectmenu('refresh');\n            day.val(args[2] | 0); update_day();\n         },\n         clear: () => {\n            year.title('Year');\n            month.title('Month');\n            day.title('Day');\n         }\n      };\n   }\n\n   /* options: {date: date, onchange: fn} , events => element.on('change',...) */\n   const addDatePicker = (opts) => {\n      const dpicker_input = $(\"<input type='hidden' />\")\n         .insertAfter(header);\n      const add_clear_button = (input) => {\n         /* Run this after date-picker is constructed\n                Source: stackoverflow.com/questions/4598850 */\n         setTimeout(() => {\n            const button_pane = $(input)\n               .datepicker('widget')\n               .find('.ui-datepicker-buttonpane');\n\n            $('<button/>', {\n               text: 'Clear'.i18n(),\n               click: function () {\n                  opts.onclear && opts.onclear();\n                  $(input).datepicker('hide');\n               }\n            })\n               .addClass('ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all')\n               .appendTo(button_pane);\n         }, 0);\n      };\n\n      var options = {\n         showOn: 'both',\n         numberOfMonths: 1,\n         maxDate: 0,\n         minDate: new Date(2010, 0, 1),\n         dateFormat: 'yy-mm-dd',\n         showAnim: 'drop',\n         showButtonPanel: true,\n         changeMonth: true,\n         changeYear: true,\n         onSelect: function () { $(this).change(); },\n         beforeShow: (input, inst) => {\n            add_clear_button(input);\n            inst.dpDiv.css({ marginTop: '10px', marginLeft: '-220px' });\n         },\n         onChangeMonthYear:add_clear_button,\n         closeText: 'Done'.i18n(),\n         currentText: 'Today'.i18n()\n      };\n\n      const dpicker = dpicker_input\n         .datepicker(options)\n         .datepicker(\"setDate\", opts.date.toISOString().slice(0, 10));\n\n      $.datepicker._gotoToday = (id) => {\n         $(id).datepicker('setDate', new Date()).change().datepicker('hide');\n      };\n\n      /* use JQ-UI icon for datepicker */\n      dpicker .next('button') .text('')\n         .button({ icons: { primary: 'ui-icon-calendar' } });\n\n      dpicker_input.on('change', function () {\n         const yyyy_mm_dd = $(this).val();\n         opts.onchange && opts.onchange(yyyy_mm_dd);\n      });\n      return dpicker_input;\n   }\n\n\n   const dpicker = addDatePicker({\n      date: options.date || new Date(),\n      onchange: (yyyy_mm_dd) => {\n         dropdonws.update(yyyy_mm_dd);\n         options.changed(yyyy_mm_dd);\n      },\n      onclear: () => {\n         dropdonws.clear();\n         options.cleared();\n      }\n   });\n   const dropdonws = addDateDropDowns({\n      date: options.date, onchange: (yyyy_mm_dd) => {\n         dpicker.datepicker(\"setDate\", yyyy_mm_dd);\n         options.changed(yyyy_mm_dd);\n      }\n   });\n\n   $('<span class=\"span-in-dialog-header\">' + options.title + '</span>').insertAfter(header);\n\n   return {\n      clear:() => dropdonws.clear()\n   };\n}\n\nconst getScrollHeight = (without_body) => {\n   var bottoms = $('.ui-dialog').map((inx, d) => {\n      const $d = $(d);\n      const $w = $d.find('.webtrader-dialog');\n      if($w && $w.hasClass(\"ui-dialog-content\") && !$w.hasClass('ui-dialog-minimized')) {\n         const offset = $d.offset();\n         return (offset && (offset.top + $d.height())) || 0;\n      }\n      return 0;\n   });\n   if(!without_body) {\n      bottoms.push($('body').height());\n   }\n   return  Math.max.apply(null, bottoms);\n}\n\nconst fixMinimizedDialogsPosition = () => {\n   var footer_height = $('.addiction-warning').height();\n   var scroll_bottom = $(document).height() - $(window).height() - $(window).scrollTop();\n   $(\"#dialog-extend-fixed-container\").css(\"bottom\", Math.max(0, footer_height - scroll_bottom));\n}\n\n\nexport const init = function($parentObj) {\n   /* wrap jquery ui dialog('destory') to fire an event */\n   var original = $.fn.dialog;\n   $.fn.dialog = function(cmd) {\n      if(cmd === 'destroy') {\n         this.trigger('dialogdestroy');\n         return original.call(this, 'destroy'); // destroy and remove from dom\n      }\n      return original.apply(this, arguments);\n   }\n\n   $menuUL = $parentObj.find(\"ul\");\n\n   const tileObject = $menuUL.find(\".tile\");\n\n   closeAllObject = $menuUL.find(\".closeAll\");\n   closeAllObject.click(() => {\n      /* The close click is behaving weird.\n         Behavior - When there are charts opened, this event is able to close all charts and then\n         unable to hide the menu. When There are no charts, then it behaves normally */\n      if ($('.webtrader-dialog').length > 0) {\n         $('.webtrader-dialog').dialog('close');\n      }\n   });\n\n   //Attach click listener for tile menu\n   tileObject.click(tileDialogs);\n\n   require([\"charts/chartWindow\",\"websockets/binary_websockets\", \"navigation/menu\"], (chartWindowObj,liveapi, menu) => {\n      if(!tracker.is_empty()) {\n         tracker.reopen();\n         return;\n      }\n      const counts = calculateChartCount();\n      liveapi\n         .cached.send({trading_times: new Date().toISOString().slice(0, 10)})\n         .then((markets) => {\n            markets = menu.extractChartableMarkets(markets);\n            /* return a random element of an array */\n            const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];\n            const timePeriods = ['2h', '4h', '8h', '1d'];\n            const chartTypes = ['candlestick', 'line', 'ohlc', 'spline']; //This is not the complete chart type list, however its good enough to randomly select one from this subset\n            for (let inx = 0; inx < counts.total; ++inx) {\n               const submarkets = rand(markets).submarkets;\n               const symbols = rand(submarkets).instruments;\n               const sym = rand(symbols);\n               const timePeriod = rand(timePeriods);\n               const chart_type = rand(chartTypes);\n\n               chartWindowObj.addNewWindow({\n                  instrumentCode: sym.symbol,\n                  instrumentName: sym.display_name,\n                  timePeriod: timePeriod,\n                  type: chart_type,\n                  delayAmount: sym.delay_amount\n               });\n            }\n            tileDialogs(); // Trigger tile action\n         });\n   });\n\n   /* automatically log the user in if we have oauth_token in local_storage */\n   require(['websockets/binary_websockets' ], (liveapi) => {\n      if(!local_storage.get('oauth')) {\n         return;\n      }\n      /* query string parameters can tempered.\n             make sure to get loginid from webapi instead */\n      var oauth = local_storage.get('oauth');\n      Promise.all(\n         oauth.slice(1)\n            .map(acc => ({ authorize: acc.token}))\n            .map(req => liveapi.send(req))\n      )\n         .then((results) =>\n            liveapi.cached.authorize()\n               .then((data) => {\n                  results.unshift(data);\n                  let is_jpy_account = false;\n                  for(let i = 0; i < results.length; ++i) {\n                     oauth[i].id = results[i].authorize.loginid;\n                     oauth[i].is_virtual = results[i].authorize.is_virtual;\n                     if (results[i].authorize.landing_company_name.indexOf('japan') !== -1) {\n                        is_jpy_account = true;\n                     }\n                  }\n                  local_storage.set('oauth', oauth);\n                  return is_jpy_account;\n               })\n         )\n         .then((is_jpy_account) => {\n            /* Japan accounts should not be allowed to login to webtrader */\n            if(is_jpy_account && is_jpy_account === true) {\n               liveapi.invalidate();\n               $.growl.error({message: 'Japan accounts are not supported.'.i18n(), duration: 6000 });\n               local_storage.remove('oauth');\n               local_storage.remove('oauth-login');\n            }\n         })\n         .catch((err) => {\n            //Switch to virtual account on selfexclusion error.\n            if(err.code===\"SelfExclusion\"){\n               //Login to virtual account instead.\n               oauth.forEach((ele, i) => {\n                  if(ele.id.match(/^VRTC/)){\n                     liveapi.switch_account(ele.id);\n                     return;\n                  }\n               });\n               return;\n            }\n            console.error(err.message);\n            $.growl.error({message: err.message});\n            //Remove token and trigger login-error event.\n            local_storage.remove('oauth');\n            $(\".login\").trigger(\"login-error\");\n         });\n   });\n   $(window).scroll(fixMinimizedDialogsPosition);\n   return this;\n}\n\n//Trigger close even on all dialogs\nexport const closeAll = () => closeAllObject && closeAllObject.click();\n\n\n/* important options: {\n   title:'',\n   resize:fn, // callabak for dialog resize event\n   close: fn, // callback for dialog close event\n   open: fn,  // callback for dialog open event\n   destroy: fn, // callback for dialog destroy event\n   refresh: fn, // callback for refresh button click\n   autoOpen: false,\n   resizable:true,\n   collapsable:false,\n   minimizable: true,\n   maximizable: true,\n   closable:true,\n   modal:true, // Whether to block base page and show it as blocking modal dialog\n   closeOnEscape:true, // Respond to ESC key event\n   ignoreTileAction:false, // Is this dialog going to take part in tile action\n   data-*: 'value' // add arbitary data-* attributes to the dialog.('data-authorized' for exmaple)\n}\nnotes:\n    1- get generated dialog id via createBlankWindow(...).attr('id')\n    2- if autoOpen == false  use createBalnkWindow(...).dialog('open') to open the dialog\n    2- if minWidth and minHeight are not specified the options.width and options.height will be used for minimums.\n */\nexport const createBlankWindow = function($html,options) {\n   $html = $($html);\n   const id = \"windows-dialog-\" + ++dialogCounter;\n   options = $.extend({\n      autoOpen: false,\n      resizable: true,\n      collapsable: false,\n      width: 350,\n      height: 400,\n      my: 'center',\n      at: 'center',\n      of: window,\n      title: 'Blank window'.i18n(),\n      hide: 'fade',\n      icons: {\n         close: 'custom-icon-close',\n         minimize: 'custom-icon-minimize',\n         maximize: 'custom-icon-maximize'\n      },\n      open: function() {\n         $(this).promise().done(function () {\n            const changePos = $(this).dialog(\"option\",\"isTrackerInitiated\");\n            const pos = $(this).dialog(\"option\",\"relativePosition\");\n            // Open chart at a relative position if it is a chart or trade type\n            if(!changePos && pos){\n               if(!$(last_dialog).parent().length){\n                  last_dialog = $(this);\n                  return;\n               }\n               const top = parseInt($(last_dialog).parent().css(\"top\"));\n               const left = parseInt($(last_dialog).parent().css(\"left\"));\n               $($(this).parent()).css(\"top\",top+5+\"px\");\n               $($(this).parent()).css(\"left\",left+5+\"px\");\n               last_dialog = $(this);\n            }\n         });\n      }\n   }, options || {});\n   options.minWidth = options.minWidth || options.width;\n   options.minHeight = options.minHeight || options.height;\n\n   if (options.resize)\n      options.maximize = options.minimize  = options.restore = options.resize;\n\n   const blankWindow = $html.attr(\"id\", id);\n   if (!options.ignoreTileAction) blankWindow.addClass('webtrader-dialog')\n   blankWindow.dialog(options).dialogExtend(options);\n\n\n   const dialog = blankWindow.dialog('widget');\n   dialog.addClass('webtrader-dialog-widget');\n   /* allow dialogs to be moved though the bottom of the page */\n   dialog.draggable( \"option\", \"containment\", false );\n   dialog.draggable( \"option\", \"scroll\", true );\n   dialog.on('dragstop', () => {\n      const top = dialog.offset().top;\n      if(top < 0) {\n         dialog.animate({ top: '0px' }, 300, dialog.trigger.bind(dialog, 'animated'));\n      }\n   });\n\n   if(options.destroy) { /* register for destroy event which have been patched */\n      blankWindow.on('dialogdestroy', options.destroy);\n   }\n\n   blankWindow.moveToTop = () => {\n      blankWindow.dialog('open');\n      blankWindow.dialogExtend('restore');\n      blankWindow.dialog('widget').effect(\"bounce\", { times: 2, distance: 15 }, 450);\n   };\n\n   // add an item to window menu\n   let li = null;\n   const add_to_windows_menu = () => {\n      const link = $(\"<a href='#'>\" + options.title + \"</a>\");\n      // bring window to top on click\n      link.click(blankWindow.moveToTop);\n      li = $('<li />').addClass(id + 'LI').html(link);\n      if($menuUL) {\n         $menuUL.append(li);\n      } else { // try in 10 seconds.\n         setTimeout(() => ($menuUL && $menuUL.append(li)), 10*10000);\n      }\n   };\n   if(!options.ignoreTileAction) {\n      add_to_windows_menu();\n   }\n\n   // remove item from window menu on close\n   blankWindow.on('dialogclose', () => {\n      li && li.remove();\n      li = null;\n   });\n   blankWindow.on('dialogopen',\n      () => !li && !options.ignoreTileAction && add_to_windows_menu()\n   );\n\n   if (options.resize) {\n      options.resize.call($html[0]);\n   }\n   blankWindow.addDateToHeader = addDateToHeader;\n\n   /* set data-* attributes on created dialog */\n   const attributes = Object.keys(options).filter((key) =>  _.startsWith(key, 'data-') );\n   attributes.forEach((key) => blankWindow.attr(key, options[key]) );\n\n   /* check and add the refresh button if needed */\n   if(options.refresh){\n      const header = blankWindow.parent().find('.ui-dialog-title');\n      const refresh = header.append(\"<img class='reload' src='images/refresh.svg' title='reload'/>\").find(\".reload\");\n      refresh.on('click',options.refresh);\n   }\n\n   /* options: {\n    *    module_id: 'statement/statement'  // require js module id\n    *    is_unique: true/false // is this dialog instance unique or not,\n    *    data: { } // arbitary data object for this dialog\n    * } */\n   blankWindow.track = (options) => tracker.track(options, blankWindow);\n\n   blankWindow.destroy = () => {\n      if(blankWindow.data('ui-dialog')) {\n         blankWindow.dialog('destroy');\n      }\n      blankWindow.remove();\n   };\n   return blankWindow;\n};\n\n/*\n   Uses a jquery-ui spinner to display a list of strings.\n       @param: options.index       initial value of the array to show.\n       @param: options.list        array of string items to show\n       @param: options.changed     callback thats i called when menu is changed.\n       @param: options.width       can specify the with of selectmenu.\n   Note: you should add your input to dom before turning it a spinner.\n\n   Note: you can call 'update_list(...)' on the returned spinner to update the list of items:\n       var spinner = makeTextSpinner(input,{list:['a,'b','c'],inx:0});\n       spinner.update_list(['a','d','e','f']);\n\n   TODO: move this to a utility file\n*/\nexport const makeSelectmenu = function (select, options) {\n   options = $.extend({\n      list: ['empty'],\n      inx: 0,\n      changed:  () => { }\n   }, options);\n\n   var inx = options.inx, list = options.list;\n   var update_select = (list) => {\n      select.children().remove();\n      for(let i = 0; i < list.length; ++i)\n         $('<option/>').val(list[i]).text(list[i]).appendTo(select);\n   }\n   update_select(list);\n   select.val(list[inx]);\n\n   select = select.selectmenu({ width: options.width });\n   select.on('selectmenuchange', function () {\n      var val = $(this).val();\n      options.changed(val);\n   })\n\n   select.update_list = (new_list) => {\n      update_select(new_list);\n      select.val(new_list[0]);\n      select.selectmenu('refresh');\n   }\n   return select;\n};\n\nexport const event_on = (name, cb) => {\n   (callbacks[name] = callbacks[name] || []).push(cb);\n   return cb;\n}\n\nexport const event_off = (name, cb) => {\n   if(callbacks[name]) {\n      var index = callbacks[name].indexOf(cb);\n      index !== -1 && callbacks[name].splice(index, 1);\n   }\n}\n\nexport const tile = tileDialogs;\nexport default {\n   init,\n   tile,\n   closeAll,\n   createBlankWindow,\n   makeSelectmenu,\n   event_on, event_off\n};\n"]}