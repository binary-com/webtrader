{"version":3,"sources":["../../../../src/download/download.es6"],"names":["downloadWin","markets","timePeriods","name","i18n","code","WIDTH","HEIGHT","tp","i18n_name","local_storage","get","value","appURL","getAppURL","urlShareTemplate","iframeShareTemplate","twitterShareTemplate","fbShareTemplate","gPlusShareTemplate","bloggerShareTemplate","vkShareTemplate","is_rtl_language","renderChart","instrumentObject","timePeriod","toDateWithTime","$downloadChart","highcharts","destroy","chart","spacingLeft","marginLeft","navigator","enabled","series","id","plotOptions","candlestick","lineColor","color","upColor","upLineColor","shadow","title","text","display_name","credits","href","xAxis","labels","formatter","str","axis","defaultLabelFormatter","call","replace","yAxis","opposite","align","tooltip","crosshairs","width","dashStyle","enabledIndicators","xDateFormat","exporting","url","filename","split","join","rangeSelector","showLoading","prop","from","utc","unix","to","req","symbol","isTick","granularity","convertToTimeperiodObject","timeInSeconds","style","end","console","log","JSON","stringify","send","then","data","dataInHighChartsFormat","history","times","forEach","time","index","push","parseInt","parseFloat","prices","candles","ohlc","epoch","open","high","low","close","totalLength","length","growl","error","message","hideLoading","endIndex","setExtremes","seriesConf","Date","now","type","dataGrouping","states","hover","marker","radius","addSeries","resizeDialog","catch","err","setShareURLs","$dialog","dialog","height","reflow","shareButton","overlay","positionRight","offset","left","outerWidth","css","init","$menuLink","click","createBlankWindow","minWidth","minHeight","resize","track","module_id","is_unique","closest","$html","find","datepicker","changeMonth","changeYear","dateFormat","showButtonPanel","minDate","subtract","toDate","maxDate","timepicker","showCloseButton","appendTo","cached","trading_times","toISOString","slice","extractChartableMarkets","sortMenu","rootULForInstruments","defaultInstrumentObject","undefined","mainMarket","submarkets","subMarket","instruments","instrument","append","html","toggle","createTimePeriodDropDown","delay_amount","isUndefined","menu_options","position","my","at","menu","$downloadInstruments","blur","hide","e","$download_timePeriod","timePeriodObject","val","format","initDownloadChartOptions","moveToTop","timePeriodValue","baseValue","isChecked","remove","rootUL_timePeriod","timePeriodParent","subMenu","isDayCandles","$download_fromTime","show","obj","fbShareLink","twitterShareLink","bloggerShareLink","gPlusShareLink","vkShareLink","shareLink","embedCode","attr","encodeURIComponent","png","pdf","csv","svg","exportChartLocal","exportChart","is_tick","options","lines","map","bar","download_file_in_browser"],"mappings":"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","file":"download.js","sourcesContent":["/**\n * Created by Arnab Karmakar on 1/28/16.\n */\nimport $ from 'jquery';\nimport windows from '../windows/windows';\nimport liveapi from '../websockets/binary_websockets';\nimport menu from '../navigation/menu';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport 'jquery-ui';\nimport 'jquery-growl';\nimport '../common/util';\nimport 'highstock-release/modules/offline-exporting';\nimport 'css!./download.css';\n\nimport html from 'text!./download.html';\n\n    let downloadWin = null, markets = [], timePeriods = [\n        {\n            name : 'Ticks'.i18n(),\n            timePeriods : [{name : \"1 Tick\", code : \"1t\"}]\n        },\n        {\n            name : 'Minutes'.i18n(),\n            timePeriods : [\n                {name : \"1 min\", code : \"1m\"},\n                {name : \"2 mins\", code : \"2m\"},\n                {name : \"3 mins\", code : \"3m\"},\n                {name : \"5 mins\", code : \"5m\"},\n                {name : \"10 mins\", code : \"10m\"},\n                {name : \"15 mins\", code : \"15m\"},\n                {name : \"30 mins\", code : \"30m\"}\n            ]\n        },\n        {\n            name : 'Hours'.i18n(),\n            timePeriods : [\n                {name : \"1 hour\", code : \"1h\"},\n                {name : \"2 hours\", code : \"2h\"},\n                {name : \"4 hours\", code : \"4h\"},\n                {name : \"8 hours\", code : \"8h\"}\n            ]\n        },\n        {\n            name : 'Days'.i18n(),\n            timePeriods : [\n                {name : \"1 day\", code : \"1d\"}\n            ]\n        }\n    ];\n\n    const WIDTH = 900, HEIGHT = 500;\n    let tp; // tp is timeperiod, required for exporting in csv format.\n    //Used in exportOverlay.\n    const i18n_name = (local_storage.get('i18n') || { value: 'en' }).value,\n        appURL = getAppURL(); // Get current app's url.\n    const urlShareTemplate = appURL + '?affiliates=true&instrument={0}&timePeriod={1}&lang=' + i18n_name,\n        iframeShareTemplate = '<iframe src=\"' + urlShareTemplate + '\" width=\"350\" height=\"400\" style=\"overflow-y : hidden;\" scrolling=\"no\" />',\n        twitterShareTemplate = 'https://twitter.com/share?url={0}&text={1}',\n        fbShareTemplate = 'https://facebook.com/sharer/sharer.php?u={0}',\n        gPlusShareTemplate = 'https://plus.google.com/share?url={0}',\n        bloggerShareTemplate = 'https://www.blogger.com/blog-this.g?u={0}&n={1}',\n        vkShareTemplate = 'http://vk.com/share.php?url={0}&title={1}';\n    const is_rtl_language = i18n_name === 'ar';\n\n    const renderChart = (instrumentObject, timePeriod, toDateWithTime) => {\n\n        const $downloadChart = $(\".downloadChart\");\n        if ($downloadChart.highcharts()) {\n            $downloadChart.highcharts().destroy();\n        }\n\n        $downloadChart.highcharts('StockChart', {\n\n            chart: {\n                spacingLeft: 0,\n                marginLeft: 45\n            },\n\n            navigator: {\n                enabled : true,\n                series: {\n                    id: 'navigator'\n                }\n            },\n\n            //This will be updated when 'Settings' button is implemented\n            plotOptions: {\n                candlestick: {\n                    lineColor: 'black',\n                    color: 'red',\n                    upColor: 'green',\n                    upLineColor: 'black',\n                    shadow: false\n                }\n            },\n\n            title: {\n                //Show name on chart if it is accessed with affiliates = true parameter. In normal webtrader mode, we dont need this title because the dialog will have one\n                text: instrumentObject.display_name + \" (\" + timePeriod + \")\" //name to display\n            },\n\n            credits: {\n                href: '#',\n                text: ''\n            },\n\n            xAxis: {\n                labels: {\n                    formatter: function(){\n                        const str = this.axis.defaultLabelFormatter.call(this);\n                        return str.replace('.','');\n                    }\n                }\n            },\n\n            yAxis: [{\n                opposite: false,\n                labels: {\n                    formatter: function () {\n                        return this.value;\n                    },\n                    align:'center'\n                }\n            }],\n\n            tooltip: {\n                crosshairs: [{\n                    width: 2,\n                    color: 'red',\n                    dashStyle: 'dash'\n                }, {\n                    width: 2,\n                    color: 'red',\n                    dashStyle: 'dash'\n                }],\n                enabled: true,\n                enabledIndicators: true,\n                xDateFormat: '%A, %b %e, %Y %H:%M:%S'\n            },\n\n            exporting: {\n                enabled: false,\n                url: 'https://export.highcharts.com', // Override for mixed content error\n                // Naming the File\n                filename:instrumentObject.display_name.split(' ').join('_')+\"(\"+timePeriod+\")\"\n            },\n\n            rangeSelector: {\n                enabled: false\n            }\n\n        });\n        const chart = $downloadChart.highcharts();\n\n        chart.showLoading();\n        //Disable show button\n        $(\".download_show\").prop(\"disabled\", true);\n\n        const from = moment.utc(toDateWithTime, \"DD/MM/YYYY HH:mm\").unix();\n        let to = from + 30 * 60; //By default getting 30 minutes of data (for tick charts)\n        const req = {\n            \"ticks_history\": instrumentObject.symbol,\n            \"start\" : from\n        };\n        if (!isTick(timePeriod)) {\n            req.granularity = convertToTimeperiodObject(timePeriod).timeInSeconds();\n            req.style = 'candles';\n            to = from + req.granularity * 1000;\n        }\n        if (moment.utc().unix() < to) {\n            to = moment.utc().unix();\n        }\n        req.end = to;\n\n        console.log(\"View Historical data [request] \", JSON.stringify(req));\n        liveapi\n            .send(req).then((data) => {\n\n                const dataInHighChartsFormat = [];\n\n                if (isTick(timePeriod)) {\n                    data.history.times.forEach((time, index) => {\n                        dataInHighChartsFormat.push([parseInt(time) * 1000, parseFloat(data.history.prices[index])]);\n                    });\n                } else {\n                    data.candles.forEach((ohlc) => {\n                        dataInHighChartsFormat.push([ohlc.epoch * 1000,\n                            parseFloat(ohlc.open),\n                            parseFloat(ohlc.high),\n                            parseFloat(ohlc.low),\n                            parseFloat(ohlc.close)]);\n                    });\n                }\n\n                const totalLength = dataInHighChartsFormat.length;\n                if (totalLength === 0) {\n                    $.growl.error({ message: \"There is no historical data available!\" });\n                    chart.hideLoading();\n                    $(\".download_show\").prop(\"disabled\", false);\n                    return;\n                };\n                const endIndex = totalLength > 100 ? 100 : totalLength - 1;\n                chart.xAxis[0].setExtremes(dataInHighChartsFormat[0][0], dataInHighChartsFormat[endIndex][0]); //show 100 bars\n\n                const name = instrumentObject.display_name;\n\n                const seriesConf = {\n                    id: '_' + Date.now(),\n                    name: name,\n                    data: dataInHighChartsFormat,\n                    type: isTick(timePeriod) ? 'line' : 'candlestick', //area, candlestick, line, areaspline, column, ohlc, scatter, dot, linedot\n                    dataGrouping: {\n                        enabled: false\n                    },\n                    states: {\n                        hover: {\n                            enabled: false\n                        }\n                    }\n                };\n                if (isTick(timePeriod)) {\n                    seriesConf.marker = {\n                        enabled: true,\n                        radius: 4\n                    };\n                }\n\n                chart.addSeries(seriesConf);\n                chart.hideLoading();\n                $(\".download_show\").prop(\"disabled\", false);\n\n                resizeDialog();\n\n            })\n            .catch((err) => {\n                console.error(err);\n                $.growl.error({ message: err.message });\n                chart.hideLoading();\n                $(\".download_show\").prop(\"disabled\", false);\n            });\n        tp = timePeriod;\n        setShareURLs(instrumentObject, timePeriod);\n\n    }\n\n    const resizeDialog = () => {\n        if(downloadWin) {\n            const $dialog = downloadWin.dialog('widget');\n            const chart = $(\".downloadChart\")\n                .height($dialog.height() - 100)\n                .highcharts();\n            if (chart) chart.reflow();\n            const shareButton = $(\".download_window .share-button\");\n            const overlay = $(\".download_window .exportOverlay\");\n            const positionRight = $dialog.width() - (shareButton.offset().left + shareButton.outerWidth() - $dialog.offset().left) + 1;\n            overlay.css(\"right\",positionRight + \"px\");\n        }\n    };\n\n    export const init = ($menuLink) => {\n        $menuLink.click(() => {\n            if (!downloadWin) {\n                downloadWin = windows.createBlankWindow($('<div class=\"download_window\"/>'),\n                    {\n                        title: 'View Historical Data'.i18n(),\n                        width: WIDTH ,\n                        minWidth: WIDTH ,\n                        minHeight: HEIGHT ,\n                        height: HEIGHT ,\n                        resize : resizeDialog\n                    });\n                downloadWin.track({\n                  module_id: 'download',\n                  is_unique: true,\n                  data: null\n                });\n                downloadWin.dialog('open');\n                downloadWin.closest(\"div.ui-dialog\").css(\"overflow\", \"visible\");\n                    const $html = $(html).i18n();\n                    //$html.find(\"button, input[type=button]\").button();\n                    $html\n                        .find('.download_fromDate')\n                        .datepicker({\n                            changeMonth : true,\n                            changeYear : true,\n                            dateFormat : 'dd/mm/yy',\n                            showButtonPanel : true,\n                            minDate : moment.utc().subtract(1, \"years\").toDate(),\n                            maxDate : moment.utc().toDate()\n                        })\n                        .click(function() {\n                            $(this).datepicker(\"show\");\n                        });\n                    $html.find('.download_fromTime').timepicker({\n                            showCloseButton : true\n                        }).click(function() {\n                            $(this).timepicker(\"show\");\n                        });\n                    $html.appendTo(downloadWin);\n\n                    liveapi\n                        .cached.send({ trading_times: new Date().toISOString().slice(0, 10) })\n                        .then((data) => {\n                            markets = menu.extractChartableMarkets(data);\n                            /* add to instruments menu */\n                            markets = menu.sortMenu(markets);\n                            const rootULForInstruments = $(\"<ul>\");\n                            let defaultInstrumentObject = undefined;\n                            markets.forEach((value) => {\n                                const mainMarket = $(\"<ul>\");\n                                value.submarkets.forEach((value) => {\n                                    const subMarket = $(\"<ul>\");\n                                    value.instruments.forEach((value) => {\n                                        const instrument = $(\"<li>\");\n                                        instrument.append(value.display_name);\n                                        instrument.data(\"instrumentObject\", value);\n                                        instrument.click(function() {\n                                             const instrumentObject = $(this).data(\"instrumentObject\");\n                                            $(\".download_instruments\")\n                                                .data(\"instrumentObject\",instrumentObject)\n                                                .html(instrumentObject.display_name);\n                                            $(\".download_instruments_container > ul\").toggle();\n                                            // Create a new drop down everytime market is changed\n                                            createTimePeriodDropDown($(this).data(\"instrumentObject\").delay_amount * 60, $html);\n                                        });\n                                        if (_.isUndefined(defaultInstrumentObject)) {\n                                            defaultInstrumentObject = value;\n                                        }\n                                        subMarket.append(instrument);\n                                    });\n                                    mainMarket.append($(\"<li>\").append(value.name).append(subMarket));\n                                });\n                                rootULForInstruments.append($(\"<li>\").append(value.name).append(mainMarket));\n                            });\n                            $(\".download_instruments_container\").append(rootULForInstruments);\n\n                            const menu_options = is_rtl_language ? {position: { my: \"right top\", at: \"left top\" }} : {};\n                            rootULForInstruments.menu(menu_options).toggle();\n\n                            const $downloadInstruments = $(\".download_instruments\");\n                            $downloadInstruments\n                                .click(() => {\n                                    $(\".download_instruments_container > ul\").toggle();\n                                })\n                                .blur(() => {\n                                    $(\".download_instruments_container > ul\").hide();\n                                });\n                            $downloadInstruments.data(\"instrumentObject\", defaultInstrumentObject);\n                            $downloadInstruments.html(defaultInstrumentObject.display_name);\n                            //Init the time period drop down\n                            createTimePeriodDropDown($downloadInstruments.data(\"instrumentObject\").delay_amount * 60, $html);\n\n                            $(\".download_show\").click();\n\n                        }).catch((e) => {\n                            console.error(e);\n                            $.growl.error({ message: e.message });\n                        });\n\n                    const $download_timePeriod = $(\".download_timePeriod\");\n                    $download_timePeriod\n                        .click(\n                           () => $(\".download_timePeriod_container > ul\").toggle()\n                        )\n                        .blur(\n                           () => $(\".download_timePeriod_container > ul\").hide()\n                        );\n                    $download_timePeriod.data(\"timePeriodObject\", {\n                        name : \"1 day\", code : \"1d\"\n                    });\n                    $download_timePeriod.html(\"1 day\");\n                    $(\".download_fromTime\").hide();\n\n                    $html.find(\".download_show\").click(() => {\n                        const $downloadInstruments = $(\".download_instruments\");\n                        const $download_timePeriod = $(\".download_timePeriod\");\n                        const instrumentObject = $downloadInstruments.data(\"instrumentObject\");\n                        const timePeriodObject = $download_timePeriod.data(\"timePeriodObject\");\n                        renderChart(instrumentObject, timePeriodObject.code,\n                                        $(\".download_fromDate\").val() + \" \" + $(\".download_fromTime\").val());\n                    });\n\n                    $html.find(\".download_fromDate\").val(moment.utc().subtract(1, \"years\").format(\"DD/MM/YYYY\"));\n\n                    $html.find(\".share-button\").click(\n                       () => $html.find(\".overlay\").toggle()\n                    );\n\n                    initDownloadChartOptions();\n\n            }\n            else {\n                downloadWin.moveToTop();\n            }\n        });\n    }\n\n    /*\n    * delay_amount is used for getting instrumentObjects delay_amount.\n    * $html  contains html object of the download page.\n    * $download_timePeriod is the current timePeriod object.\n    * timePeriodValue contains converted value for different timePeriod objects converted into seconds.\n    * baseValue contains value converted into seconds for particular timeperiod.name.\n    * isChecked is a flag used to identify If current timeObject is less than delay_amount and set the next closest one.\n    */\n    const createTimePeriodDropDown = (delay_amount, $html) => {\n        const $download_timePeriod = $(\".download_timePeriod\");\n        let timePeriodValue, baseValue, isChecked = false;\n        //removing any existing drop down.\n        if ($download_timePeriod.find(\"ul\").length > 0) {\n            $download_timePeriod.find(\"ul\")[0].remove();\n        }\n        const rootUL_timePeriod = $(\"<ul>\");\n        timePeriods.forEach((timePeriodParent) => {\n            const subMenu = $(\"<ul>\");\n            timePeriodParent.timePeriods.forEach((timePeriod) => {\n                const tp = $(\"<li>\");\n                timePeriodValue = convertToTimeperiodObject(timePeriod.code).timeInSeconds();\n                tp.append(timePeriod.name);\n                tp.data(\"timePeriodObject\", timePeriod);\n                tp.click(function() {\n                    const timePeriodObject = $(this).data(\"timePeriodObject\");\n                    $(\".download_timePeriod\")\n                        .data(\"timePeriodObject\", timePeriodObject)\n                        .html($(this).data(\"timePeriodObject\").name);\n                    $(\".download_timePeriod_container > ul\").toggle();\n                    const isDayCandles = timePeriodObject.code === '1d';\n                    const $download_fromTime = $html.find(\".download_fromTime\");\n                    if (isDayCandles) {\n                        $download_fromTime.val(\"00:00\");\n                        $download_fromTime.hide()\n                    } else {\n                        $download_fromTime.show();\n                    }\n                });\n                if (!_.isUndefined($download_timePeriod.data(\"timePeriodObject\")) && !isChecked) {\n                    const obj = $download_timePeriod.data(\"timePeriodObject\");\n                    const value = convertToTimeperiodObject(obj.code).timeInSeconds();\n                    if(value < delay_amount){\n                        tp.click();\n                        $(\".download_timePeriod_container > ul\").toggle();\n                    }\n                    isChecked = true;\n                }\n                subMenu.append(tp);\n\n            });\n            rootUL_timePeriod.append($(\"<li>\").append(timePeriodParent.name).append(subMenu));\n        });\n        $(\".download_timePeriod_container\").append(rootUL_timePeriod);\n        const menu_options = is_rtl_language ? {position: { my: \"right top\", at: \"left top\" }} : {};\n        rootUL_timePeriod.menu(menu_options).toggle();\n    }\n\n    // This function is used to set various share urls in share button dropdown.\n    const setShareURLs = (instrument, timePeriod) => {\n        const fbShareLink = $(\".download_table .fbShareLink\"),\n            twitterShareLink = $(\".download_table .twitterShareLink\"),\n            bloggerShareLink = $(\".download_table .bloggerShareLink\"),\n            gPlusShareLink = $(\".download_table .gPlusShareLink\"),\n            vkShareLink = $(\".download_table .vkShareLink\"),\n            shareLink = $(\".download_table .exportChartURLShare\"),\n            embedCode = $(\".download_table .exportChartIframeShare\");\n        fbShareLink.attr(\"href\", fbShareTemplate.format(encodeURIComponent(urlShareTemplate.format(instrument.symbol, timePeriod))));\n        twitterShareLink.attr(\"href\", twitterShareTemplate.format(encodeURIComponent(urlShareTemplate.format(instrument.symbol, timePeriod)), instrument.display_name + '(' + timePeriod + ')'));\n        gPlusShareLink.attr(\"href\", gPlusShareTemplate.format(encodeURIComponent(urlShareTemplate.format(instrument.symbol, timePeriod))));\n        bloggerShareLink.attr(\"href\", bloggerShareTemplate.format(urlShareTemplate.format(instrument.symbol, timePeriod), instrument.display_name + '(' + timePeriod + ')'));\n        vkShareLink.attr(\"href\", vkShareTemplate.format(urlShareTemplate.format(instrument.symbol, timePeriod), instrument.display_name + '(' + timePeriod + ')'));\n        shareLink.val(urlShareTemplate.format(instrument.symbol, timePeriod));\n        embedCode.val(iframeShareTemplate.format(instrument.symbol, timePeriod));\n    }\n\n    const initDownloadChartOptions = () => {\n        const png = $(\".download_table #png\"),\n            pdf = $(\".download_table #pdf\"),\n            csv = $(\".download_table #csv\"),\n            svg = $(\".download_table #svg\");\n\n        png.click(() => {\n            const chart = $(\".downloadChart\").highcharts();\n            chart.exportChartLocal();\n        });\n        pdf.click(() => {\n            const chart = $(\".downloadChart\").highcharts();\n            chart.exportChart({\n                type: 'application/pdf'\n            });\n        });\n        svg.click(() => {\n            const chart = $(\".downloadChart\").highcharts();\n            chart.exportChart({\n                type: 'image/svg+xml'\n            });\n        });\n        csv.click(() => {\n            const chart = $(\".downloadChart\").highcharts();\n            const series = chart.series[0]; //Main series\n            const is_tick = isTick(tp);\n            const filename = series.options.name + ' (' +  tp + ')' + '.csv';\n            const lines = series.options.data.map((bar) => {\n                const time = bar[0], open = bar[1];\n                if(is_tick){\n                    return '\"' + moment.utc(time).format('YYYY-MM-DD HH:mm:ss') + '\"' + ',' + /* Date */ + open; /* Price */\n                }\n                const high = bar[2], low = bar[3], close = bar[4];\n                return '\"' + moment.utc(time).format('YYYY-MM-DD HH:mm') + '\"' + ',' +/* Date */\n                    open + ',' + high + ',' + low + ',' + close;\n            });\n            const csv = (is_tick ? 'Date,Tick\\n' : 'Date,Open,High,Low,Close\\n') + lines.join('\\n');\n\n            download_file_in_browser(filename, 'text/csv;charset=utf-8;', csv);\n        });\n    }\n\n    export default { init };\n"]}