define(["jquery"],function(a){var b=[],c=[],d=[],e={OPEN:0,HIGH:1,LOW:2,CLOSE:3,SMA:"SMA",EMA:"EMA",WMA:"WMA",TEMA:"TEMA",TRIMA:"TRIMA",isOHLCorCandlestick:function(a){return"candlestick"==a||"ohlc"==a},recalculate:function(b){var c=1,d=b.yAxis.length;d--,d--;var e=Math.round(45/d),f=0;0>=d?b.yAxis[0].update({top:"0%",height:"100%"},!1):a.each(b.yAxis,function(a,b){0==a?(b.update({top:"0%",height:"50%"},!1),f+=50):b.options&&b.options.id&&-1!=b.options.id.toLowerCase().indexOf("navigator")||(b.update({top:f+c+"%",height:(f+c+e>100?100-f-c:e)+"%",offset:0},!1),f+=c+e)})},appliedPriceString:function(a){var b="CLOSE";switch(a){case e.OPEN:b="OPEN";break;case e.HIGH:b="HIGH";break;case e.LOW:b="LOW";break;case e.CLOSE:b="CLOSE"}return b},extractPriceForAppliedTO:function(a,b,c){var d=0;switch(a){case e.OPEN:d=b[c].open||b[c][1];break;case e.HIGH:d=b[c].high||b[c][2];break;case e.LOW:d=b[c].low||b[c][3];break;case e.CLOSE:d=b[c].close||b[c][4]}return d},extractPrice:function(a,b){return a[b][4]||a[b].close||a[b][1]||a[b].y},toFixed:function(b,c){return a.isNumeric(b)&&(b=Math.round(b*Math.pow(10,c))/Math.pow(10,c)),b},checkCurrentSeriesHasIndicator:function(b,c){var d=!1;return b&&c&&a.each(b,function(a,b){return b&&b.parentSeriesID==c?(d=!0,!1):void 0}),d},findIndexInDataForTime:function(a,b){for(var c=-1,d=a.length-1;d>=1;d--)if((a[d][0]||a[d].x)===b){c=d;break}return c},isDoji:function(a){if(a&&a.open&&a.high&&a.low&&a.close)var b=a.open==a.close,c=Math.abs(a.open-a.high),d=Math.abs(a.open-a.low),e=Math.abs(a.low-a.high),f=(b||.1*e>=Math.abs(a.open-a.close))&&d>c,g=(b||.1*e>=Math.abs(a.open-a.close))&&c>d;return{isBull:g,isBear:f}},getPrice:function(a,b,c,d){return this.isOHLCorCandlestick(d)?this.extractPriceForAppliedTO(c,a,b):this.extractPrice(a,b)},getIndicatorData:function(a,b){return a[b][1]||a[b].y||null},calculateMAValue:function(a){var b=null;switch(a.maType){case this.SMA:b=this.calculateSMAValue(a);break;case this.EMA:b=this.calculateEMAValue(a);break;case this.WMA:b=this.calculateWMAValue(a);break;case this.TEMA:b=this.calculateTEMAValue(a);break;case this.TRIMA:b=this.calculateTRIMAValue(a)}return b},calculateSMAValue:function(a){if(a.index<a.period-1)return null;if(a.index>=a.period-1){for(var b=0,c=a.period-1;c>=0;c--)b+=a.isIndicatorData?this.getIndicatorData(a.data,a.index-c):this.getPrice(a.data,a.index-c,a.appliedTo,a.type);return b/a.period}},calculateEMAValue:function(a){if(a.index<a.period-1)return null;if(a.index===a.period-1){for(var b=0,c=0;c<a.period;c++)b+=a.isIndicatorData?this.getIndicatorData(a.data,c):this.getPrice(a.data,c,a.appliedTo,a.type);return b/a.period}var d=this.getIndicatorData(a.maData,a.index-1),e=0;return e=a.isIndicatorData?this.getIndicatorData(a.data,a.index):this.getPrice(a.data,a.index,a.appliedTo,a.type),2*e/(a.period+1)+d*(1-2/(a.period+1))},calculateTEMAValue:function(a){var e=a.data[a.index].x||a.data[a.index][0];if(!b[a.key]&&(b[a.key]=[],c[a.key]=[],d[a.key]=[],a.index===a.period-1))for(var f=0;f<a.period-1;f++)b[a.key].push([e,null]),c[a.key].push([e,null]),d[a.key].push([e,null]);var g={data:a.data,maData:b[a.key],index:a.index,period:a.period,type:a.type,appliedTo:a.appliedTo,isIndicatorData:a.isIndicatorData||!1},h=this.calculateEMAValue(g);a.isPointUpdate?b[a.key][a.index]=[e,h]:b[a.key].push([e,h]);var i={data:b[a.key],maData:c[a.key],index:a.index,period:a.period,type:a.type,appliedTo:a.appliedTo,isIndicatorData:!0},j=this.calculateEMAValue(i);a.isPointUpdate?c[a.key][a.index]=[e,j]:c[a.key].push([e,j]);var k={data:c[a.key],maData:d[a.key],index:a.index,period:a.period,type:a.type,appliedTo:a.appliedTo,isIndicatorData:!0},l=this.calculateEMAValue(k);a.isPointUpdate?d[a.key][a.index]=[e,l]:d[a.key].push([e,l]);var m=3*h-3*j+l;return m},calculateWMAValue:function(a){if(a.index<a.period-1)return null;for(var b=0,c=a.index,d=a.period;c>=0&&d>=0;d--,c--){var e=0;e=a.isIndicatorData?this.getIndicatorData(a.data,c):this.getPrice(a.data,c,a.appliedTo,a.type),b+=e*d}return b/(a.period*(a.period+1)/2)},calculateTRIMAValue:function(a){var b=Math.round((a.period+1)/2);if(a.index<b-1)return null;if(a.index===b-1){for(var c=0,d=0;b>d;d++)c+=a.isIndicatorData?this.getIndicatorData(a.data,d):this.getPrice(a.data,d,a.appliedTo,a.type);return c/b}var e=0;e=a.isIndicatorData?this.getIndicatorData(a.data,a.index):this.getPrice(a.data,a.index,a.appliedTo,a.type);var f=this.getIndicatorData(a.maData,a.index-1);return(f*(b-1)+e)/b}};return e});