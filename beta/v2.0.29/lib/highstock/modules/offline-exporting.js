!function(a){"object"==typeof module&&module.exports?module.exports=a:a(Highcharts)}(function(a){function b(a,b){var c=e.getElementsByTagName("head")[0],d=e.createElement("script");d.type="text/javascript",d.src=a,d.onload=b,c.appendChild(d)}var c=a.win,d=c.navigator,e=c.document;a.CanVGRenderer={},a.Chart.prototype.exportChartLocal=function(f,g){var h,i,j,k,l,m=this,n=a.merge(m.options.exporting,f),o=d.userAgent.indexOf("WebKit")>-1&&d.userAgent.indexOf("Chrome")<0,p=n.scale||2,q=c.URL||c.webkitURL||c,r=0,s=function(){if(n.fallbackToExportServer===!1){if(!n.error)throw"Fallback to export server disabled";n.error()}else m.exportChart(n)},t=function(a,b,d,f,g,h,i,j){var k,l=new c.Image,m=function(){var c,g=e.createElement("canvas"),i=g.getContext&&g.getContext("2d");try{if(i){g.height=l.height*p,g.width=l.width*p,i.drawImage(l,0,0,g.width,g.height);try{c=g.toDataURL(b),f(c,b,d)}catch(m){if("SecurityError"!==m.name&&"SECURITY_ERR"!==m.name&&"SecurityError"!==m.message)throw m;k(a,b,d)}}else h(a,b,d)}finally{j&&j(a,b,d)}},n=function(){i(a,b,d),j&&j(a,b,d)};k=function(){l=new c.Image,k=g,l.crossOrigin="Anonymous",l.onload=m,l.onerror=n,l.src=a},l.onload=m,l.onerror=n,l.src=a},u=function(a){try{if(!o&&d.userAgent.toLowerCase().indexOf("firefox")<0)return q.createObjectURL(new c.Blob([a],{type:"image/svg+xml;charset-utf-16"}))}catch(b){}return"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(a)},v=function(a,b){var f,g=e.createElement("a"),h=(n.filename||"chart")+"."+b;if(d.msSaveOrOpenBlob)d.msSaveOrOpenBlob(a,h);else if(void 0!==g.download)g.href=a,g.download=h,g.target="_blank",e.body.appendChild(g),g.click(),e.body.removeChild(g);else try{if(f=c.open(a,"chart"),void 0===f||null===f)throw"Failed to open window"}catch(i){c.location.href=a}},w=function(){var f,g,i=n&&n.type||"image/png",j=i.split("/")[1],k=m.sanitizeSVG(h.innerHTML);if("image/svg+xml"===i)try{d.msSaveOrOpenBlob?(g=new MSBlobBuilder,g.append(k),f=g.getBlob("image/svg+xml")):f=u(k),v(f,"svg")}catch(l){s()}else f=u(k),t(f,i,{},function(a){try{v(a,j)}catch(b){s()}},function(){var f=e.createElement("canvas"),g=f.getContext("2d"),h=k.match(/^<svg[^>]*width\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*p,l=k.match(/^<svg[^>]*height\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*p,n=function(){g.drawSvg(k,0,0,h,l);try{v(d.msSaveOrOpenBlob?f.msToBlob():f.toDataURL(i),j)}catch(a){s()}};f.width=h,f.height=l,c.canvg?n():(m.showLoading(),b(a.getOptions().global.canvasToolsURL,function(){m.hideLoading(),n()}))},s,s,function(){try{q.revokeObjectURL(f)}catch(a){}})},x=function(a,b,c){++r,c.imageElement.setAttributeNS("http://www.w3.org/1999/xlink","href",a),r===i.length&&w()};a.wrap(a.Chart.prototype,"getChartHTML",function(a){return h=this.container.cloneNode(!0),a.apply(this,Array.prototype.slice.call(arguments,1))}),m.getSVGForExport(n,g),i=h.getElementsByTagName("image");try{for(i.length||w(),k=0,l=i.length;l>k;++k)j=i[k],t(j.getAttributeNS("http://www.w3.org/1999/xlink","href"),"image/png",{imageElement:j},x,s,s,s)}catch(y){s()}},a.getOptions().exporting.buttons.contextButton.menuItems=[{textKey:"printChart",onclick:function(){this.print()}},{separator:!0},{textKey:"downloadPNG",onclick:function(){this.exportChartLocal()}},{textKey:"downloadJPEG",onclick:function(){this.exportChartLocal({type:"image/jpeg"})}},{textKey:"downloadSVG",onclick:function(){this.exportChartLocal({type:"image/svg+xml"})}}]});