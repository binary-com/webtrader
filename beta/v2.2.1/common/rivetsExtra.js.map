{"version":3,"sources":["../../../../src/common/rivetsExtra.es6"],"names":["rivets","_","View","prototype","observe","keypath","callback","model","models","inx","indexOf","substring","adapters","formatters","value","i18n","prop","args","i","length","trim","eq","other","vlaue","currency","formatPrice","undefined","capitalize","read","publish","toLowerCase","digits","isNumeric","toFixed","defer","checkbox","first","second","fn","bind","array","field","map","condition","currency_symbols","epoch","d","Date","getUTCHours","slice","getUTCMinutes","getUTCSeconds","format","utc","from_epoch","till_epoch","ret","seconds","duration","days","hours","minutes","str","last","changed","original","email","validateEmail","date","isValid","regex","RegExp","test","debounce","timeout","clearTimeout","_timer_notify","setTimeout","binders","selectmenu","priority","publishes","el","select","classes","change","val","trigger","unbind","routine","find","split","$input","reg","on","is_ok","css","selectrefresh","array_or_value","chosen","width","chosenrefresh","widget","ui","spinner","_buttonHtml","btn","dir","icon","step","radius","right","options","step_big","input","webtrader_spinner","stop","spin","e","currentTarget","attr","decimals","preventDefault","dialog","color","altField","after","colorpicker","showOn","position","my","of","collision","parts","alpha","layout","bar","colorFormat","part","size","event","parent","scrollParent","scroll","slider","div","handle","append","min","max","create","text","slide","datepicker","styles","marginTop","marginLeft","numberOfMonths","dateFormat","showAnim","showButtonPanel","changeMonth","changeYear","onSelect","beforeShow","inst","dpDiv","closeText","currentText","yearRange","maxDate","minDate","dpicker","blur","_gotoToday","id","timepicker","allways_ok","showPeriod","showLeadingZero","showCloseButton","showNowButton","onHourShow","onMinuteShow","tpDiv","hourText","minuteText","amPmText","closeButtonText","nowButtonText","deselectButtonText","menu","removeClass","data","addClass","jquery_selector","keyup","keyCode","click","style","getHiddenOffsetWidth","$hiddenElement","clone","appendTo","outerWidth","remove","cur_font","$el","fontSize","display","visibility","disabled","removeAttr","animate","scrollTop","scrollHeight","height","decimalPlaces","num","match","Math","places","mul","prefered_sign","no_symbol","dps","dot","endsWith","symbol","replace","round","abs","isNaN","setAttribute","spots","chart","config","type","lineColor","fillColor","spotColor","minSpotColor","maxSpotColor","highlightSpotColor","highlightLineColor","spotRadius","sparkline","show","hide","perv","_perv_indicative_color","red","green","black","component_twoway_bind","self","keypathes","key","observer","observers","target","updated","componentView","setValue","components","static","template","initialize","view","state"],"mappings":"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","file":"rivetsExtra.js","sourcesContent":["﻿/**\n * Created by amin on November 25, 2015.\n */\n\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport rv from 'rivets';\nimport moment from 'moment';\nimport 'jquery-ui';\nimport 'jquery-sparkline';\nimport 'chosen';\nimport 'color-picker';\n\n/* Rivets js does not allow manually observing properties from javascript,\n       Use \"rv.bind().observe('path.to.object', callback)\" to subscribe */\nrivets._.View.prototype.observe = function (keypath, callback) {\n   let model = this.models, inx = 0;\n   while ((inx = keypath.indexOf('.')) !== -1) {\n      model = model[keypath.substring(0,inx)];\n      keypath = keypath.substring(inx + 1);\n   }\n   this.adapters['.'].observe(model, keypath,\n      () => callback(model[keypath])\n   );\n};\n\n/************************************* formatters ***************************************/\n\n/* rivets formatter to translate strings to 18n */\nrv.formatters['i18n'] = (value) => {\n   if(typeof value === 'string') return value.i18n();\n   return value;\n};\n/* rivets formatter to get the property value of an object */\nrv.formatters['prop'] = (value, prop) => {\n   return value && value[prop];\n};\n/* rivets formatter to check if a value is one of the given args */\nrv.formatters['one-of'] = (...args) => {\n   const value = args[0];\n   for (let i = 1; i < args.length ; ++i)\n      if(args[i] === value)\n         return true;\n   return false;\n}\n/* rivets formatter to trim a string */\nrv.formatters['trim'] = (value) => _.trim(value);\n/* rivets formatter to negate a value */\nrv.formatters['negate'] = (value) => !value;\n/* rivets formatter to check equallity of two values */\nrv.formatters.eq = (value, other) => value === other;\n/* formatter to check not-equality of values */\nrv.formatters['not-eq'] = (value, other) => value !== other;\n/* rivets formatter to replace a falsy value with a default one */\nrv.formatters['or'] = (value, other) => value || other;\n/* rivets formatter to replace a falsy value with a default one */\nrv.formatters['or-not'] = (value, other) => value || !other;\n/* rivets formatter to replace a true value with a default one */\nrv.formatters['and'] = (vlaue, other) => vlaue && other;\n/* rivets formatter and not  */\nrv.formatters['and-not'] = (vlaue, other) => vlaue && !other;\n/* rivets formatter for > operator  */\nrv.formatters['gt'] = (vlaue, other) => vlaue > other;\n/* rivets formatter for < operator  */\nrv.formatters['lt'] = (vlaue, other) => vlaue < other;\n/* localise price format*/\nrv.formatters['format-price'] = (value, currency) => (value) ?  formatPrice(value, currency) : undefined;\n/* rivets formater to capitalize string */\nrv.formatters.capitalize = {\n   read: (value) => _.capitalize(value),\n   publish: (value) => value.toLowerCase()\n};\n/* call toFixed on a fload number */\nrv.formatters['to-fixed'] = (value, digits) => {\n   if(!$.isNumeric(value) || !$.isNumeric(digits)){\n      return;\n   }\n   return (value * 1).toFixed(digits || 2);\n}\n/* notify other functions on property changes */\nrv.formatters['notify'] = (...args) => {\n   const value = args[0];\n   for (let i = 1; i < args.length ; ++i)\n      _.defer(args[i], value);\n   return value;\n}\n/* rv 2-way formatter for checkboxes */\nrv.formatters.checkbox = {\n   read: (value, first, second) => _.trim(value, \" '\\\"\") == first,\n   publish: (value, first, second) => _.trim(value ? first: second, \" '\\\"\"),\n}\n/* rv formmatter to bind a given function to a value */\nrv.formatters['bind'] = (fn, value) => fn.bind(undefined, value);\n\nrv.formatters['map'] = (array, field) => _.map(array, field);\n/* rv formatter to prepend a value */\nrv.formatters['prepend'] = (value, other) => (other && value) ? other + value : value;\n/* rv formatter to append a value */\nrv.formatters['append'] = (value, other) => (other && value) ? value + other : value;\n/* ternary operator (condition ? first : second) */\nrv.formatters['ternary'] = (condition, first, second) => condition ? first : second;\n/* formatter to add a currency symbol before the value */\nrv.formatters.currency = (value, currency) => {\n   const currency_symbols = {\n      'USD': '$', /* US Dollar */ 'EUR': '€', /* Euro */ 'CRC': '₡', /* Costa Rican Colón */\n      'GBP': '£', /* British Pound Sterling */ 'ILS': '₪', /* Israeli New Sheqel */\n      'INR': '₹', /* Indian Rupee */ 'JPY': '¥', /* Japanese Yen */\n      'KRW': '₩', /* South Korean Won */ 'NGN': '₦', /* Nigerian Naira */\n      'PHP': '₱', /* Philippine Peso */ 'PLN': 'zł', /* Polish Zloty */\n      'PYG': '₲', /* Paraguayan Guarani */ 'THB': '฿', /* Thai Baht */\n      'UAH': '₴', /* Ukrainian Hryvnia */ 'VND': '₫', /* Vietnamese Dong */\n   };\n   if(value)\n      return (currency_symbols[currency] || currency) + value;\n   return value;\n}\n/* formatter to convert epoch to utc-time in hh:mm:ss format */\nrv.formatters['utc-time'] = (epoch) => {\n   const d = new Date(epoch * 1000); /* since unixEpoch is simply epoch / 1000, we  multiply the argument by 1000 */\n   return (\"00\" + d.getUTCHours()).slice(-2) + \":\" +\n      (\"00\" + d.getUTCMinutes()).slice(-2) + \":\" +\n      (\"00\" + d.getUTCSeconds()).slice(-2);\n}\nrv.formatters['moment'] = (epoch, format) => {\n   format = format || 'YYYY-MM-DD HH:mm:ss';\n   return epoch && moment.utc(epoch*1000).format(format);\n}\n/* human readable difference of two epoch values */\nrv.formatters['moment-humanize'] = (from_epoch, till_epoch) => {\n   if(!from_epoch || !till_epoch) {\n      return undefined;\n   }\n\n   let ret = '';\n   const seconds = till_epoch - from_epoch;\n   const duration = moment.duration(seconds, 'seconds');\n   if (duration.days() > 0)\n      ret += ' ' + duration.days() + ' ' + (duration.days() > 1 ? 'days' : 'day');\n   if (duration.hours() > 0)\n      ret += ' ' + duration.hours() + ' ' + (duration.hours() > 1 ? 'hours' : 'hour');\n   if (duration.minutes() > 0)\n      ret += ' ' + duration.minutes() + ' ' + (duration.minutes() > 1 ? 'minutes' : 'minute');\n   if (duration.seconds() > 0 && seconds < 10*60)\n      ret += ' ' + duration.seconds() + ' ' + (duration.seconds() > 1 ? 'seconds' : 'second');\n\n   return _.trim(ret).i18n();\n}\n/* formatter to bold last character */\nrv.formatters['bold-last-character'] = (str) => {\n   str = str + '';\n   return str.substring(0, str.length - 1) + '<strong>' + _.last(str) + '</strong>';\n}\n/* formatter to calcualte the percent of a value of another value */\nrv.formatters['percent-of'] = (changed, original) => {\n   if(changed === undefined || !original)\n      return undefined;\n   return (100*(changed - original)/original).toFixed(2)+'%';\n}\n\nrv.formatters['is-valid-email'] = (email) => email === '' || validateEmail(email);\nrv.formatters['is-valid-date'] = (date, format =  'YYYY-MM-DD') => moment(date, format, true).isValid();\nrv.formatters['is-valid-regex'] = (str, regex) => new RegExp(regex).test(str);\nrv.formatters.length = (value) => value.length;\n\n/* Debouncing enforces that a function not be called again until a certain amount of time has passed without it being called.\n       As in \"execute this function only if 100 milliseconds have passed without it being called.\" */\nrv.formatters.debounce = (value, callback, timeout = 250) => {\n   clearTimeout(callback._timer_notify);\n   callback._timer_notify = setTimeout(callback.bind(undefined,value), timeout);\n   return value;\n}\n\n/* turn current select item into a jquery-ui-selectmenu, update value on change */\nrv.binders.selectmenu = {\n   priority: 101,\n   publishes: true,\n   bind: function (el) {\n      const publish = this.publish,\n         select = $(el);\n      select.selectmenu({\n         classes: {\n           \"ui-selectmenu-button\": \"ui-selectmenu-button ui-state-default\"\n         },\n         change: () => {\n            publish(select.val());\n            select.trigger('change');\n         }\n      });\n   },\n   unbind: (el) => $(el).selectmenu( \"destroy\" ),\n   routine: (el, value) => {\n      el = $(el);\n      el.val(value);\n      if(el.find(\"option[value='\" + value + \"']\").length > 0)\n         el.selectmenu('refresh');\n   }\n};\n\nrv.binders['is-valid-number'] = {\n   priority: 100,\n   publishes: true,\n   bind: function (el) {\n      const prop = this.keypath.split('.')[1];\n      const model = this.model;\n      const $input = $(el);\n      const reg = /^(?!0\\d)\\d*(\\.\\d{1,4})?$/;\n\n      $input.on('input', () => {\n         const val = $input.val();\n         const is_ok = reg.test(val);\n\n         model[prop] = is_ok && val !== '';\n      });\n   },\n   unbind: (el) => { },\n   routine: (el, value) => { }\n};\n\n/* bindar for jqueyr ui selectmenu options */\nrv.binders['selectmenu-*'] = function (el, value) {\n   $(el).selectmenu('option', this.args[0], value);\n}\n/*binder for hidding overflow on selctmenu*/\nrv.binders['selectmenu-css-*'] = function(el,value) {\n   $(el).selectmenu(\"menuWidget\").css(this.args[0], value);\n}\n\n/* refersh the selectmenu on array changes */\nrv.binders.selectrefresh = {\n   priority: 99,\n   routine: (el,array_or_value) => {\n      el = $(el);\n      if(typeof array_or_value === 'string') {\n         el.val(array_or_value);\n         if(el.find(\"option[value='\" + array_or_value+ \"']\").length === 0)\n            return;\n      }\n      el.selectmenu('refresh');\n   }\n}\n\n/* Multiselect select menu \"chosen\"*/\nrv.binders.chosen = {\n   priority: 100,\n   publishes: true,\n   bind: function(el){\n      const publish = this.publish;\n      $(el).chosen({width:$(el).css(\"width\")}).change(function() {\n         publish($(this).val())\n      });\n   },\n   unbind: (el) => $(el).chosen(\"destroy\")\n}\n\n/* binder for chosen refresh */\nrv.binders.chosenrefresh = (el) => $(el).trigger(\"chosen:updated\");\n\n/* extend jquery ui spinner to support multiple buttons */\n$.widget('ui.webtrader_spinner', $.ui.spinner, {\n   _buttonHtml: function () {\n      const btn = (dir, icon, step, radius, right) => {\n         icon = 'ui-icon-' + icon + '-1-' + (dir === 'up' ? 'n' : 's');\n         right = 'right: ' + (right || '0px') + ';';\n         radius = radius || '5px';\n         radius = 'border-radius: 0 ' + (dir == 'up' ? radius + ' 0' : '0 ' + radius) + ' 0';\n\n         return \"<button step='\" + step + \"' class='ui-spinner-button ui-spinner-\" + dir +\n            \"' style='\" + right + radius + \"'>\" +\n            \"<span class='ui-icon \" + icon +\"'>&#9650;</span>\" +\n            \"</button>\";\n      }\n\n      let ret = '';\n      ret += btn('up', 'triangle', this.options.step_big || this.options.step, '5px');\n      ret += btn('down', 'triangle', '-' +(this.options.step_big || this.options.step), '5px');\n      return ret;\n   }\n});\n/* turn input element into jquery-ui-spinner, model = {min:, max, value:},\n        the element can have attributes like 'step' and in additoin an new attribute named 'step-big'.\n        the value of these attrebutes will be used to increment/decrement on button press.  */\nrv.binders.spinner = {\n   priority: 98,\n   publishes: true,\n   bind: function (el) {\n      const model = this.model;\n      const publish = this.publish;\n      const input = $(el);\n      input.webtrader_spinner({\n         stop: () => {\n            const value = input.val();\n            publish(value * 1);\n         },\n         spin: function (e,ui) {\n            const step = $(e.currentTarget).attr('step') + '';\n            const decimals = (step.split('.')[1] || []).length;\n            value = $(this).val()*1 + step*1;\n            $(this).val(value.toFixed(decimals));\n            e.preventDefault();\n         },\n         step: input.attr('step') || 1,\n         step_big: input.attr('step-big') || null\n      });\n   },\n   unbind: (el) => $(el).webtrader_spinner('destroy'),\n   routine: (el,value) => $(el).webtrader_spinner('value', value*1)\n};\n\n/* bind values to jquery ui spinner options like 'min', 'max', ... */\nrv.binders['spinner-*'] = function(el,value) {\n   $(el).webtrader_spinner('option', this.args[0], value);\n}\n\n/* bindar for jqueyr ui dialog options */\nrv.binders['dialog-*'] = function (el, value) {\n   $(el).dialog('option', this.args[0], value);\n}\nrv.binders['color-picker'] = {\n   priority: 96,\n   publishes: true,\n   bind: function (el) {\n      const input = $(el);\n\n      const publish = this.publish;\n      const model = this.model;\n      const color = model.value || '#cd0a0a';\n\n      const altField = $('<div style=\"width:100%;\"/>');\n      input.after(altField);\n\n      input.colorpicker({\n         showOn: 'alt',\n         altField: altField,\n         position: {\n            my: \"left-100 bottom+5\",\n            of: \"element\",\n            collision: \"fit\"\n         },\n         parts:  [ 'map', 'bar' ],\n         alpha:  true,\n         layout: {\n            map: [0, 0, 2, 2],\n            bar: [2, 0, 1, 2],\n         },\n         colorFormat: \"RGBA\",\n         part: { map: {size: 128}, bar: {size: 128} },\n         select: (event, color) => publish(color)\n      });\n\n      setTimeout(() => {\n         parent = input.scrollParent();\n         parent.scroll(\n            () => input.colorpicker('close')\n         );\n      }, 1000);\n   },\n   unbind: (el) => { },\n   routine: (el, value) => { }\n}\n\nrv.binders.slider = {\n   priority: 95,\n   publishes: true,\n   bind: function (el) {\n      const div = $(el);\n      const handle = $('<div class=\"ui-slider-handle\"></div>');\n      div.append(handle);\n\n      const publish = this.publish;\n      const model = this.model;\n\n      div.slider({\n         step: div.attr('step')*1 || 1,\n         min: div.attr('min') === undefined ? 1 : div.attr('min')*1,\n         max: div.attr('max')*1 || 100,\n         create: function() {\n            handle.text($(this).slider(\"value\"));\n         },\n         slide: ( event, ui ) => {\n            handle.text(ui.value);\n            model.value = ui.value*1;\n         }\n      });\n   },\n   unbind: (el) => $(el).slider('destroy'),\n   routine: (el, value) => {\n      $(el).slider('value', value);\n      $(el).find('> div').text(value);\n   }\n}\n\n/* trun input element in jquery-ui-datepicker */\nrv.binders.datepicker = {\n   priority: 94,\n   publishes: true,\n   bind: function (el) {\n      const input = $(el);\n      const publish = this.publish;\n      const model = this.model;\n      const styles = { marginTop: input.attr('marginTop') || '0px', marginLeft: input.attr('marginLeft') || '0px' };\n\n      const options = {\n         showOn: model.showOn || 'focus',\n         numberOfMonths: input.attr('numberOfMonths')*1 || 2,\n         dateFormat: model.dateFormat || 'yy-mm-dd',\n         showAnim: model.showAnim ||  'drop',\n         showButtonPanel: model.showButtonPanel !== undefined ? model.showButtonPanel : true,\n         changeMonth: model.changeMonth || true,\n         changeYear: model.changeYear || true,\n         onSelect: function () { $(this).change(); },\n         beforeShow: (input, inst) => inst.dpDiv.css(styles),\n         closeText: 'Done'.i18n(),\n         currentText: 'Today'.i18n()\n      };\n      if(model.yearRange)\n         options.yearRange = model.yearRange;\n      else {\n         options.maxDate = model.maxDate || null;\n         options.minDate = model.minDate || 0;\n      }\n\n      const dpicker = input.datepicker(options);\n      input.on('change', () => {\n         const value = input.val();\n         publish(value);\n         input.blur(); // remove focus from input\n      });\n\n      $.datepicker._gotoToday = (id) => {\n         $(id).datepicker('setDate', new Date()).change().datepicker('hide');\n      };\n   },\n   unbind: (el) => $(el).datepicker('destroy'),\n   /* value could be Date() object or a string in yyyy-mm-dd format */\n   routine: (el, value) => $(el).datepicker(\"setDate\", value)\n}\n\n/* truen input element in to jquery-ui-timepicker */\nrv.binders.timepicker = {\n   priority: 93,\n   publishes: true,\n   bind: function (el) {\n      const input = $(el);\n      const publish = this.publish;\n      const model = this.model;\n      const allways_ok = () => true;\n\n      const styles = { marginTop: input.attr('marginTop') || '0px', marginLeft: input.attr('marginLeft') || '0px' };\n      input.on('change', () => {\n         publish(input.val());\n         input.blur();\n      });\n\n      input.timepicker({\n         showPeriod: model.showPeriod || false,\n         showLeadingZero: model.showLeadingZero || true,\n         showCloseButton: model.showCloseButton || true,\n         showNowButton: model.showNowButton || false,\n         onHourShow: model.onHourShow || allways_ok,\n         onMinuteShow: model.onMinuteShow || allways_ok,\n         beforeShow: (input, inst) => inst.tpDiv.css(styles),\n         onSelect: function(){ $(this).change() },\n         hourText: 'Hour'.i18n(),\n         minuteText: 'Minute'.i18n(),\n         amPmText: ['AM'.i18n(), 'PM'.i18n()],\n         closeButtonText: 'Done'.i18n(),\n         nowButtonText: 'Now'.i18n(),\n         deselectButtonText: 'Deselect'.i18n()\n      });\n   },\n   unbind: (el) => $(el).timepicker('destroy'),\n   routine: (el, value) => $(el).val(value)\n}\n\n/* add a css class to corresponding jquery-ui widget from the dummy html element */\nrv.binders['jq-class'] = {\n   priority: 92,\n   routine: (el, value) => {\n      el = $(el);\n      const menu = $('#' + el.attr('id') + '-menu'); // get the id of widget\n      menu.removeClass(el.data('jq-class'));\n      el.data({ 'jq-class': value });\n      menu.addClass(value);\n   }\n}\n\n/* rv binder to active click event on another button when Enter key is pressed */\nrv.binders['input-default-btn'] = (el, jquery_selector) => {\n   $(el).keyup((event) => {\n      if(event.keyCode == 13) {\n         $(jquery_selector).click();\n      }\n   });\n}\n\n/* bindar for css attributes */\nrv.binders['css-*'] = function (el, value) {\n   const style = {};\n   style[this.args[0]] = value;\n   $(el).css(style);\n}\n\n$.fn.getHiddenOffsetWidth = function () {\n   // save a reference to a cloned element that can be measured\n   const $hiddenElement = $(this).clone().appendTo('body');\n   // calculate the width of the clone\n   const width = $hiddenElement.outerWidth();\n   // remove the clone from the DOM\n   $hiddenElement.remove();\n   return width;\n};\n/* scale the font-size to fit the text on the given width*/\nrv.binders['scale-font-size'] = (el, value) => {\n   let cur_font = 14;\n   const $el = $(el);\n   do {\n      el.style.fontSize = cur_font + 'px';\n      cur_font -= 1;\n   } while($el.getHiddenOffsetWidth() > value*1)\n}\n\nrv.binders['show'] = (el, value) => {\n   el.style.display = value ? '' : 'none';\n   return value;\n};\nrv.binders['visible'] = (el, value) => {\n   el.style.visibility = value ? 'visible' : 'hidden';\n   return value;\n};\n/* binder to add or remove disabled attribute */\nrv.binders.disabled = (el,value) => {\n   if(value) $(el).attr('disabled', 'disabled');\n   else $(el).removeAttr('disabled');\n}\n\n/* binder to scroll to buttom automatically */\nrv.binders['auto-scroll-bottom'] = {\n   priority: 91, /* run after native bindings */\n   routine: (el) => {\n      $(el).animate({ scrollTop: el.scrollHeight - $(el).height() }, 'slow');\n   }\n}\n\n/* http://stackoverflow.com/questions/10454518 */\nconst decimalPlaces = (num) => {\n   const match = (''+num).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\n   let ret = 0;\n   if (match) {\n      ret = Math.max( 0, (match[1] ? match[1].length : 0) - (match[2] ? +match[2] : 0));\n   }\n   return ret;\n}\n/* rviets formatter for decimal round */\nrv.binders['decimal-round'] = {\n   priority: 3001,\n   routine: (input, places) => {\n      const mul = {'0': 1, '1': 10, '2': 100, '3': 1000, '4': 10000, '5': 100000, '8': 100000000}[places];\n      input = $(input);\n      input.on('input', () => {\n         const prefered_sign = input.attr('prefered-sign') || '';\n         const no_symbol = input.attr('no-symbol');\n         let val = input.val();\n         if(val === '') return;\n         if(val === '-' || val === '+' && !no_symbol) return;\n         const dps = decimalPlaces(val);\n         if(dps && dps <= places ) return;\n         const dot = val.endsWith('.') ? '.' : '';\n         let symbol = val[0];\n         symbol = (symbol === '+' || symbol === '-') ? symbol : '';\n         val = val.replace(/[^\\d.-]/g,'');\n         val = (Math.round(val * mul) / mul);\n         val = Math.abs(val);\n         if(!isNaN(val)) {\n            if(prefered_sign && symbol === '') symbol = prefered_sign;\n            if(no_symbol) symbol = '';\n            input.val(symbol + val + dot);\n         }\n      })\n\n   }\n}\n\n/* binder with high priority to apply attributes first */\nrv.binders['attr-*'] = {\n   priority: 10*1000,\n   routine: function(el,value) {\n      el.setAttribute(this.args[0],value)\n   }\n}\n\n/* ticks: [ {quote: ''} ] */\nrv.binders['sparkline'] = (el, spots) => {\n   const chart = $(el);\n   const config = {\n      type: 'line',\n      lineColor: '#606060',\n      fillColor: false,\n      spotColor: '#00f000',\n      minSpotColor: '#f00000',\n      maxSpotColor: '#0000f0',\n      highlightSpotColor: '#ffff00',\n      highlightLineColor: '#000000',\n      spotRadius: 1.25\n   };\n   setTimeout(() => {\n      chart.sparkline(spots, config);\n      spots.length ? chart.show() : chart.hide();\n   }, 0);\n}\n\n/* rv binder for indicative color change logic */\nrv.binders['indicative-color'] = (el, value) => {\n   const perv = (el._perv_indicative_color || 0)*1;\n   const red = '#d71818';\n   const green = '#02920e';\n   const black = 'black';\n   if(!$.isNumeric(value)) {\n      $(el).css({color: black});\n   }\n   else if(perv !== value*1) {\n      $(el).css({color: perv < value*1 ? green : red});\n   }\n   el._perv_indicative_color = value;\n}\n\n/******************************** components *****************************/\nconst component_twoway_bind = (self, data, keypathes) => {\n   /* make sure to call async */\n   setTimeout(() => {\n      for(let i = 0; i < keypathes.length; ++i){\n         const keypath = keypathes[i];\n         const key = _.last(keypath.split('.'));\n         const observer = self.observers[key];\n         if(observer) {\n            observer.options.adapters['.'].observe(observer.target, _.last(observer.keypath.split('.')), () => {\n               const updated = observer.target[_.last(observer.keypath.split('.'))];\n               data.value = updated;\n            });\n            self.componentView.observe(keypath, (value) => observer.setValue(value));\n         }\n      }\n   }, 0);\n}\nrivets.components['price-spinner'] = {\n   static: ['class', 'min'],\n   template:\n   () => `<span class=\"ui-spinner ui-widget ui-widget-content ui-corner-all\">\n               <input rv-class=\"data.class\" type=\"text\" rv-value=\"data.value\" rv-decimal-round=\"data.decimals | or 5\" no-symbol=\"no-symbol\" />\n             </span>`,\n   initialize: function(el, data) {\n      const decimals = (data.decimals || 2)*1;\n      const min = (data.min || 0)*1;\n      component_twoway_bind(this, data, ['data.value']);\n\n      return {\n         data: data\n      };\n   },\n};\n\nexport const bind = (view, state) => rv.bind(view, state);\nexport const formatters = rv.formatters;\nexport const binders = rv.binders;\n\nexport default {\n   bind,\n   formatters,\n   binders\n};\n"]}