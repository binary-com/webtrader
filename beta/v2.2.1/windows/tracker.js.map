{"version":3,"sources":["../../../../src/windows/tracker.es6"],"names":["states","local_storage","get","saved_states","symbols_promise","cached","send","trading_times","Date","toISOString","slice","then","data","markets","extractChartableMarkets","symbols","map","flatten","value","instruments","catch","err","console","when_authenticated","Promise","res","is_authenticated","events","on_till","reopen_dialogs","unique_modules","assetIndex","statement","tradingTimes","historicalData","portfolio","profitTable","token","deposit","withdraw","counter","reopen","module_id","position","mode","is_unique","is_authorized","$","click","symbol","instrumentCode","instrument","find","i","instrumentName","display_name","length","indexOf","tracker_id","require","chartWindow","isTrackerInitiated","addNewWindow","contracts_for","tradeDialog","dialog","init","template","offset","x","left","y","top","css","trigger","my","at","error","bind","forEach","isArray","d","save_states","debounce","perv_states","name","set","apply_saved_state","blankWindow","state","saved_state","pos","size","width","height","setTimeout","dialogExtend","track","options","attr","undefined","push","inx","findIndex","elem","splice","on","e","ui","workspace","reopen_trade_dialogs","trade_dialogs","get_trade_dialogs","cloneDeep","get_unique_dialogs","filter","reopen_unique_dialogs","unique_dialogs","copy","is_empty","ok","values","s","isString"],"mappings":"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","file":"tracker.js","sourcesContent":["/**\n * Created by amin on May 27, 2016.\n */\n\nimport windows from \"../windows/windows\";\nimport liveapi from \"../websockets/binary_websockets\";\nimport _ from \"lodash\";\nimport menu from \"../navigation/menu\";\n\nlet states = local_storage.get('states') || { };\nlet saved_states = { };\n\nconst symbols_promise = liveapi.cached\n   .send({ trading_times: new Date().toISOString().slice(0, 10) })\n   .then((data) => {\n      const markets = menu.extractChartableMarkets(data);\n      const symbols = _(markets).map('submarkets').flatten().map('instruments').flatten().map('symbol').value();\n      symbols.instruments = _(markets).map('submarkets').flatten().map('instruments').flatten().value();\n      return symbols;\n   })\n   .catch((err) =>{\n      console.console(err);\n      return [];\n   });\n\nconst when_authenticated = () => {\n   return new Promise((res) => {\n      if (liveapi.is_authenticated()) {\n         return res();\n      }\n      liveapi.events.on_till('login',() => {\n         res();\n         return true;\n      });\n   });\n}\nconst reopen_dialogs = (symbols, saved_states) => {\n\n   const unique_modules = {\n      assetIndex: '#nav-menu .assetIndex',\n      statement: '#nav-menu .statement',\n      tradingTimes: '#nav-menu .tradingTimes',\n      historicalData: '#nav-menu .historical-data',\n      portfolio: '#nav-menu .portfolio',\n      profitTable: '#nav-menu .profitTable',\n      token: '#nav-menu .token-management',\n      deposit: '#nav-menu .deposit',\n      withdraw: '#nav-menu .withdraw',\n   };\n\n   let counter = 0;\n   const reopen = (data, module_id) => {\n      if(data.position.mode === 'closed') return;\n\n      if(data.is_unique) {\n         if(data.is_authorized) {\n            when_authenticated().then(() => {\n               $(unique_modules[module_id]).click();\n               return true; // unsubscribe from login event\n            });\n         }\n         else {\n            $(unique_modules[module_id]).click();\n         }\n      }\n      else if(module_id === 'chartWindow') {\n         const symbol = data.data.instrumentCode;\n         const instrument = _.find(symbols.instruments, (i) => { return i.symbol==symbol; });\n         data.data.instrumentName = instrument.display_name;\n         if(symbols.length > 0 && symbols.indexOf(symbol) === -1) {\n            /* Since we get the list of ins from trading_times API,\n             * backend/quant might change the list of instruments they are offering.\n             * We just need to make sure that those charts are not getting restored. */\n            return ;\n         }\n         data.data.tracker_id = ++counter;\n         require(['charts/chartWindow'],(chartWindow) => {\n            data.data.isTrackerInitiated = true;\n            chartWindow.addNewWindow(data.data);\n         });\n      }\n      else if(module_id === 'tradeDialog') {\n         when_authenticated().then(() => {\n            data.data.tracker_id = ++counter;\n            liveapi\n               .send({contracts_for: data.data.symbol.symbol})\n               .then((res) => {\n                  require(['trade/tradeDialog'], (tradeDialog) => {\n                     const dialog = tradeDialog.init(data.data.symbol, res.contracts_for, data.data.template, true/*isTrackerInitiated*/);\n                     if(data.position.offset) {\n                        const x = data.position.offset.left;\n                        const y = data.position.offset.top;\n                        dialog.dialog('widget').css({\n                           left: x + 'px',\n                           top: y + 'px'\n                        });\n                        dialog.trigger('animated');\n                        /* update dialog option.position */\n                        dialog.dialog(\"option\", \"position\", { my: x, at: y });\n                     }\n                  });\n               }).catch(console.error.bind(console));\n            return true; // unsubscribe from login event\n         });\n      }\n      else {\n         console.error('unknown module_id ' + module_id);\n      }\n   };\n   _.forEach(saved_states,(data, module_id) => {\n      if(module_id === 'name') return; // ignore name\n      if(_.isArray(data))\n         data.forEach((d) => reopen(d, module_id))\n      else\n         reopen(data, module_id);\n   });\n}\n\n// /* avoid too many writes to local storage */\nconst save_states = _.debounce(() => {\n   const perv_states = local_storage.get('states');\n   states.name = (perv_states && perv_states.name) || states.name;\n   local_storage.set('states', states)\n}, 50);\n\nconst apply_saved_state = (dialog, blankWindow, state, saved_state) => {\n   const pos = saved_state.position;\n\n   pos.size && blankWindow.dialog('option', 'width', pos.size.width);\n   pos.size && blankWindow.dialog('option', 'height', pos.size.height);\n   state.position.size = pos.size;\n   state.position.mode = pos.mode;\n\n   if(pos.mode === 'maximized')\n      setTimeout(() => {\n         blankWindow.dialogExtend('maximize');\n         blankWindow.dialog('moveToTop');\n      }, 10);\n   else if(pos.mode === 'minimized')\n      blankWindow.dialogExtend('minimize');\n\n   if(pos.offset) {\n      dialog.css({\n         left: pos.offset.left + 'px',\n         top: pos.offset.top + 'px'\n      });\n      state.position.offset = pos.offset;\n   }\n\n   save_states();\n}\n\n/* options: {\n *    module_id: 'statement/statement'  // require js module id\n *    is_unique: true/false // is this dialog instance unique or not,\n *    data: { } // arbitary data object for this dialog\n * }\n * blankWindow // dialog returned from windows.createBlankWindow()\n *\n * returns: a function that can be used to update the data\n */\nexport const track = (options, blankWindow) => {\n   const dialog = blankWindow.dialog('widget');\n   let saved_state = null;\n   const state = {\n      module_id: options.module_id,\n      is_unique: options.is_unique,\n      is_authorized: blankWindow.attr('data-authorized') === 'true',\n      data: options.data,\n      position: {\n         size: { width: blankWindow.dialog('option', 'width'), height: blankWindow.dialog('option', 'height') },\n         offset: undefined,\n         mode: 'normal'\n      }\n   };\n   if(options.is_unique){\n      states[options.module_id] = state;\n      saved_state = saved_states[options.module_id];\n      if(saved_state){\n         if(saved_state.position.mode === 'closed')\n            saved_state = null;\n         delete saved_states[options.module_id];\n      }\n   }\n   else {\n      states[options.module_id] = states[options.module_id] || [];\n      states[options.module_id].push(state);\n\n      if(saved_states[options.module_id] && state.data.tracker_id !== undefined) {\n         const inx = _.findIndex(\n            saved_states[options.module_id],\n            (elem) => elem.data.tracker_id === state.data.tracker_id\n         );\n         if(inx !== -1) {\n            saved_state = saved_states[options.module_id][inx];\n            saved_states[options.module_id].splice(inx, 1);\n            if(saved_state.position.mode === 'closed')\n               saved_state = null;\n         }\n      }\n   }\n   save_states();\n   dialog.on('dragstop',() => {\n      state.position.offset = dialog.offset();\n      save_states();\n   });\n   dialog.on('animated',() => {\n      state.position.offset = dialog.offset();\n      save_states();\n   });\n   dialog.on('resizestop',(e, ui) => {\n      state.position.size = ui.size;\n      state.position.offset = dialog.offset();\n      save_states();\n   });\n   blankWindow.on('dialogextendminimize',() => {\n      state.position.mode = 'minimized';\n      save_states();\n   });\n   blankWindow.on('dialogextendmaximize',() => {\n      state.position.mode = 'maximized';\n      save_states();\n   });\n   blankWindow.on('dialogextendrestore',() => {\n      state.position.offset = dialog.offset();\n      state.position.mode = 'normal';\n      save_states();\n   });\n   blankWindow.on('dialogdestroy',() => {\n      if(state.is_unique){\n         delete states[state.module_id];\n      }\n      else {\n         if(states[state.module_id]) { /* if not already cleared by switching between accounts */\n            const inx = states[state.module_id].indexOf(state);\n            if(states[state.module_id].length == 1)\n               delete states[state.module_id];\n            else\n               states[state.module_id].splice(inx, 1);\n         }\n      }\n      save_states();\n   });\n   blankWindow.on('dialogclose',() => {\n      state.position.mode = 'closed';\n      save_states();\n   });\n   blankWindow.on('dialogopen',() => {\n      state.position.offset = dialog.offset();\n      state.position.mode = 'normal';\n      save_states();\n\n      if(saved_state){\n         apply_saved_state(dialog, blankWindow, state, saved_state);\n         saved_state = null;\n      }\n   });\n\n\n   return (data) => {\n      state.data = data;\n      save_states();\n   };\n}\n\nexport const reopen = (workspace = null) => {\n   if(workspace) {\n      states = workspace;\n   }\n   symbols_promise.then((symbols) => {\n      saved_states = states;\n      states = { };\n      save_states();\n      reopen_dialogs(symbols, saved_states);\n   });\n};\n\n/* used in case of connection drops in binary_websockets onclose() function */\nexport const reopen_trade_dialogs = (trade_dialogs) => {\n   symbols_promise.then((symbols) => {\n      reopen_dialogs(symbols, {tradeDialog: trade_dialogs});\n   });\n};\n\nexport const get_trade_dialogs = () => _.cloneDeep(states.tradeDialog || []);\n\nexport const get_unique_dialogs = () => _.filter(states, {is_unique: true});\n\nexport const reopen_unique_dialogs = (unique_dialogs) => {\n      const copy = {};\n      _.forEach(unique_dialogs, data => {\n            copy[data.module_id] = copy[data.module_id] || [];\n            data.position.mode = 'normal';\n            copy[data.module_id].push(data);\n      });\n      reopen_dialogs(null, copy);\n} \n\nexport const is_empty = () => {\n   const ok = _.values(states).filter(\n      (s) => !_.isString(s) && (_.isArray(s) || s.position.mode !== 'closed')\n   );\n   return ok.length === 0;\n}\n\nexport default {\n   track,\n   reopen,\n   reopen_trade_dialogs,\n   get_trade_dialogs,\n   is_empty,\n   get_unique_dialogs,\n   reopen_unique_dialogs\n}\n"]}