{"version":3,"sources":["../../../../src/windows/windows.es6"],"names":["dialogCounter","calculateChartCount","options","extend","width","height","rows","Math","floor","window","cols","isSmallView","total","callbacks","fire_event","name","args","fns","forEach","cb","setTimeout","apply","undefined","addDateToHeader","title","date","changed","cleared","addDateDropDowns","header","parent","find","addClass","opts","numberOfDays","year","month","isLeap","update","select","render","v","children","remove","i","min","max","val","text","appendTo","initial","selectmenu","_title","prependTo","updating","value","dt","Date","insertAfter","classes","day","getFullYear","getMonth","inx","getDate","trigger_change","yyyy_mm_dd","UTC","toISOString","slice","onchange","on","update_day","split","clear","addDatePicker","dpicker_input","add_clear_button","input","button_pane","datepicker","i18n","click","onclear","showOn","numberOfMonths","maxDate","minDate","dateFormat","showAnim","showButtonPanel","changeMonth","changeYear","onSelect","change","beforeShow","inst","dpDiv","css","marginTop","marginLeft","onChangeMonthYear","closeText","currentText","dpicker","_gotoToday","id","next","button","icons","primary","date_string","dropdonws","getScrollHeight","without_body","bottoms","map","d","$d","$w","hasClass","offset","top","push","fixMinimizedDialogsPosition","footer_height","scroll_bottom","document","scrollTop","init","$parentObj","original","fn","dialog","cmd","trigger","call","arguments","require","chartWindowObj","liveapi","menu","is_empty","reopen","counts","cached","send","trading_times","then","markets","extractChartableMarkets","rand","arr","random","length","timePeriods","chartTypes","submarkets","symbols","instruments","sym","timePeriod","chart_type","addNewWindow","instrumentCode","symbol","instrumentName","display_name","type","delayAmount","delay_amount","tileDialogs","local_storage","get","oauth","Promise","all","authorize","acc","token","req","results","data","unshift","is_jpy_account","loginid","is_virtual","landing_company_name","indexOf","set","invalidate","growl","error","message","duration","catch","err","code","ele","match","switch_account","console","scroll","createBlankWindow","$html","autoOpen","resizable","collapsable","my","at","of","hide","close","minimize","maximize","open","promise","done","left","minWidth","minHeight","resize","restore","blankWindow","attr","ignoreTileAction","dialogExtend","draggable","animate","bind","destroy","moveToTop","effect","times","distance","add_to_windows_menu","cleaner","addDialog","attributes","Object","keys","filter","key","startsWith","refresh","append","track","makeSelectmenu","list","update_select","update_list","new_list","event_on","event_off","index","splice"],"mappings":"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","file":"windows.js","sourcesContent":["\n/**\n * Created by arnab on 2/18/15.\n */\n\nimport $ from 'jquery';\nimport _ from 'lodash';\nimport navigation from 'navigation/navigation';\nimport tracker from 'windows/tracker';\nimport 'jquery.dialogextend';\nimport 'modernizr';\nimport 'common/util';\nimport 'css!windows/windows.css';\nimport workspace from  '../workspace/workspace.js';\n\nlet dialogCounter = 0;\n\n/* options: { width: 350, height: 400 } */\nconst calculateChartCount = (options) => {\n   options = $.extend({ width: 350, height: 400 }, options);\n   let rows = Math.floor($(window).height() / options.height) || 1,\n      cols = Math.floor($(window).width() / options.width) || 1;\n\n   if (isSmallView()) //For small size screens\n      rows = cols = 1;\n   /**** limi the number of charts to 4 ****/\n   if(rows * cols > 4) {\n      rows = 1;\n      cols = 4;\n   };\n   return {\n      rows: rows,\n      cols: cols,\n      total: rows * cols\n   };\n}\n\nlet callbacks = {};\n/* fire a custom event and call registered callbacks(api.events.on(name)) */\nconst fire_event = (name , ...args) => {\n   const fns = callbacks[name] || [];\n   fns.forEach(function (cb) {\n      setTimeout(function(){\n         cb.apply(undefined, args);\n      },0);\n   });\n}\n\n\n/*\n     @param: options.date    javascript Date object representing initial time\n     @param: options.title   the header title for spinners\n     @param: options.changed  called when Date changes, callback argument is a string in yyyy_mm_dd format.\n   useage:\n      var win = createBlankWindow(...);\n      win.addDateToHeader({date:new Date(), title: 'sub header', changed: fn});\n      */\nconst addDateToHeader = function(options) {\n   options = $.extend({\n      title: 'title',\n      date: null,\n      changed: () => { },\n      cleared: () => { },\n      addDateDropDowns: true,\n   },options);\n\n   const header = this.parent().find('.ui-dialog-title').addClass('with-content');\n\n\n   /* options: {date: date, onchange: fn } */\n   const addDateDropDowns = (opts) => {\n      // note that month is 0-based, like in the Date object. Adjust if necessary.\n      const numberOfDays = (year, month) => {\n         var isLeap = ((year % 4) == 0 && ((year % 100) != 0 || (year % 400) == 0));\n         return [31, (isLeap ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];\n      }\n\n      const update = function(select, options) {\n         var render = options.render || (v => v + '');\n         select.children().remove();\n         /* add the title */\n         for (let i = options.min; i <= options.max; ++i)\n            $('<option/>').val(i).text(render(i)).appendTo(select);\n         select.val(options.initial || options.min);\n         select.selectmenu('refresh');\n\n         select.title = select.title || (function(text) {\n            if (text) {\n               select._title = select._title || $('<option/>').val(-1).prependTo(select);\n               select._title.text(text);\n               select.updating = true;\n               select.val(-1).selectmenu('refresh');\n               select.updating = false;\n            }\n            else {\n               if (select._title) {\n                  const value = select.val() === -1 ? options.initial : select.val();\n                  select._title.remove();\n                  select.updating = true;\n                  select.val(value).selectmenu('refresh');\n                  select.updating = false;\n                  this._title = null;\n               }\n            }\n         });\n\n         return select;\n      }\n\n      const dt = opts.date || new Date();\n      let year = $('<select />').insertAfter(header).selectmenu({ classes: {\"ui-selectmenu-button\": \"ui-selectmenu-button ui-state-default\"}, width: 'auto' });\n      let month = $('<select />').insertAfter(header).selectmenu({ classes: {\"ui-selectmenu-button\": \"ui-selectmenu-button ui-state-default\"}, width: 'auto' });\n      let day = $('<select />').insertAfter(header).selectmenu({ classes: {\"ui-selectmenu-button\": \"ui-selectmenu-button ui-state-default\"}, width: 'auto'});\n      day.selectmenu( \"menuWidget\" ).addClass('date-day'); \n      year = update(year, { min: 2010, max: dt.getFullYear(), initial: dt.getFullYear()});\n      month = update(month, {\n         min: 0, max: 11, initial: dt.getMonth(),\n         render: (inx) => ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'][inx]\n      });\n      day = update(day, { min: 1, max: numberOfDays(dt.getFullYear(),dt.getMonth()), initial: dt.getDate()});\n\n      /* add title elements if no date is specified */\n      if (!opts.date) {\n         year.title('Year');\n         month.title('Month');\n         day.title('Day');\n      }\n\n      const trigger_change = () => {\n         /* TODO: search other files and make sure to use a UTC date */\n         const yyyy_mm_dd = new Date(Date.UTC(year.val(), month.val(), day.val())).toISOString().slice(0, 10);\n         opts.onchange(yyyy_mm_dd);\n      }\n      day.on('selectmenuchange', () => {\n         if (day.updating) {\n            return;\n         }\n         day.title(null);\n         month.title(null);\n         year.title(null);\n\n         trigger_change();\n      });\n\n      const update_day = () => {\n         const options = { min: 1, max: numberOfDays(year.val(), month.val()), initial: day.val() };\n         if (options.initial > options.max)\n            options.initial = options.min;\n         update(day, options);\n      };\n\n      [year, month].forEach(function (select) {\n         select.on('selectmenuchange', function () {\n            if (month.updating || year.updating) return;\n            day.title(null);\n            month.title(null);\n            year.title(null);\n            update_day();\n            trigger_change();\n         });\n      })\n      return {\n         update: (yyyy_mm_dd) => {\n            day.title(null);\n            month.title(null);\n            year.title(null);\n            var args = yyyy_mm_dd.split('-');\n            year.val(args[0] | 0); year.selectmenu('refresh');\n            month.val((args[1] | 0)-1); month.selectmenu('refresh');\n            day.val(args[2] | 0); update_day();\n         },\n         clear: () => {\n            year.title('Year');\n            month.title('Month');\n            day.title('Day');\n         }\n      };\n   }\n\n   /* options: {date: date, onchange: fn} , events => element.on('change',...) */\n   const addDatePicker = (opts) => {\n      const dpicker_input = $(\"<input type='hidden' />\")\n         .insertAfter(header);\n      const add_clear_button = (input) => {\n         /* Run this after date-picker is constructed\n                Source: stackoverflow.com/questions/4598850 */\n         setTimeout(() => {\n            const button_pane = $(input)\n               .datepicker('widget')\n               .find('.ui-datepicker-buttonpane');\n\n            $('<button/>', {\n               text: 'Clear'.i18n(),\n               click: function () {\n                  opts.onclear && opts.onclear();\n                  $(input).datepicker('hide');\n               }\n            })\n               .addClass('ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all')\n               .appendTo(button_pane);\n         }, 0);\n      };\n\n      var options = {\n         showOn: 'both',\n         numberOfMonths: 1,\n         maxDate: 0,\n         minDate: new Date(2010, 0, 1),\n         dateFormat: 'yy-mm-dd',\n         showAnim: 'drop',\n         showButtonPanel: true,\n         changeMonth: true,\n         changeYear: true,\n         onSelect: function () { $(this).change(); },\n         beforeShow: (input, inst) => {\n            add_clear_button(input);\n            inst.dpDiv.css({ marginTop: '10px', marginLeft: '-220px' });\n         },\n         onChangeMonthYear:add_clear_button,\n         closeText: 'Done'.i18n(),\n         currentText: 'Today'.i18n()\n      };\n\n      const dpicker = dpicker_input\n         .datepicker(options)\n         .datepicker(\"setDate\", opts.date.toISOString().slice(0, 10));\n\n      $.datepicker._gotoToday = (id) => {\n         $(id).datepicker('setDate', new Date()).change().datepicker('hide');\n      };\n\n      /* use JQ-UI icon for datepicker */\n      dpicker .next('button') .text('')\n         .button({ icons: { primary: 'ui-icon-calendar' } });\n\n      dpicker_input.on('change', function () {\n         const yyyy_mm_dd = $(this).val();\n         opts.onchange && opts.onchange(yyyy_mm_dd);\n      });\n      return dpicker_input;\n   }\n\n\n   const date_string = $('<span style=\"line-height: 24px; position: relative; left: 10px\"></span>');\n   const dpicker = addDatePicker({\n      date: options.date || new Date(),\n      onchange: (yyyy_mm_dd) => {\n         date_string.text(yyyy_mm_dd);\n         dropdonws && dropdonws.update(yyyy_mm_dd);\n         options.changed(yyyy_mm_dd);\n      },\n      onclear: () => {\n         dropdonws && dropdonws.clear();\n         options.cleared();\n      }\n   });\n   let dropdonws = null;\n   if(options.addDateDropDowns) {\n      dropdonws = addDateDropDowns({\n         date: options.date, onchange: (yyyy_mm_dd) => {\n            dpicker.datepicker(\"setDate\", yyyy_mm_dd);\n            options.changed(yyyy_mm_dd);\n         }\n      });\n   }\n   else {\n      date_string.insertAfter(header);\n      date_string.text(options.date.toISOString().slice(0, 10));\n   }\n\n   $('<span class=\"span-in-dialog-header\">' + options.title + '</span>').insertAfter(header);\n\n   return {\n      clear:() => dropdonws && dropdonws.clear()\n   };\n}\n\nconst getScrollHeight = (without_body) => {\n   var bottoms = $('.ui-dialog').map((inx, d) => {\n      const $d = $(d);\n      const $w = $d.find('.webtrader-dialog');\n      if($w && $w.hasClass(\"ui-dialog-content\") && !$w.hasClass('ui-dialog-minimized')) {\n         const offset = $d.offset();\n         return (offset && (offset.top + $d.height())) || 0;\n      }\n      return 0;\n   });\n   if(!without_body) {\n      bottoms.push($('body').height());\n   }\n   return  Math.max.apply(null, bottoms);\n}\n\nconst fixMinimizedDialogsPosition = () => {\n   var footer_height = $('.addiction-warning').height();\n   var scroll_bottom = $(document).height() - $(window).height() - $(window).scrollTop();\n   $(\"#dialog-extend-fixed-container\").css(\"bottom\", Math.max(0, footer_height - scroll_bottom));\n}\n\n\nexport const init = function($parentObj) {\n   /* wrap jquery ui dialog('destory') to fire an event */\n   var original = $.fn.dialog;\n   $.fn.dialog = function(cmd) {\n      if(cmd === 'destroy') {\n         this.trigger('dialogdestroy');\n         return original.call(this, 'destroy'); // destroy and remove from dom\n      }\n      return original.apply(this, arguments);\n   }\n\n   require([\"charts/chartWindow\",\"websockets/binary_websockets\", \"navigation/menu\"], (chartWindowObj,liveapi, menu) => {\n      if(!tracker.is_empty()) {\n         tracker.reopen();\n         return;\n      }\n      const counts = calculateChartCount();\n      liveapi\n         .cached.send({trading_times: new Date().toISOString().slice(0, 10)})\n         .then((markets) => {\n            markets = menu.extractChartableMarkets(markets);\n            /* return a random element of an array */\n            const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];\n            const timePeriods = ['2h', '4h', '8h', '1d'];\n            const chartTypes = ['candlestick', 'line', 'ohlc', 'spline']; //This is not the complete chart type list, however its good enough to randomly select one from this subset\n            for (let inx = 0; inx < counts.total; ++inx) {\n               const submarkets = rand(markets).submarkets;\n               const symbols = rand(submarkets).instruments;\n               const sym = rand(symbols);\n               const timePeriod = rand(timePeriods);\n               const chart_type = rand(chartTypes);\n\n               chartWindowObj.addNewWindow({\n                  instrumentCode: sym.symbol,\n                  instrumentName: sym.display_name,\n                  timePeriod: timePeriod,\n                  type: chart_type,\n                  delayAmount: sym.delay_amount\n               });\n            }\n            workspace.tileDialogs(); // Trigger tile action\n         });\n   });\n\n   /* automatically log the user in if we have oauth_token in local_storage */\n   require(['websockets/binary_websockets' ], (liveapi) => {\n      if(!local_storage.get('oauth')) {\n         return;\n      }\n      /* query string parameters can tempered.\n             make sure to get loginid from webapi instead */\n      var oauth = local_storage.get('oauth');\n      Promise.all(\n         oauth.slice(1)\n            .map(acc => ({ authorize: acc.token}))\n            .map(req => liveapi.send(req))\n      )\n         .then((results) =>\n            liveapi.cached.authorize()\n               .then((data) => {\n                  results.unshift(data);\n                  let is_jpy_account = false;\n                  for(let i = 0; i < results.length; ++i) {\n                     oauth[i].id = results[i].authorize.loginid;\n                     oauth[i].is_virtual = results[i].authorize.is_virtual;\n                     if (results[i].authorize.landing_company_name.indexOf('japan') !== -1) {\n                        is_jpy_account = true;\n                     }\n                  }\n                  local_storage.set('oauth', oauth);\n                  return is_jpy_account;\n               })\n         )\n         .then((is_jpy_account) => {\n            /* Japan accounts should not be allowed to login to webtrader */\n            if(is_jpy_account && is_jpy_account === true) {\n               liveapi.invalidate();\n               $.growl.error({message: 'Japan accounts are not supported.'.i18n(), duration: 6000 });\n               local_storage.remove('oauth');\n               local_storage.remove('oauth-login');\n            }\n         })\n         .catch((err) => {\n            //Switch to virtual account on selfexclusion error.\n            if(err.code===\"SelfExclusion\"){\n               //Login to virtual account instead.\n               oauth.forEach((ele, i) => {\n                  if(ele.id.match(/^VRTC/)){\n                     liveapi.switch_account(ele.id);\n                     return;\n                  }\n               });\n               return;\n            }\n            console.error(err.message);\n            $.growl.error({message: err.message});\n            //Remove token and trigger login-error event.\n            local_storage.remove('oauth');\n            $(\".login\").trigger(\"login-error\");\n         });\n   });\n   $(window).scroll(fixMinimizedDialogsPosition);\n   return this;\n}\n\n/* important options: {\n   title:'',\n   resize:fn, // callabak for dialog resize event\n   close: fn, // callback for dialog close event\n   open: fn,  // callback for dialog open event\n   destroy: fn, // callback for dialog destroy event\n   refresh: fn, // callback for refresh button click\n   autoOpen: false,\n   resizable:true,\n   collapsable:false,\n   minimizable: true,\n   maximizable: true,\n   closable:true,\n   modal:true, // Whether to block base page and show it as blocking modal dialog\n   closeOnEscape:true, // Respond to ESC key event\n   ignoreTileAction:false, // Is this dialog going to take part in tile action\n   data-*: 'value' // add arbitary data-* attributes to the dialog.('data-authorized' for exmaple)\n}\nnotes:\n    1- get generated dialog id via createBlankWindow(...).attr('id')\n    2- if autoOpen == false  use createBalnkWindow(...).dialog('open') to open the dialog\n    2- if minWidth and minHeight are not specified the options.width and options.height will be used for minimums.\n */\nexport const createBlankWindow = function($html,options) {\n   $html = $($html);\n   const id = \"windows-dialog-\" + ++dialogCounter;\n   options = $.extend({\n      autoOpen: false,\n      resizable: true,\n      collapsable: false,\n      width: 350,\n      height: 400,\n      my: 'center',\n      at: 'center',\n      of: window,\n      title: 'Blank window'.i18n(),\n      hide: 'fade',\n      icons: {\n         close: 'custom-icon-close',\n         minimize: 'custom-icon-minimize',\n         maximize: 'custom-icon-maximize'\n      },\n      open: function() {\n         $(this).promise().done(function () {\n            const parent = $(this).parent();\n            parent.css({\n               top: `+=${(Math.random()*30 | 0) + 20}`,\n               left: `+=${(Math.random()*40 | 0) - 20}`,\n            });\n         });\n      }\n   }, options || {});\n   options.minWidth = options.minWidth || options.width;\n   options.minHeight = options.minHeight || options.height;\n\n   if (options.resize)\n      options.maximize = options.minimize  = options.restore = options.resize;\n\n   const blankWindow = $html.attr(\"id\", id);\n   if (!options.ignoreTileAction) blankWindow.addClass('webtrader-dialog')\n   blankWindow.dialog(options).dialogExtend(options);\n\n\n   const dialog = blankWindow.dialog('widget');\n   dialog.addClass('webtrader-dialog-widget');\n   /* allow dialogs to be moved though the bottom of the page */\n   dialog.draggable( \"option\", \"containment\", false );\n   dialog.draggable( \"option\", \"scroll\", true );\n   dialog.on('dragstop', () => {\n      const top = dialog.offset().top;\n      if(top < 0) {\n         dialog.animate({ top: '0px' }, 300, dialog.trigger.bind(dialog, 'animated'));\n      }\n   });\n\n   if(options.destroy) { /* register for destroy event which have been patched */\n      blankWindow.on('dialogdestroy', options.destroy);\n   }\n\n   blankWindow.moveToTop = () => {\n      blankWindow.dialog('open');\n      blankWindow.dialogExtend('restore');\n      blankWindow.dialog('widget').effect(\"bounce\", { times: 2, distance: 15 }, 450);\n   };\n\n   // add an item to window menu\n   const add_to_windows_menu = () => {\n      const cleaner = workspace.addDialog(options.title, blankWindow.moveToTop, () => blankWindow.dialog('close'));\n      blankWindow.on('dialogclose', cleaner);\n\n   };\n   if(!options.ignoreTileAction) {\n      add_to_windows_menu();\n   }\n\n   if (options.resize) {\n      options.resize.call($html[0]);\n   }\n   blankWindow.addDateToHeader = addDateToHeader;\n\n   /* set data-* attributes on created dialog */\n   const attributes = Object.keys(options).filter((key) =>  _.startsWith(key, 'data-') );\n   attributes.forEach((key) => blankWindow.attr(key, options[key]) );\n\n   /* check and add the refresh button if needed */\n   if(options.refresh){\n      const header = blankWindow.parent().find('.ui-dialog-title');\n      const refresh = header.append(\"<img class='reload' src='images/refresh.svg' title='reload'/>\").find(\".reload\");\n      refresh.on('click',options.refresh);\n   }\n\n   /* options: {\n    *    module_id: 'statement/statement'  // require js module id\n    *    is_unique: true/false // is this dialog instance unique or not,\n    *    data: { } // arbitary data object for this dialog\n    * } */\n   blankWindow.track = (options) => tracker.track(options, blankWindow);\n\n   blankWindow.destroy = () => {\n      if(blankWindow.data('ui-dialog')) {\n         blankWindow.dialog('destroy');\n      }\n      blankWindow.remove();\n   };\n   return blankWindow;\n};\n\n/*\n   Uses a jquery-ui spinner to display a list of strings.\n       @param: options.index       initial value of the array to show.\n       @param: options.list        array of string items to show\n       @param: options.changed     callback thats i called when menu is changed.\n       @param: options.width       can specify the with of selectmenu.\n   Note: you should add your input to dom before turning it a spinner.\n\n   Note: you can call 'update_list(...)' on the returned spinner to update the list of items:\n       var spinner = makeTextSpinner(input,{list:['a,'b','c'],inx:0});\n       spinner.update_list(['a','d','e','f']);\n\n   TODO: move this to a utility file\n*/\nexport const makeSelectmenu = function (select, options) {\n   options = $.extend({\n      list: ['empty'],\n      inx: 0,\n      changed:  () => { }\n   }, options);\n\n   var inx = options.inx, list = options.list;\n   var update_select = (list) => {\n      select.children().remove();\n      for(let i = 0; i < list.length; ++i)\n         $('<option/>').val(list[i]).text(list[i]).appendTo(select);\n   }\n   update_select(list);\n   select.val(list[inx]);\n\n   select = select.selectmenu({ \n         classes: {\n           \"ui-selectmenu-button\": \"ui-selectmenu-button ui-state-default\"\n         },\n         width: options.width \n      });\n   select.on('selectmenuchange', function () {\n      var val = $(this).val();\n      options.changed(val);\n   })\n\n   select.update_list = (new_list) => {\n      update_select(new_list);\n      select.val(new_list[0]);\n      select.selectmenu('refresh');\n   }\n   return select;\n};\n\nexport const event_on = (name, cb) => {\n   (callbacks[name] = callbacks[name] || []).push(cb);\n   return cb;\n}\n\nexport const event_off = (name, cb) => {\n   if(callbacks[name]) {\n      var index = callbacks[name].indexOf(cb);\n      index !== -1 && callbacks[name].splice(index, 1);\n   }\n}\n\nexport default {\n   init,\n   createBlankWindow,\n   makeSelectmenu\n};\n"]}