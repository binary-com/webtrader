{"version":3,"sources":["../../../../src/oauth/login.es6"],"names":["login_win","login_win_view","init","moveToTop","root","$","i18n","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","width","height","close","dialog","remove","open","destroy","unbind","parent","css","init_state","offset","top","my","left","at","find","win","app_id","state","route","value","login","disabled","registration","email","validate","email_show_explanation","validateEmail","account","empty_fields","clear","debounce","show","password_error_message","password","length","test","verification","repeat_password","residence","residence_list","text","residence_unsupported","confirm","config","local_storage","get","lang","oauth_url","window","location","update","routes","create","send","verify_email","type","then","data","growl","notice","message","msg_type","catch","err","console","error","ok","request","new_account_virtual","verification_code","client_password","oauth","id","client_id","token","oauth_token","set","cached","authorize","bind","map","r","push","website_status","clients_country","indexOf"],"mappings":"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","file":"login.js","sourcesContent":["/*\n * Created by amin on May 1, 2016.\n */\n\nimport liveapi from '../websockets/binary_websockets';\nimport windows from '../windows/windows';\nimport rv from '../common/rivetsExtra';\nimport _ from 'lodash';\nimport html from 'text!./login.html';\nimport 'css!./login.css';\n\nlet login_win = null;\nlet login_win_view = null; // rivets view\n\nexport const init = () => {\n   if(login_win){\n      login_win.moveToTop();\n      return;\n   }\n\n   const root = $(html).i18n();\n   login_win = windows.createBlankWindow(root, {\n      title: 'Log in',\n      resizable:false,\n      collapsable:false,\n      minimizable: false,\n      maximizable: false,\n      width: 548,\n      height: 'auto',\n      close: () => {\n         login_win.dialog('destroy');\n         login_win.remove();\n         login_win = null;\n      },\n      open: () => { },\n      destroy: () => {\n         login_win_view && login_win_view.unbind();\n         login_win_view = null;\n      }\n   });\n   login_win.parent().css('overflow', 'visible');\n\n   init_state(root, login_win);\n   login_win.dialog('open');\n\n   /* update dialog position, this way when dialog is resized it will not move*/\n   const offset = login_win.dialog('widget').offset();\n   offset.top = 120;\n   login_win.dialog(\"option\", \"position\", { my: offset.left, at: offset.top });\n   login_win.dialog('widget').css({\n      left: offset.left + 'px',\n      top: offset.top + 'px'\n   });\n   login_win.dialog('widget').find('.ui-selectmenu-menu ul').css('max-height', '320px');\n}\n\nconst init_state = (root, win) => {\n   const app_id = liveapi.app_id;\n   const state = {\n      route: { value: 'login' },\n      login: { disabled: false },\n      registration: {\n         email: '',\n         disabled: false,\n         validate: { value: false },\n         email_show_explanation: () => {\n            const email = state.registration.email;\n            return (email === '' && !state.registration.validate.value) || validateEmail(email);\n         },\n      },\n      account: {\n         empty_fields: {\n            validate: false,\n            clear: _.debounce(() => {\n               state.account.empty_fields.validate = false;\n            }, 2000),\n            show: () => {\n               state.account.empty_fields.validate = true;\n               state.account.empty_fields.clear();\n            }\n         },\n         password_error_message: () => {\n            const password = state.account.password;\n            if(password === '') return state.account.empty_fields.validate ? 'You should enter between 6-25 characters.'.i18n() : '';\n            if(password.length < 6) return 'Password must be 6 characters minimum'.i18n();\n            if(!/\\d/.test(password) || !/[a-z]/.test(password) || !/[A-Z]/.test(password)) return 'Password must contain lower and uppercase letters with numbers'.i18n();\n            return '';\n         },\n         verification: '',\n         password: '',\n         repeat_password:  '',\n         residence: '',\n         residence_list: [ { text: 'Indonesia', value: 'id'}],\n         residence_unsupported: [],\n         disabled: false, /* is button disabled */\n      },\n      confirm: { disabled: false }\n   };\n\n   state.login.login = () => {\n      state.login.disabled = true;\n      const config = local_storage.get('config');\n      const lang = (local_storage.get('i18n') || {value:\"en\"}).value;\n      const oauth_url = (config && config.oauth_url) || 'https://oauth.binary.com/oauth2/authorize';\n      window.location =  oauth_url + '?app_id=' + app_id + '&l=' +lang;\n   }\n\n   state.confirm.confirm = () => {\n      state.confirm.disabled = true;\n      const config = local_storage.get('config');\n      const oauth_url = (config && config.oauth_url) || 'https://oauth.binary.com/oauth2/authorize';\n      window.location =  oauth_url + '?app_id=' + app_id;\n   }\n\n   state.route.update = (route) => {\n      const routes = {\n         login: {\n            title: 'Log in'.i18n(),\n            height: 180\n         },\n         registration: {\n            title: 'Registration'.i18n(),\n            height: 220,\n         },\n         account: {\n            title: 'Account opening'.i18n(),\n            height: 465\n         },\n         confirm: {\n            title: 'Account opening'.i18n(),\n            height: 415\n         }\n      };\n      state.route.value = route;\n      const title = routes[route].title;\n      const height = routes[route].height;\n      win.dialog('option', 'title', title);\n      win.dialog('option', 'height', height);\n   };\n\n   state.registration.validate.clear = _.debounce(() => {\n      state.registration.validate.value = false;\n   }, 2000);\n\n   state.registration.validate.show = () => {\n      state.registration.validate.value = true;\n      state.registration.validate.clear();\n   }\n\n   /* { verify_email: 'email' } step */\n   state.registration.create = () => {\n      const email = state.registration.email;\n      if(email == '' || !validateEmail(email)) {\n         state.registration.validate.show();\n         return;\n      }\n\n      state.registration.disabled = true;\n      liveapi.send({verify_email: email, type: 'account_opening'})\n         .then((data) => {\n            state.registration.disabled = false;\n            if(data.verify_email) {\n               $.growl.notice({ message: 'Verification code sent to '.i18n() + email });\n               state.route.update('account');\n            }\n            else  {\n               throw { message: 'Email verification failed ('.i18n() + data.msg_type + ')' };\n            }\n         })\n         .catch((err) => {\n            console.error(err);\n            $.growl.error({ message: err.message });\n            state.registration.disabled = false;\n         });\n   }\n\n   /* { new_account_virtual: 1 } step */\n   state.account.open = () => {\n      state.account.empty_fields.show();\n      const email = state.registration.email,\n         verification = state.account.verification,\n         password = state.account.password,\n         repeat_password = state.account.repeat_password,\n         residence = state.account.residence;\n      let ok = validateEmail(email) && verification !== '' && password === repeat_password && password.length >= 6;\n      ok = ok && /\\d/.test(password) && /[a-z]/.test(password) && /[A-Z]/.test(password)  && residence.length === 2;\n\n      if(!ok) { return; }\n\n      const request = {\n         new_account_virtual: 1,\n         verification_code: verification,\n         client_password: password,\n         residence: residence,\n         // affilate_token: '???'\n      };\n      state.account.disabled = true;\n      liveapi.send(request)\n         .then((data) => {\n            const account = data.new_account_virtual;\n            const oauth = [{id: account.client_id, token: account.oauth_token }];\n            local_storage.set('oauth', oauth);\n            state.account.disabled = false;\n            liveapi.cached.authorize()\n               .then(() => {\n                  win.dialog('destroy'); \n                  win.remove();\n                  login_win = null;\n               })\n               .catch(\n                  (err) => console.error(err.message)\n               );\n            //state.route.update('confirm');\n         })\n         .catch((err) => {\n            console.error(err);\n            $.growl.error({ message: err.message });\n            state.account.disabled = false;\n         });\n   }\n\n   login_win_view = rv.bind(root[0], state);\n\n   liveapi.cached.send({residence_list: 1})\n      .then((data) => {\n         state.account.residence_list = data.residence_list.map((r) => {\n            r.disabled = (r.disabled === 'DISABLED' || r.disabled === true);\n            r.disabled && state.account.residence_unsupported.push(r.value);\n            return r;\n         });\n         state.account.residence = 'id'; // make indonesia default\n         liveapi.cached.send({website_status: 1})\n            .then((data) => {\n               const residence = data.website_status && data.website_status.clients_country;\n               if(state.account.residence_unsupported.indexOf(residence) === -1)\n                  state.account.residence = residence || 'id';\n            })\n            .catch((err) => {\n               console.error(err);\n               state.account.residence = 'id';\n            })\n      })\n      .catch((err) => {\n         console.error(err);\n         $.growl.error({ message: err.message });\n      });\n}\n\nexport const login = () => {\n   const app_id = liveapi.app_id;\n   const config = local_storage.get('config');\n   const oauth_url = (config && config.oauth_url) || 'https://oauth.binary.com/oauth2/authorize';\n   window.location =  oauth_url + '?app_id=' + app_id;\n}\n\nexport default {\n   init,\n   login\n}\n"]}