$(document).ready(function(){$(function(){$("#menu").menu()})}),define(["jquery","jquery-ui","websockets/symbol_handler"],function(a,b,c){"use strict";function d(b){require(["validation/validation"],function(c){require(["charts/chartWindow"],function(d){if(!c.validateIfNoOfChartsCrossingThreshold(d.totalWindows()))return void require(["jquery","jquery-growl"],function(a){a.growl.error({message:"No more charts allowed!"})});var f=a("#instrumentsDialog").dialog("option","title"),g=a("#instrumentsDialog").data("symbol"),h=a("#instrumentsDialog").data("delay_amount");require(["common/util"],function(){var i=convertToTimeperiodObject(b);i?c.validateNumericBetween(i.intValue(),parseInt(a("#timePeriod").attr("min")),parseInt(a("#timePeriod").attr("max")))?h<=i.timeInSeconds()/60?(d.addNewWindow(g,f,b,null,isTick(b)?"line":"candlestick"),e.call(a("#instrumentsDialog"))):require(["jquery","jquery-growl"],function(a){a("#timePeriod").addClass("ui-state-error"),a.growl.error({message:"Charts of less than "+convertToTimeperiodObject(h+"m").humanReadableString()+" are not available for the "+f+"."})}):require(["jquery","jquery-growl"],function(a){a("#timePeriod").addClass("ui-state-error"),a.growl.error({message:"Only numbers between "+a("#timePeriod").attr("min")+" to "+a("#timePeriod").attr("max")+" is allowed for "+a("#units option:selected").text()+"!"})}):require(["jquery","jquery-growl"],function(a){a("#timePeriod").addClass("ui-state-error"),a.growl.error({message:"Only numbers between 1 to 100 is allowed!"})})})})})}function e(){a(this).dialog("close"),a(this).find("*").removeClass("ui-state-error")}function f(b,c){a.each(c,function(c,g){var h=a("<li>").append(g.display_name).data("symbol",g.symbol).data("delay_amount",g.delay_amount).appendTo(b);if(g.submarkets||g.instruments){h.click(function(a){return a.preventDefault(),!1});var i=a("<ul>");i.appendTo(h),f(i,g.submarkets||g.instruments)}else h.click(function(){0==a("#instrumentsDialog").length?a.get("instruments/instruments.html",function(b){a(b).css("display","none").appendTo("body"),a("#standardPeriodsButtonContainer").find("button").click(function(){d(a(this).attr("id"))}).button(),a("#units").change(function(){if("t"==a(this).val())a("#timePeriod").val("1").attr("disabled","disabled").attr("min",1).attr("max",1);else{a("#timePeriod").removeAttr("disabled");var b=a("#units").val(),c={m:59,h:23,d:3}[b]||120;a("#timePeriod").attr("max",c)}}),a("#units").trigger("change"),a("#instrumentsDialog").dialog({autoOpen:!1,resizable:!1,width:260,my:"center",at:"center",of:window,buttons:[{text:"Ok",click:function(){d(a("#timePeriod").val()+a("#units").val())}},{text:"Cancel",click:function(){e.call(this)}}]}),a("#instrumentsDialog").dialog("option","title",h.text()).data("symbol",h.data("symbol")).data("delay_amount",h.data("delay_amount")),a("#instrumentsDialog").dialog("open"),a("#instrumentSelectionMenuDIV").hide()}):(a("#instrumentsDialog").dialog("option","title",a(this).text()).data("symbol",a(this).data("symbol")).data("delay_amount",a(this).data("delay_amount")),a("#instrumentsDialog").dialog("open"),a("#instrumentSelectionMenuDIV").hide()),a(document).click()})})}function g(a){for(var b in a.trading_times.markets){var c=a.trading_times.markets[b],d={name:c.name,display_name:c.name,submarkets:[]};for(var e in c.submarkets){var f=c.submarkets[e],g={name:f.name,display_name:f.name,instruments:[]};for(var i in f.symbols){var j=f.symbols[i];g.instruments.push({symbol:j.symbol,display_name:j.name,delay_amount:0})}d.submarkets.push(g)}h.push(d)}}var h=[];return{init:function(){a.isEmptyObject(h)&&(loadCSS("instruments/instruments.css"),c.fetchMarkets(function(b){if(!a.isEmptyObject(b)){g(b);var c=a(".mainContainer").find(".instruments"),d=a("<ul>");d.appendTo(c),f(d,h),d.menu()}}))},getMarketData:function(){return h},isMarketDataPresent:function(b,c){var d=!1;c||(c=h);var e=this;return a.each(c,function(c,f){return f.submarkets||f.instruments?d=e.isMarketDataPresent(b,f.submarkets||f.instruments):a.trim(f.display_name)==a.trim(b)&&(d=!0),!d}),d},getSpecificMarketData:function(b,c){var d={};c||(c=h);var e=this;return a.each(c,function(c,f){return f.submarkets||f.instruments?d=e.getSpecificMarketData(b,f.submarkets||f.instruments):a.trim(f.display_name)==a.trim(b)&&(d=f),a.isEmptyObject(d)}),d}}});