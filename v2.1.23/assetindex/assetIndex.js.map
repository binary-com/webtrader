{"version":3,"sources":["../../../../src/assetindex/assetIndex.es6"],"names":["table","assetWin","init","li","click","createBlankWindow","title","i18n","width","height","track","module_id","is_unique","data","dialog","require","initAssetWin","moveToTop","processMarketSubmarkets","markets","extractChartableMarkets","ret","forEach","market","smarkets","display_name","submarkets","smarket","instruments","map","symbol","refreshTable","assets","updateTable","market_name","submarket_name","symbols","rows","filter","asset","indexOf","props","prop","unshift","api","remove","add","draw","processing_msg","attr","show","Promise","all","cached","send","trading_times","Date","toISOString","slice","asset_index","then","results","header","parent","find","addClass","dialog_buttons","market_names","makeSelectmenu","insertBefore","list","Object","keys","inx","changed","val","submarket_names","update_list","selectmenu","is_rtl_language","local_storage","get","value","hide","err","console","error","catch","growl","message","$html","appendTo","dataTable","className","paging","ordering","searching","processing","column","every","on","search"],"mappings":"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","file":"assetIndex.js","sourcesContent":["ï»¿/**\n * Created by amin on October 19, 2015.\n */\nimport $ from 'jquery';\nimport windows from '../windows/windows';\nimport liveapi from '../websockets/binary_websockets';\nimport menu from \"../navigation/menu\";\nimport _ from \"lodash\";\nimport \"datatables\";\nimport \"jquery-growl\";\n\nlet table = null;\nlet assetWin = null;\n\nexport const init = (li) => {\n    li.click(() => {\n        if (!assetWin) {\n            assetWin = windows.createBlankWindow($('<div/>'), {\n                title: 'Asset Index'.i18n(),\n                width: 700,\n                height: 400\n            });\n            assetWin.track({\n                module_id: 'assetIndex',\n                is_unique: true,\n                data: null\n            });\n            assetWin.dialog('open'); /* bring window to front */\n            require(['text!assetindex/assetIndex.html'], initAssetWin);\n        } else\n            assetWin.moveToTop();\n    });\n}\n\nconst processMarketSubmarkets = (markets) => {\n    markets = menu.extractChartableMarkets(markets);\n\n    const ret = {};\n    markets.forEach((market) => {\n        const smarkets = ret[market.display_name] = {};\n        market.submarkets.forEach((smarket) => {\n            smarkets[smarket.display_name] = smarket.instruments.map((symbol) => {\n                return symbol.display_name; });\n        });\n    });\n    return ret;\n}\n\nconst refreshTable = () => {\n    let assets = [];\n    let markets = {};\n    const updateTable = (market_name, submarket_name) => {\n        const symbols = markets[market_name][submarket_name];\n        const rows = assets\n            .filter((asset) => {\n                return symbols.indexOf(asset[1] /* asset.name */ ) > -1;\n            })\n            .map((asset) => {\n                /* secham:\n                    [ \"frxAUDJPY\",\"AUD/JPY\",\n                        [\"callput\",\"callput\",\"5t\",\"365d\"],\n                        [\"touchnotouch\",\"Touch/No Touch\",\"1h\",\"1h\"],\n                        [\"endsinout\",\"endsinout\",\"1d\",\"1d\"],\n                        [\"staysinout\",\"staysinout\",\"1d\",\"1d\"]\n                    ]\n                */\n                const props = asset[2] /* asset.props */\n                    .map((prop) => {\n                        return prop[2] + ' - ' + prop[3]; }); /* for each property extract a string */\n                props.unshift(asset[1]); /* add asset.name to the beginning of array */\n\n                return props;\n            });\n        table.api().rows().remove();\n        table.api().rows.add(rows);\n        table.api().draw();\n    }\n\n    const processing_msg = $('#' + table.attr('id') + '_processing').show();\n    Promise.all(\n            [\n                liveapi.cached.send({ trading_times: new Date().toISOString().slice(0, 10) }),\n                liveapi.cached.send({ asset_index: 1 })\n            ])\n        .then((results) => {\n            try {\n                assets = results[1].asset_index;\n                markets = processMarketSubmarkets(results[0]);\n                const header = assetWin.parent().find('.ui-dialog-title').addClass('with-content');\n                const dialog_buttons = assetWin.parent().find('.ui-dialog-titlebar-buttonpane');\n\n                const market_names = windows\n                    .makeSelectmenu($('<select />').insertBefore(dialog_buttons), {\n                        list: Object.keys(markets), //Keys are the display_name\n                        inx: 1, //Index to select the item in drop down\n                        changed: (val) => {\n                            const list = Object.keys(markets[val]); /* get list of sub_markets */\n                            submarket_names.update_list(list);\n                            updateTable(market_names.val(), submarket_names.val());\n                        },\n                        width: '180px'\n                    });\n                market_names.selectmenu('widget').addClass('asset-index-selectmenu');\n\n                const is_rtl_language = local_storage.get('i18n') && local_storage.get('i18n').value === 'ar';\n                const submarket_names = windows\n                    .makeSelectmenu($('<select />').insertBefore(is_rtl_language ? market_names : dialog_buttons), {\n                        list: Object.keys(markets[market_names.val()]),\n                        inx: 0,\n                        changed: (val) => {\n                            updateTable(market_names.val(), submarket_names.val());\n                        },\n                        width: '200px'\n                    });\n                submarket_names.selectmenu('widget').addClass('asset-index-selectmenu');\n\n                updateTable(market_names.val(), submarket_names.val());\n                processing_msg.hide();\n            } catch (err) { console.error(err) }\n        })\n        .catch((error) => {\n            $.growl.error({ message: error.message });\n            console.error(error);\n        });\n}\n\nconst initAssetWin = ($html) => {\n    $html = $($html).i18n();\n    table = $html.filter('table');\n    $html.appendTo(assetWin);\n\n    table = table.dataTable({\n        data: [],\n        \"columnDefs\": [\n            { className: \"dt-body-center dt-header-center\", \"targets\": [0, 1, 2, 3, 4] },\n            { \"defaultContent\": \"-\", \"targets\": [0, 1, 2, 3, 4] }\n        ],\n        paging: false,\n        ordering: false,\n        searching: true,\n        processing: true\n    });\n    table.parent().addClass('hide-search-input');\n\n    // Apply the a search on each column input change\n    table.api().column(0).every(function() {\n        const column = this;\n        $('input', this.header()).on('keyup change', function() {\n            if (column.search() !== this.value)\n                column.search(this.value).draw();\n        });\n    });\n\n    refreshTable();\n}\n\nexport default {\n    init\n}\n"]}