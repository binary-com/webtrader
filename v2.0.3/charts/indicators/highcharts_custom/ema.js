define(["indicator_base","highstock"],function(a){var b={},c={};return{init:function(){!function(d,e){function f(d,e){{var f=this;f.chart}for(var g in c)if(c[g]&&c[g].options&&c[g].options.data&&c[g].options.data.length>0&&b[g].parentSeriesID==f.options.id){var h=f.options.data,i=c[g].options.data,j=b[g].period,k=a.findDataUpdatedDataPoint(h,d);if(k>=1){var l=0;l=a.isOHLCorCandlestick(this.options.type)?a.extractPriceForAppliedTO(b[g].appliedTo,h,k):h[k].y?h[k].y:h[k][1];var m=a.toFixed(2*l/(j+1)+(i[k-1][1]||i[k-1].y)*(1-2/(j+1)),4);e?c[g].options.data.length<h.length?c[g].addPoint([h[k].x||h[k][0],m]):c[g].data[k].update([h[k].x||h[k][0],m]):c[g].addPoint([h[k].x||h[k][0],m])}}}d&&!d.Series.prototype.addEMA&&(d.Series.prototype.addEMA=function(d){var f=this.options.id;d=e.extend({period:21,stroke:"red",strokeWidth:2,dashStyle:"line",levels:[],appliedTo:a.CLOSE,parentSeriesID:f},d);var g="_"+(new Date).getTime(),h=this.options.data||[];if(!(d.period>=h.length)){if(h&&h.length>0){for(var i=[],j=0,k=0;k<d.period;k++)j+=a.isOHLCorCandlestick(this.options.type)?a.extractPriceForAppliedTO(d.appliedTo,h,k):h[k].y?h[k].y:h[k][1],i.push(k==d.period-1?[h[d.period-1].x?h[d.period-1].x:h[d.period-1][0],j/d.period]:[h[k].x?h[k].x:h[k][0],null]);for(var k=d.period;k<h.length;k++){var l=0;l=a.isOHLCorCandlestick(this.options.type)?a.extractPriceForAppliedTO(d.appliedTo,h,k):h[k].y?h[k].y:h[k][1];var m=2*l/(d.period+1)+(i[k-1][1]||i[k-1].y)*(1-2/(d.period+1));i.push([h[k].x||h[k][0],a.toFixed(m,4)])}var n=this.chart;b[g]=d;var o=this;c[g]=n.addSeries({id:g,name:"EMA("+d.period+", "+a.appliedPriceString(d.period)+")",data:i,type:"line",dataGrouping:o.options.dataGrouping,opposite:o.options.opposite,color:d.stroke,lineWidth:d.strokeWidth,dashStyle:d.dashStyle,compare:o.options.compare},!1,!1),e(c[g]).data({onChartIndicator:!0,indicatorID:"ema",isIndicator:!0,parentSeriesID:d.parentSeriesID,period:d.period}),n.redraw()}return g}},d.Series.prototype.removeEMA=function(a){var d=this.chart;b[a]=null,d.get(a).remove(),c[a]=null},d.wrap(d.Series.prototype,"addPoint",function(c,d,e,g,h){c.call(this,d,e,g,h),a.checkCurrentSeriesHasIndicator(b,this.options.id)&&f.call(this,d)}),d.wrap(d.Point.prototype,"update",function(c,d,e,g){c.call(this,d,e,g),a.checkCurrentSeriesHasIndicator(b,this.series.options.id)&&f.call(this.series,d,!0)}))}(Highcharts,jQuery,a)}}});