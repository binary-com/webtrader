<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Highcharts EMA Demo</title>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="//code.highcharts.com/stock/highstock.js"></script>
    <script src="//code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="highcharts_ema.js"></script>
</head>
<body>

<div id="container" style="height: 800px; min-width: 310px"></div>
<button id="addEMA">Add EMA</button>
<button id="removeEMA">Remove EMA</button>
<button id="addOne">Add one point</button>
<button id="udpateOne">Update one point</button>

<script type="text/javascript">
    $(function () {

        var ohlc = [], volume = [];

        $('#addEMA').click(function () {
            $('#container').highcharts().series[0].addEMA();
        });
        $('#removeEMA').click(function () {
            var chart = $('#container').highcharts();
            var series = chart.series[0];
            $.each(series.emaSeries, function (key, val) {
                if (val) {
                    series.removeEMA(key);
                    return false;
                }
            });
        });
        $('#addOne').click(function () {
            $('#container').highcharts().series[0].addPoint([ohlc[ohlc.length - 1][0] + (ohlc[ohlc.length - 1][0] - ohlc[ohlc.length - 2][0]), ohlc[ohlc.length - 1][1], ohlc[ohlc.length - 1][2], ohlc[ohlc.length - 1][3], ohlc[ohlc.length - 1][4]]);
        });
        $('#udpateOne').click(function () {
            var points = $('#container').highcharts().series[0].points;
            var point = points[points.length - 1];
            point.update([point.x, point.open, point.high, point.low, point.close + 2.0]);
        });

        $.getJSON('http://www.highcharts.com/samples/data/jsonp.php?filename=aapl-ohlcv.json&callback=?', function (data) {

            // split the data set into ohlc and volume
            var dataLength = data.length, i = 0;

            for (i; i < dataLength; i += 1) {
                ohlc.push([
                    data[i][0], // the date
                    data[i][1], // open
                    data[i][2], // high
                    data[i][3], // low
                    data[i][4] // close
                ]);

                volume.push([
                    data[i][0], // the date
                    data[i][5] // the volume
                ]);
            }


            // create the chart
            $('#container').highcharts('StockChart', {

                rangeSelector: {
                    selected: 1
                },

                title: {
                    text: 'AAPL Historical'
                },

                yAxis: [{
                    opposite: false,
                    labels: {
                        align: 'right',
                        x: -3
                    },
                    title: {
                        text: 'OHLC'
                    },
                    height: '60%',
                    lineWidth: 2
                }, {
                    opposite: false,
                    labels: {
                        align: 'right',
                        x: -3
                    },
                    title: {
                        text: 'Volume'
                    },
                    top: '62%',
                    height: '38%',
                    offset: 0,
                    lineWidth: 2
                }],

                series: [{
                    type: 'candlestick',
                    name: 'AAPL',
                    data: ohlc,
                    dataGrouping: {
                        enabled: false
                    }
                }, {
                    type: 'column',
                    name: 'Volume',
                    data: volume,
                    yAxis: 1,
                    dataGrouping: {
                        enabled: false
                    }
                }]
            });
        });
    });
</script>
</body>
</html>
